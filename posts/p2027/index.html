<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@keisukesiratori"/><meta property="og:site_name" content="Edelstein"/><title>Spring Cloudを勉強してみる</title><meta name="robots" content="index,follow"/><meta name="description" content="Spring Cloudを勉強してみる"/><meta property="og:title" content="Spring Cloudを勉強してみる"/><meta property="og:description" content="Spring Cloudを勉強してみる"/><meta property="og:url" content="http:localhost:3000/posts/p2027"/><meta property="og:type" content="website"/><meta property="og:image" content="https://locahost:3000/undefined"/><meta property="og:image:alt" content="Spring Cloudを勉強してみる"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="700"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/df6bb53438996960.css" as="style"/><link rel="stylesheet" href="/_next/static/css/df6bb53438996960.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-480c748fb908b436.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a840d570c522cf0.js" defer=""></script><script src="/_next/static/chunks/7-a9ae6bf2d6049209.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-31ed6b5e8c78747a.js" defer=""></script><script src="/_next/static/fyKT5eJ48xjFi_XzaeyzT/_buildManifest.js" defer=""></script><script src="/_next/static/fyKT5eJ48xjFi_XzaeyzT/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen bg-zinc-800"><header class="sticky top-0 border-b border-zinc-400 z-10 bg-zinc-900 text-slate-400"><div class="max-w-4xl mx-auto flex justify-between items-center h-12"><a href="/">Home</a><a target="_blank" href="https://github.com/jirentaicho">Github</a><a target="_blank" href="https://zenn.dev/misaka">Zenn</a></div></header><main class="flex-1 max-w-4xl w-full mx-auto"><div class="prose prose-lg max-w-none text-emerald-400"><h1 class="mt-12">Spring Cloudを勉強してみる</h1><span>2022.04.12</span><div class="space-x-2"><span><a class="text-emerald-300" href="/categories/Spring/">Spring</a></span></div></div></main><footer class="bg-zinc-900 text-slate-400"><div class="max-w-4xl w-full mx-auto h-24 flex items-center justify-center"><div>© volkruss.com / Edelstein</div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"Spring Cloudを勉強してみる","date":"2022.04.12","description":"Spring Cloudを勉強してみる","categories":["Spring"]},"content":"\u003cp\u003eGithubを見ていたらSpring Cloudを利用したプロジェクトを発見した。全く未知の部分なので参考サイトなどを読んで入門してみました\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e発見したGithub\n\u003cul\u003e\n\u003cli\u003ehttps://github.com/southwind9801/orderingsystem\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e参考サイト\n\u003cul\u003e\n\u003cli\u003ehttps://spring.pleiades.io/projects/spring-cloud\u003c/li\u003e\n\u003cli\u003ehttps://qiita.com/ryotaro76/items/45632ff117cc19544959\u003c/li\u003e\n\u003cli\u003ehttps://lifesaver.codes/answer/eureka-client-shutting-down-unexpectedly-after-registering-with-eureka-server-2696\u003c/li\u003e\n\u003cli\u003ehttps://stackoverflow.com/questions/68100671/nosuchmethoderror-org-springframework-boot-web-servlet-error-errorcontroller-ge\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fenterprisegeeks.hatenablog.com%2Fentry%2F2015%2F11%2F02%2F000000\"\u003e参考\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e私の作ったプロジェクト\n\u003cul\u003e\n\u003cli\u003ehttps://github.com/jirentaicho/spring-micro-service-test\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eはじめに\u003c/h2\u003e\n\u003cp\u003e今からやることはもうレガシーだと思います。ただ、Springでマイクロサービスってこんな感じ？ってのを入門するためにやっています。\u003c/p\u003e\n\u003ch2\u003e準備\u003c/h2\u003e\n\u003cp\u003eまずは事前確認します。gradleを利用して作成します。用語は超ザックリです。\u003c/p\u003e\n\u003ch4\u003eマイクロサービス\u003c/h4\u003e\n\u003cp\u003eアプリケーションの機能を最小単位のコンポーネントに分割して、他のサービスに影響を与えることなくビルド、テスト、デプロイ、アップデートができる\u003c/p\u003e\n\u003ch4\u003eリバースプロキシ\u003c/h4\u003e\n\u003cp\u003e外部からのアクセスに対する全ての接続を中継するプロキシサーバー負荷分散、セキュリティ強化などのメリットがある。\u003c/p\u003e\n\u003ch4\u003eEureka Server\u003c/h4\u003e\n\u003cp\u003ehttps://www.tutorialspoint.com/spring_boot/spring_boot_eureka_server.htm\u003c/p\u003e\n\u003ch4\u003e@EnableEurekaServer\u003c/h4\u003e\n\u003cp\u003eサービスレジストリとしてEurekaサーバを作成する\u003c/p\u003e\n\u003ch4\u003eサービスレジストリ\u003c/h4\u003e\n\u003cp\u003eアプリケーションデータ構造のデータベース\u003c/p\u003e\n\u003ch4\u003e@EnableEurekaClient\u003c/h4\u003e\n\u003cp\u003ehttps://www.javadoc.io/doc/org.springframework.cloud/spring-cloud-netflix-eureka-client/1.1.2.RELEASE/org/springframework/cloud/netflix/eureka/EnableEurekaClient.html\u003c/p\u003e\n\u003ch4\u003e@EnableDiscoveryClient\u003c/h4\u003e\n\u003cp\u003eEureka Server へ 自身を登録するサービスは Eureka Client と呼ばれます。\u003c/p\u003e\n\u003ch4\u003e@EnableZuulProxy\u003c/h4\u003e\n\u003cp\u003eプロキシとして動作させます。\u003c/p\u003e\n\u003ch3\u003eプロジェクトの作成\u003c/h3\u003e\n\u003cp\u003e参考サイトを見て作っていきます。\u003c/p\u003e\n\u003ch3\u003eEurekaServer\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eEurekaServerの作成\n\u003cul\u003e\n\u003cli\u003eSpring-Stertar-ProjectからEurikaServerの依存を追加して新規作成する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e@EnableEurekaServer\u003c/li\u003e\n\u003cli\u003eapplication.ymlを修正する\u003c/li\u003e\n\u003cli\u003eサーバーを起動する\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/2027/1.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003ch3\u003eWebService\u003c/h3\u003e\n\u003cp\u003eここが一番迷いました。まず最新のSpringBootでは動かないです。動いたbuild.gradleを載せておきます。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWebService\n\u003cul\u003e\n\u003cli\u003eSpring-Stertar-ProjectからEurikaServerの依存を追加して新規作成する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eZuulは別途依存追加\n\u003cul\u003e\n\u003cli\u003eもうサポートしていないらしい\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eapplication.ymlの修正をする\u003c/li\u003e\n\u003cli\u003ebuild.gradleでspringのバージョンを下げる\n\u003cul\u003e\n\u003cli\u003ehttps://stackoverflow.com/questions/68100671/nosuchmethoderror-org-springframework-boot-web-servlet-error-errorcontroller-ge\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003espring-boot-starter-webの依存を追加する\n\u003cul\u003e\n\u003cli\u003e追加しないと警告になります\u003c/li\u003e\n\u003cli\u003eプロジェクト作成時にwebを追加しておいても良いです\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e@EnableZuulProxy\u003c/li\u003e\n\u003cli\u003e@EnableEurekaClient\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ebuild.gradle\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003eplugins {\n\tid 'org.springframework.boot' version '2.1.3.RELEASE' //変更\n\tid 'io.spring.dependency-management' version '1.0.11.RELEASE'\n\tid 'java'\n}\n\ngroup = 'com.volkruss'\nversion = '0.0.1-SNAPSHOT'\nsourceCompatibility = '11'\n\nrepositories {\n\tmavenCentral()\n}\n\next {\n\tset('springCloudVersion', \"Greenwich.RELEASE\") //変更\n}\n\ndependencies {\n\timplementation 'org.springframework.cloud:spring-cloud-starter-netflix-eureka-client'\n\t// https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-zuul\n\timplementation 'org.springframework.cloud:spring-cloud-starter-netflix-zuul:2.2.10.RELEASE'\n\t// https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web\n\timplementation 'org.springframework.boot:spring-boot-starter-web:2.6.6'\n\ttestImplementation 'org.springframework.boot:spring-boot-starter-test'\n}\n\ndependencyManagement {\n\timports {\n\t\tmavenBom \"org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}\"\n\t}\n}\n\ntasks.named('test') {\n\tuseJUnitPlatform()\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003estarter-webがないとエラー吐きます\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eRegistered instance BACKEND-SERVICE/LAPTOP-GQK0K0U9:backend-service:8002 with status DOWN (replication=true)\nCancelled instance BACKEND-SERVICE/LAPTOP-GQK0K0U9:backend-service:8002 (replication=false)\nRegistry: cancel failed because Lease is not registered for: BACKEND-SERVICE/LAPTOP-GQK0K0U9:backend-service:8002\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eapplication.yml\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-JSON\"\u003e\u003ccode class=\"language-JSON\"\u003espring:\n  application:\n    name: web-service\nserver:\n  port: 8001\neureka:\n  client:\n    service-url: \n      defaultZone: http://localhost:8761/eureka\n  instance:\n    prefer-ip-address: true\nzuul:\n  routes:\n    backend-service:\n      path: \u0026#x26;#39;/api/**\u0026#x26;#39;\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4\u003eその他\u003c/h4\u003e\n\u003cp\u003eアノテーション不要っぽい？？後述の@EnableDiscoveryClientも同じくhttps://stackoverflow.com/questions/60349535/what-is-use-of-enableeurekaclient\u003c/p\u003e\n\u003ch3\u003eBackendService\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eBackendServiceを作る\n\u003cul\u003e\n\u003cli\u003eEureka Discoveryの依存を追加する\u003c/li\u003e\n\u003cli\u003e@EnableDiscoveryClient\u003c/li\u003e\n\u003cli\u003e実際のコントローラーや処理を作成する\u003c/li\u003e\n\u003cli\u003eapplication.ymlを作成する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eここは単体でも動作するのですが、WebServiceを通してもアクセスができます。今回の場合は単にStringを返しています。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@RestController\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBackendController\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token annotation punctuation\"\u003e@RequestMapping\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/hello\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token function\"\u003ehello\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"こんにちは！\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eWebServiceからアクセス\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/2027/2.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBackendServiceから直接アクセス\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/2027/3.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003eもう一つBackendServiceを作成してみました。\u003c/p\u003e\n\u003cp\u003eすると以下のように追加されています\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/2027/4.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/2027/5.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003e簡単な設定でこういったことが実験できて面白いですね。またSTSでも実際に動かせるのも開発者にとっては便利ですね。\u003c/p\u003e","slug":"p2027"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"p2027"},"buildId":"fyKT5eJ48xjFi_XzaeyzT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>