<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@keisukesiratori"/><meta property="og:site_name" content="Edelstein"/><title>Spring | AOPで独自アノテーションがついたフィールドに値をセットする</title><meta name="robots" content="index,follow"/><meta name="description" content="Spring | AOPで独自アノテーションがついたフィールドに値をセットする"/><meta property="og:title" content="Spring | AOPで独自アノテーションがついたフィールドに値をセットする"/><meta property="og:description" content="Spring | AOPで独自アノテーションがついたフィールドに値をセットする"/><meta property="og:url" content="http:localhost:3000/posts/p2332"/><meta property="og:type" content="website"/><meta property="og:image" content="https://locahost:3000/undefined"/><meta property="og:image:alt" content="Spring | AOPで独自アノテーションがついたフィールドに値をセットする"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="700"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/df6bb53438996960.css" as="style"/><link rel="stylesheet" href="/_next/static/css/df6bb53438996960.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-480c748fb908b436.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a840d570c522cf0.js" defer=""></script><script src="/_next/static/chunks/7-a9ae6bf2d6049209.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-31ed6b5e8c78747a.js" defer=""></script><script src="/_next/static/zySuBojNZUu9-667yIcmf/_buildManifest.js" defer=""></script><script src="/_next/static/zySuBojNZUu9-667yIcmf/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen bg-zinc-800"><header class="sticky top-0 border-b border-zinc-400 z-10 bg-zinc-900 text-slate-400"><div class="max-w-4xl mx-auto flex justify-between items-center h-12"><a href="/">Home</a><a target="_blank" href="https://github.com/jirentaicho">Github</a><a target="_blank" href="https://zenn.dev/misaka">Zenn</a></div></header><main class="flex-1 max-w-4xl w-full mx-auto"><div class="prose prose-lg max-w-none text-emerald-400"><h1 class="mt-12">Spring | AOPで独自アノテーションがついたフィールドに値をセットする</h1><span>2022.05.15</span><div class="space-x-2"><span><a class="text-emerald-300" href="/categories/Spring/">Spring</a></span></div></div></main><footer class="bg-zinc-900 text-slate-400"><div class="max-w-4xl w-full mx-auto h-24 flex items-center justify-center"><div>© volkruss.com / Edelstein</div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"Spring | AOPで独自アノテーションがついたフィールドに値をセットする","date":"2022.05.15","description":"Spring | AOPで独自アノテーションがついたフィールドに値をセットする","categories":["Spring"]},"content":"\u003cp\u003e独自に作ったアノテーションに対して、AOPを使って処理を行います。\u003c/p\u003e\n\u003cp\u003e具体的には、独自のアノテーションが付いたフィールドに対して、AOPを利用して値を設定します。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eアノテーションを作成する\u003c/li\u003e\n\u003cli\u003eフィールドにアノテーションを設定する\u003c/li\u003e\n\u003cli\u003eAspectを作成する\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eアノテーションを作る\u003c/h1\u003e\n\u003cp\u003eまずはアノテーションを作ります。アノテーションは簡単に作成できます。今回作るアノテーションはマーカーアノテーションです。\u003c/p\u003e\n\u003cp\u003eフィールドにのみ対応しています。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003epackage\u003c/span\u003e \u003cspan class=\"token namespace\"\u003ecom\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexample\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edemo\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eannotation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token import\"\u003e\u003cspan class=\"token namespace\"\u003ejava\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elang\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eannotation\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eDocumented\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token import\"\u003e\u003cspan class=\"token namespace\"\u003ejava\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elang\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eannotation\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eElementType\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token import\"\u003e\u003cspan class=\"token namespace\"\u003ejava\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elang\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eannotation\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eRetention\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token import\"\u003e\u003cspan class=\"token namespace\"\u003ejava\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elang\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eannotation\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eRetentionPolicy\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token import\"\u003e\u003cspan class=\"token namespace\"\u003ejava\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elang\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eannotation\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eTarget\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token annotation punctuation\"\u003e@Documented\u003c/span\u003e\n\u003cspan class=\"token annotation punctuation\"\u003e@Retention\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eRetentionPolicy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eRUNTIME\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token annotation punctuation\"\u003e@Target\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003evalue\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eElementType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eFIELD\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token annotation punctuation\"\u003e@interface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMisaka\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eフィールドアノテーション\n\u003cul\u003e\n\u003cli\u003e@Target(value={ElementType.FIELD})\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eフィールドにアノテーションを設定する\u003c/h2\u003e\n\u003cp\u003e利用するクラスのフィールドに@Misakaをつけます\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSampleUsecaseImpl\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSampleUsecase\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n\t\u003cspan class=\"token annotation punctuation\"\u003e@Misaka\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e misaka\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\n\t\u003cspan class=\"token annotation punctuation\"\u003e@Override\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token class-name\"\u003eSystem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eout\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eprintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emisaka \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e\":が設定されています\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003emisakaという変数は、これから作るAspectから設定します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eAspectを作る\u003c/h2\u003e\n\u003cp\u003e次にAspectを作ります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@Aspect\u003c/span\u003e\n\u003cspan class=\"token annotation punctuation\"\u003e@Component\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMisakaAnnotationLogic\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token annotation punctuation\"\u003e@Before\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"execution(public * com.example.demo..*.*(..))\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// demo配下の全て\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token function\"\u003ebefore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eJoinPoint\u003c/span\u003e point\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethrows\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIllegalArgumentException\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIllegalAccessException\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token comment\"\u003e// クラスを取得する\u003c/span\u003e\n\t\t\u003cspan class=\"token class-name\"\u003eClass\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e clazz \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e point\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetTarget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetClass\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token comment\"\u003e// フィールド一覧を取得する\u003c/span\u003e\n\t\t\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e fields \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e clazz\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetDeclaredFields\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token comment\"\u003e// アノテーションが付いたフィールドを取得する\u003c/span\u003e\n\t\t\u003cspan class=\"token class-name\"\u003eOptional\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e target \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ehaveAnnotationField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efields\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMisaka\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etarget\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eisPresent\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e misaka \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"misaka\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\t\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e field \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e target\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\t\u003cspan class=\"token comment\"\u003e// 強制的にアクセスします\u003c/span\u003e\n\t\t\tfield\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetAccessible\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\t\u003cspan class=\"token comment\"\u003e// 値を設定する対象はpoint.getTargetで取得できる(実際のインスタンス)\u003c/span\u003e\n\t\t\tfield\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epoint\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetTarget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003emisaka\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\t\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\n\t\u003cspan class=\"token annotation punctuation\"\u003e@SuppressWarnings\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"unchecked\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eOptional\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003ehaveAnnotationField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e fields\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eClass\u003c/span\u003e clazz\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e field \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e fields\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eObjects\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003enonNull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efield\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetAnnotation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eclazz\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eOptional\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eof\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efield\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eOptional\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eempty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003ePointcutはcom.example.demo配下のパッケージを対象にします。\n\u003cul\u003e\n\u003cli\u003e(“execution(public * com.example.demo...(..))”)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eフィールドアノテーションを取得するにはフィールドが必要なので、リフレクションでフィールド一覧を取得します。\n\u003cul\u003e\n\u003cli\u003eclazz.getDeclaredFields();getDeclaredFieldsは修飾子に関係なくフィールドを取得します\n\u003cul\u003e\n\u003cli\u003egetDeclaredFieldsは修飾子に関係なくフィールドを取得します\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eフィールドを走査して、指定したアノテーションが付いてるかどうか調べます\n\u003cul\u003e\n\u003cli\u003eif(Objects.nonNull(field.getAnnotation(clazz))) {\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eフィールドに値をセットするには、その対象となるオブジェクトが必要ですので、point.getTargetで取得します\n\u003cul\u003e\n\u003cli\u003efield.set(point.getTarget(),misaka);\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eこれで実行すると@Misakaを付けたフィールドに対して値が設定されます。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/2332/1.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003ch2\u003e複数のアノテーションに対応\u003c/h2\u003e\n\u003cp\u003eこの場合は1つアノテーションを発見するとreturnしてしまうので、複数バージョンも作成してみます。ポイントはOptionalを返しているところをListに変更します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSampleUsecaseImpl\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSampleUsecase\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\n\t\u003cspan class=\"token annotation punctuation\"\u003e@Misaka\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e misaka\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\n\t\u003cspan class=\"token annotation punctuation\"\u003e@Misaka\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e kuroko\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/2332/2.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003e以下のコードになります\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@Aspect\u003c/span\u003e\n\u003cspan class=\"token annotation punctuation\"\u003e@Component\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMisakaAnnotationLogic\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token annotation punctuation\"\u003e@Before\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"execution(public * com.example.demo..*.*(..))\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// demo配下の全て\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token function\"\u003ebefore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eJoinPoint\u003c/span\u003e point\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethrows\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIllegalArgumentException\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIllegalAccessException\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token comment\"\u003e// クラスを取得する\u003c/span\u003e\n\t\t\u003cspan class=\"token class-name\"\u003eClass\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e clazz \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e point\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetTarget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetClass\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token comment\"\u003e// フィールド一覧を取得する\u003c/span\u003e\n\t\t\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e fields \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e clazz\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetDeclaredFields\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token comment\"\u003e// アノテーションが付いたフィールドを取得する\u003c/span\u003e\n\t\t\u003cspan class=\"token class-name\"\u003eList\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e fieldList \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ehaveAnnotationFields\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efields\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMisaka\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e misaka \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"misaka\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e field \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e fieldList\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\tfield\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetAccessible\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\tfield\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epoint\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetTarget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e misaka\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"token annotation punctuation\"\u003e@SuppressWarnings\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"unchecked\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eList\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003ehaveAnnotationFields\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e fields\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eClass\u003c/span\u003e clazz\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token class-name\"\u003eList\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e result \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eArrayList\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eField\u003c/span\u003e field \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e fields\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eObjects\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003enonNull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efield\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetAnnotation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eclazz\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\tresult\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eadd\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efield\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e result\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e@Misakaが付与されている場合は返却リストに突っ込んでおきます\u003c/li\u003e\n\u003cli\u003e最終的に@Misakaアノテーションがついてるフィールドのみの返却リストが帰ります\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/2332/3.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003ch2\u003eその他\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003egetFieldsはprivateフィールドを取得できません。\u003c/li\u003e\n\u003cli\u003egetDeclaredFieldsは全ての修飾子のフィールドを取得できます\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e関連記事\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"/posts/p2132\"\u003eリンク\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eアノテーションを利用して独自のDIコンテナにインスタンスを登録する\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"/posts/p2307\"\u003eリンク\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eそもそもAOPについての記事\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e参考\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fpppurple.hatenablog.com%2Fentry%2F2016%2F08%2F15%2F003240\"\u003e参考\u003c/a\u003e\u003c/p\u003e","slug":"p2332"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"p2332"},"buildId":"zySuBojNZUu9-667yIcmf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>