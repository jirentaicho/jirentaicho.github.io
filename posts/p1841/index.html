<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@keisukesiratori"/><meta property="og:site_name" content="Edelstein"/><title>クリーンアーキテクチャ | 学習１</title><meta name="robots" content="index,follow"/><meta name="description" content="クリーンアーキテクチャ | 学習１"/><meta property="og:title" content="クリーンアーキテクチャ | 学習１"/><meta property="og:description" content="クリーンアーキテクチャ | 学習１"/><meta property="og:url" content="http:localhost:3000/posts/p1841"/><meta property="og:type" content="website"/><meta property="og:image" content="https://locahost:3000/undefined"/><meta property="og:image:alt" content="クリーンアーキテクチャ | 学習１"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="700"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/df6bb53438996960.css" as="style"/><link rel="stylesheet" href="/_next/static/css/df6bb53438996960.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-480c748fb908b436.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a840d570c522cf0.js" defer=""></script><script src="/_next/static/chunks/7-a9ae6bf2d6049209.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-31ed6b5e8c78747a.js" defer=""></script><script src="/_next/static/fyKT5eJ48xjFi_XzaeyzT/_buildManifest.js" defer=""></script><script src="/_next/static/fyKT5eJ48xjFi_XzaeyzT/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen bg-zinc-800"><header class="sticky top-0 border-b border-zinc-400 z-10 bg-zinc-900 text-slate-400"><div class="max-w-4xl mx-auto flex justify-between items-center h-12"><a href="/">Home</a><a target="_blank" href="https://github.com/jirentaicho">Github</a><a target="_blank" href="https://zenn.dev/misaka">Zenn</a></div></header><main class="flex-1 max-w-4xl w-full mx-auto"><div class="prose prose-lg max-w-none text-emerald-400"><h1 class="mt-12">クリーンアーキテクチャ | 学習１</h1><span>2022.04.04</span><div class="space-x-2"><span><a class="text-emerald-300" href="/categories/%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3/">アーキテクチャ</a></span></div></div></main><footer class="bg-zinc-900 text-slate-400"><div class="max-w-4xl w-full mx-auto h-24 flex items-center justify-center"><div>© volkruss.com / Edelstein</div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"クリーンアーキテクチャ | 学習１","date":"2022.04.04","description":"クリーンアーキテクチャ | 学習１","categories":["アーキテクチャ"]},"content":"\u003cp\u003eクリーンアーキテクチャについての勉強メモです。\u003c/p\u003e\n\u003cp\u003eクリーンアーキテクチャの目的は「関心事の分離」でソフトウェアをレイヤーに分割する\u003c/p\u003e\n\u003cp\u003eどんなレイヤーにわけるのか\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e企業のビジネスルール\n\u003cul\u003e\n\u003cli\u003eエンティティ企業の最重要ビジネスルールをカプセル化したものメソッドを持ったオブジェクトでも、データ構造と関数でも構わない\n\u003cul\u003e\n\u003cli\u003e企業の最重要ビジネスルールをカプセル化したもの\u003c/li\u003e\n\u003cli\u003eメソッドを持ったオブジェクトでも、データ構造と関数でも構わない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eアプリケーションのビジネスルール\n\u003cul\u003e\n\u003cli\u003eユースケースアプリケーション固有のビジネスルールエンティティに入出力するデータの流れを調整するエンティティを操作するこのレイヤーの変更はエンティティに影響を与えない\n\u003cul\u003e\n\u003cli\u003eアプリケーション固有のビジネスルール\u003c/li\u003e\n\u003cli\u003eエンティティに入出力するデータの流れを調整する\u003c/li\u003e\n\u003cli\u003eエンティティを操作する\u003c/li\u003e\n\u003cli\u003eこのレイヤーの変更はエンティティに影響を与えない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eインターフェースアダプター\n\u003cul\u003e\n\u003cli\u003eコントローラー、プレゼンター、ゲートウェイユースケースやエンティティのフォーマットから、外部エージェントに便利なフォーマットにデータを変換するアダプターモデルは以下のために利用されるデータ構造コントローラーからユースケースに渡されるユースケースからプレゼンターとビューに戻されるエンティティやユースケースのフォーマットから、データーベース用のフォーマットにデータを変換する（内側はデータベースについては何も知らない）外部サービスなどの外部形式からユースケースやエンティティが利用する内部形式にデータを変換する\n\u003cul\u003e\n\u003cli\u003eユースケースやエンティティのフォーマットから、外部エージェントに便利なフォーマットにデータを変換するアダプター\u003c/li\u003e\n\u003cli\u003eモデルは以下のために利用されるデータ構造コントローラーからユースケースに渡されるユースケースからプレゼンターとビューに戻される\u003c/li\u003e\n\u003cli\u003eエンティティやユースケースのフォーマットから、データーベース用のフォーマットにデータを変換する（内側はデータベースについては何も知らない）\u003c/li\u003e\n\u003cli\u003e外部サービスなどの外部形式からユースケースやエンティティが利用する内部形式にデータを変換する\u003c/li\u003e\n\u003cli\u003eコントローラーからユースケースに渡される\u003c/li\u003e\n\u003cli\u003eユースケースからプレゼンターとビューに戻される\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eフレームワークとドライバ\n\u003cul\u003e\n\u003cli\u003eウェブ、デバイス、DB、外部インターフェース、UIウェブ、データベースなどは詳細である\n\u003cul\u003e\n\u003cli\u003eウェブ、データベースなどは詳細である\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eクリーンアーキテクチャは以下の特性を持つ\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eフレームワーク非依存\n\u003cul\u003e\n\u003cli\u003eフレームワークをツールとして利用\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eテスト可能\n\u003cul\u003e\n\u003cli\u003eビジネスルールがどこにも依存しないため独立してテストできる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUI非依存\n\u003cul\u003e\n\u003cli\u003eウェブUIをコンソールUIに置き換える際に、ビジネスロジックの変更がいらない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eデータベース非依存\n\u003cul\u003e\n\u003cli\u003eビジネスロジックが特定のデータベースに依存しない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e外部エージェント非依存\n\u003cul\u003e\n\u003cli\u003eビジネスルールが外界のインターフェースについて何も知らない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e円図\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e円の外側が仕組み\u003c/li\u003e\n\u003cli\u003e内側が方針\u003c/li\u003e\n\u003cli\u003e内側ほどソフトウェアのレベルが上がる\u003c/li\u003e\n\u003cli\u003e4つの円である必要はない\n\u003cul\u003e\n\u003cli\u003eただし依存性のルールは守ること\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e境界線\u003c/h2\u003e\n\u003cp\u003eクリーンアーキテクチャの有名な図は、依存の方向が一方通行であり、内側の円にあるレイヤーが外側のレイヤーに触れてはいけないようになっている。\u003c/p\u003e\n\u003cp\u003eそのため境界線を越えるには依存関係逆転の原則を利用する\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eユースケースからプレゼンターを呼び出したい\n\u003cul\u003e\n\u003cli\u003eポリモーフィズムを利用して制御の流れと反対のソースコードの依存関係を生み出すユースケースの内側にインターフェースを置く(図のユースケース出力ポート)プレゼンターがそのインターフェースを実装する\u003c/li\u003e\n\u003cli\u003e例UseCase#executeからPresenter#outputを呼ぶPresenterはインターフェースPresenter層がPresenterインターフェースの実装を行う\n\u003cul\u003e\n\u003cli\u003eユースケースの内側にインターフェースを置く(図のユースケース出力ポート)\u003c/li\u003e\n\u003cli\u003eプレゼンターがそのインターフェースを実装する\u003c/li\u003e\n\u003cli\u003eUseCase#executeからPresenter#outputを呼ぶPresenterはインターフェース\u003c/li\u003e\n\u003cli\u003ePresenter層がPresenterインターフェースの実装を行う\u003c/li\u003e\n\u003cli\u003ePresenterはインターフェース\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eデータを渡す\n\u003cul\u003e\n\u003cli\u003e単純な独立したデータ構造で構成されたデータを利用する(dtoなど)関数の引数にするハッシュマップに詰める\u003c/li\u003e\n\u003cli\u003eエンティティオブジェクトやデータベースの行構造をそのまま渡すことは禁止\u003c/li\u003e\n\u003cli\u003e依存性を持ったデータ構造は渡せない\n\u003cul\u003e\n\u003cli\u003e関数の引数にする\u003c/li\u003e\n\u003cli\u003eハッシュマップに詰める\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eサンプル\u003c/h2\u003e\n\u003cp\u003eサンプルを考えて作りました。\u003c/p\u003e\n\u003cp\u003e以前作ったガチャAPIにキャラクター詳細情報取得処理を追加します。\u003c/p\u003e\n\u003ch2\u003eコントローラー\u003c/h2\u003e\n\u003cp\u003eやること\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eリクエストの内容をInputDataに変換\u003c/li\u003e\n\u003cli\u003eユースケースに処理を渡す\u003c/li\u003e\n\u003cli\u003eユースケースの結果を返却\n\u003cul\u003e\n\u003cli\u003eユースケースからプレゼンターをばず、値をコントローラーに返します\u003c/li\u003e\n\u003cli\u003eViewModelはJSON形式で返すため使わずに、OutputDataをそのまま返却しました単純なDTOなのでいいかな？\n\u003cul\u003e\n\u003cli\u003e単純なDTOなのでいいかな？\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@GetMapping\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/api/character\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token annotation punctuation\"\u003e@CrossOrigin\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterOutputData\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token annotation punctuation\"\u003e@RequestBody\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterCommand\u003c/span\u003e command\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// InputDataの作成\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eCharacterGetInputData\u003c/span\u003e inputData \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterGetInputData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecommand\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetCharacter_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e//　UseCaseの実行\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eCharacterOutputData\u003c/span\u003e outputData \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003echaracterGetUseCase\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eexecute\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einputData\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Json形式で返すのでViewModelは作成せず返します\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e outputData\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4\u003eInputData\u003c/h4\u003e\n\u003cp\u003eリクエストの内容を上位レイヤーに渡すためのDTOです。やることがシンプルなので実装もシンプルになりました。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@Data\u003c/span\u003e\n\u003cspan class=\"token annotation punctuation\"\u003e@AllArgsConstructor\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterGetInputData\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e id\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eユースケース\u003c/h2\u003e\n\u003cp\u003eやること\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eリポジトリからキャラクターを取得する\n\u003cul\u003e\n\u003cli\u003eリポジトリの実装についてはユースケースでは全く知らない状況です\u003c/li\u003e\n\u003cli\u003eキャラクターはEntityですが特段ドメイン要素が今のところ無いですが、一応Entityの位置にいます。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eOutputDataにしてコントローラーに返す\n\u003cul\u003e\n\u003cli\u003e今回はプレゼンターを呼ばすに値を返しています。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@Component\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterGetUseCaseImpl\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterGetUseCase\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"token annotation punctuation\"\u003e@Autowired\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterRepository\u003c/span\u003e characterRepository\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token annotation punctuation\"\u003e@Override\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterOutputData\u003c/span\u003e \u003cspan class=\"token function\"\u003eexecute\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eCharacterGetInputData\u003c/span\u003e inputData\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// キャラクターの取得\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eCharacter\u003c/span\u003e character \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003echaracterRepository\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efindById\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einputData\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetId\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// OutPutDataの作成と返却\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// OutputBoundaryの呼出しをせずに、値を返しています。\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterOutputData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003echaracter\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003echaracter\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetLank\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eリポジトリ\u003c/h2\u003e\n\u003cp\u003eJPAを使っていますが、実装クラスを別の機能に差し替えることもできます。\u003c/p\u003e\n\u003cp\u003eインターフェース\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterRepository\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eList\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eCharacter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003egetCharacters\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eCharacter\u003c/span\u003e \u003cspan class=\"token function\"\u003efindById\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e user_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e実装クラス\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@Repository\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterRepositoryImpl\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterRepository\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"token annotation punctuation\"\u003e@Autowired\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterJpaRepository\u003c/span\u003e characterJpaRepository\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token annotation punctuation\"\u003e@Override\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eList\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eCharacter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003egetCharacters\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003echaracterJpaRepository\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efindAll\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token annotation punctuation\"\u003e@Override\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacter\u003c/span\u003e \u003cspan class=\"token function\"\u003efindById\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e user_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003echaracterJpaRepository\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efindById\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eorElseThrow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4\u003eトランザクション\u003c/h4\u003e\n\u003cp\u003eところでトランザクションはどのようにして扱うのか？\u003c/p\u003e\n\u003cp\u003e今回のケースではトランザクション処理は必要ないかもしれませんが、もしもトランザクションが必要となるケースに遭遇した場合はどうすればいいのか？\u003c/p\u003e\n\u003cp\u003eUseCase側でトランザクションを開始することを明示できればいいかなと。今回はアノテーションを利用してみることにしました。これならソースコード側にトランザクションコードが入り込まないで良いかと思います。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@Override\u003c/span\u003e\n    \u003cspan class=\"token annotation punctuation\"\u003e@Transactional\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterOutputData\u003c/span\u003e \u003cspan class=\"token function\"\u003eexecute\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eCharacterGetInputData\u003c/span\u003e inputData\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// キャラクターの取得\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eCharacter\u003c/span\u003e character \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003echaracterRepository\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efindById\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einputData\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetId\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// OutPutDataの作成と返却\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// OutputBoundaryの呼出しをせずに、値を返しています。\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCharacterOutputData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003echaracter\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003echaracter\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetLank\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eただデータベースの処理が入り込んでしまっていると思いますので、以下のサイトのようにUsecaseからトランザクションを管理できるクラスを呼び出すのも良いと思いした。\u003c/p\u003e\n\u003cp\u003ehttps://jpcodeqa.com/q/a680d2d59fab12a8b8dc326cbd9ae05e\u003c/p\u003e\n\u003cp\u003e他にも以下のサイトが参考になります\u003c/p\u003e\n\u003cp\u003ehttp://blog.cleancoder.com/uncle-bob/2016/01/04/ALittleArchitecture.html\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBusinessRule(Usecase)クラスでSomething(Entity)というエンティティを操作します\u003c/li\u003e\n\u003cli\u003egateway(Repository)を通じてトランザクションを管理します\u003c/li\u003e\n\u003cli\u003egatewayを通じてデータを永続化します\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e結果\u003c/h2\u003e\n\u003cp\u003ePostmanで確認して想定通り結果が取得できました。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/1841/1.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003ch2\u003eテスト\u003c/h2\u003e\n\u003cp\u003eビジネスルールがどこにも依存してないため、テストが独立してできる※以下の記事でテストしています\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/posts/p1826\"\u003eリンク\u003c/a\u003e\u003c/p\u003e\n\u003ch4\u003eUseCaseがPresenterを呼ばずにコントローラーに値を返すようにした\u003c/h4\u003e\n\u003cp\u003e参考\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fizumisy.work%2Fentry%2F2019%2F12%2F12%2F000521\"\u003e参考\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e次はサンプルっぽいプロジェクトを探してリーディングしてみたいと思います。\u003c/p\u003e","slug":"p1841"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"p1841"},"buildId":"fyKT5eJ48xjFi_XzaeyzT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>