---
title: TERASOLUNAã®Todoã‚’SpringBootã§ã‚„ã£ã¦ã¿ã‚‹
date: 2021.12.10
description: TERASOLUNAã®Todoã‚’SpringBootã§ã‚„ã£ã¦ã¿ã‚‹
categories: ['Spring']
---

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ã‚„ã‚Šã¾ã™spring bootã§ä½œã‚Šã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯jpaã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯ä»¥ä¸‹ã®ç’°å¢ƒã§ã™

ã—ã‹ã—sts3.9ã¨ã„ã†ã®ã¯ã€ã‚‚ã†100å¹´ãã‚‰ã„å‰ã®ã‚‚ã®ã§ã€ç§ã®ç’°å¢ƒã¯4.10ãªã®ã§ã‚µãƒ¼ãƒãƒ¼ãŒåŒå°ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãã®ãŸã‚SpringBootAppã¨ã—ã¦ä½œæˆã—ã¾ã™ã€‚

ä»Šå›ã®ç’°å¢ƒ

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯Githubã«ã‚ã’ã¦ã¾ã™ã€‚ã“ã®è¨˜äº‹ã®å†…å®¹ã¯ã‚¿ã‚°ãŒfirstã§ã™ã€‚

## å‹•ä½œç¢ºèª


ã¾ãšã¯å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯å‹•ä½œç¢ºèªã¾ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’mvnã§ä½œã‚‹ã®ã§è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ãŒã“ã“ã§ã¯æ‰‹å‹•ã§ä½œæˆã—ã¾ã™ã€‚

ã„ã¤ã‚‚é€šã‚Šæ–°è¦ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚Mavenã‚’é¸æŠã—ã¦ä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä»¥ä¸‹

![ç”»åƒ](/551/1.png)


### ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆ


```java
package com.volkruss.mytodo.app.welcome;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

import java.text.DateFormat;
import java.util.Date;
import java.util.Locale;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@Controller
public class HelloController {
	
	private static final Logger logger = LoggerFactory.getLogger(HelloController.class);
	
	@GetMapping("/")
	public String home(Locale locale, Model model) {
		logger.info("Welcome home! The client locale is {}.",locale);
		
		DateFormat dateFormat = DateFormat.getDateTimeInstance(
				DateFormat.LONG,DateFormat.LONG, locale);
		
		String formattedDate = dateFormat.format(new Date());
		model.addAttribute("serverTime", formattedDate);
		
		return "welcome/home";
	}

}
```


### ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆ


```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <head>
        <title>STS3.9ï½—ï½—ï½—ï½—ï½—ï½—ï½—</title>
    </head>
    <body>
        <div id="wrapper">
        	<h1>Hello world!</h1>
        	<p th:text="${serverTime}"></p>
    	</div>
    </body>
</html>
```


ç¢ºèªã—ã¾ã™

![ç”»åƒ](/551/2.png)


ãƒ­ã‚°ã‚‚infoãƒ¬ãƒ™ãƒ«ã§å‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™
```
[2m2021-12-10 10:28:30.709[0;39m [32m INFO[0;39m [35m4408[0;39m [2m---[0;39m [2m[nio-8080-exec-4][0;39m [36mc.v.mytodo.app.welcome.HelloController [0;39m [2m:[0;39m Welcome home! The client locale is ja.
```

TODOã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ

ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã‚’æ··ãœãŸã®ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§ä½œæˆã—ã¾ã™ã€‚

ãªã‚“ã§ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¨ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ãŒæ··ã–ã‚‹ã‚“ã ã‚ˆã£ã¦ã®ã¯ã“ã“ã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚

### ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ


Todoã¨ã„ã†ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚lombokã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

```java
package com.volkruss.mytodo.domain.model;

import java.io.Serializable;
import java.util.Date;

import lombok.Getter;
import lombok.Setter;

@Setter
@Getter
public class Todo implements Serializable{

	private static final long serialVersionUID = 1L;
	
	private String todoId;
	
	private String todoTitle;
	
	private boolean finished;
	
	private Date createdAt;
}
```


### Repositoryã®ä½œæˆ


ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã†ãªã‚‰ã‚ãƒ¼ã ã“ãƒ¼ã è¨€ã‚ã‚Œã‚‹ã®ã§ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ä¿®æ­£ã—ã¦ãŠãã¾ã™ã€‚

```java
package com.volkruss.mytodo.domain.model;

import java.io.Serializable;
import java.util.Date;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;
import javax.persistence.Temporal;
import javax.persistence.TemporalType;

import lombok.Getter;
import lombok.Setter;

@Entity
@Table(name="todo")
@Setter
@Getter
public class Todo implements Serializable{

	private static final long serialVersionUID = 1L;
	
	@Id
	@Column(name="todo_id")
	private String todoId;
	
	@Column(name="todo_title")
	private String todoTitle;
	
	@Column(name="finished")
	private boolean finished;
	
	@Temporal(TemporalType.TIMESTAMP)
	@Column(name="created_at")
	private Date createdAt;
}
```


ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯Mapã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ä»Šå›ã¯DBã‚’ä½¿ã„ã¾ã™ã€‚ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯RepositoryImplã¨ã—ã¦å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’è¨­ã‘ã¦ã„ã‚‹ã®ã§ã™ãŒã€jpaã‚’ä½¿ã†ã®ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã•ãˆç”¨æ„ã§ãã‚Œã°è‰¯ã•ãã†ã«è¦‹ãˆã¾ã™ãŒã€çµ‚äº†ã—ãŸã‚¿ã‚¹ã‚¯ã®ä»¶æ•°ã‚’æ•°ãˆã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ãªã©ãŒã‚ã‚‹ã®ã§å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£ãŒå…¥ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

```java
package com.volkruss.mytodo.domain.repository.todo;
import org.springframework.data.jpa.repository.JpaRepository;
import com.volkruss.mytodo.domain.model.Todo;

public interface TodoRepository extends JpaRepository<Todo, String>{
}
```


### Serviceã®ä½œæˆ


æ¥­å‹™å‡¦ç†ã‚’è¡Œã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¾ã™ã€‚æ¥­å‹™å‡¦ç†ã¨è¨€ã£ã¦ã‚‚todoãªã®ã§å°‘ãªã„ã§ã™ãŒ

ã¾ãšã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚

```java
package com.volkruss.mytodo.domain.service.todo;

import java.util.Collection;

import com.volkruss.mytodo.domain.model.Todo;

public interface TodoService {
	
	Collection<Todo> findAll();
	
	Todo create(Todo todo);
	
	Todo finish(String todoId);
	
	void delete(String todoId);
	
}
```


å®šç¾©ã—ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™

æœ¬å ´ã§ã¯ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¤ã„ã¦ã¯terasoluna.gfw.commonã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã—ãŸãŒã€å…¥ã‚Œã¦ãªã„ã®ã§ä¸€æ—¦ã‚¹ãƒ«ãƒ¼ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸinjectã¨ã¯autowiredã«å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚

```java
package com.volkruss.mytodo.domain.service.todo;

import java.util.Collection;
import java.util.Date;
import java.util.Optional;
import java.util.UUID;

import javax.transaction.Transactional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.volkruss.mytodo.domain.model.Todo;
import com.volkruss.mytodo.domain.repository.todo.TodoRepository;

@Service
// å…¬é–‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã™ã¹ã¦ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ã™ã‚‹
@Transactional
public class TodoServiceImpl implements TodoService {

	private static final long MAX_UNFINISHED_COUNT = 5;
	
	@Autowired
	private TodoRepository todoRepositroy;
	
	@Override
	public Collection<Todo> findAll() {
		return todoRepositroy.findAll();
	}

	@Override
	public Todo create(Todo todo) {
		long unfinishedCount = todoRepositroy.count();
		if(unfinishedCount >= MAX_UNFINISHED_COUNT) {
			// TODO
			System.out.println("ã‚¨ãƒ©ãƒ¼");
		}
		
		// ä¸€æ„æ€§ã®ã‚ã‚‹å€¤ã‚’ç”Ÿæˆã™ã‚‹
		String todoId = UUID.randomUUID().toString();
		Date createdAt = new Date();
		todo.setTodoId(todoId);
		todo.setCreatedAt(createdAt);
		todo.setFinished(false);
		
		todoRepositroy.save(todo);
		return todo;
	}

	@Override
	public Todo finish(String todoId) {
		Todo todo = findOne(todoId);
		todo.setFinished(true);
		todoRepositroy.save(todo);
		return todo;
	}

	@Override
	public void delete(String todoId) {
		Todo todo = findOne(todoId);
		todoRepositroy.delete(todo);
	}

	private Todo findOne(String taskId) {
		Optional<Todo> todo = todoRepositroy.findById(taskId);
		return todo.orElseThrow();
	}
}
```


## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ä½œæˆ


ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãŒä½œæˆã§ããŸã®ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‚’ä½œæˆã—ã¾ã™

### Controllerã®ä½œæˆ


ã¾ãšã¯ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ãã®å¾Œformã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ãƒ¡ã‚½ãƒƒãƒ‰ã¯å¾Œã‹ã‚‰ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

```java
package com.volkruss.mytodo.app.todo;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
// å…¨ã¦ã®ãƒ‘ã‚¹ã¯todoä»¥ä¸‹ã«ãªã‚‹
@RequestMapping("/todo")
public class TodoController {
	
}

```


### Formã‚¯ãƒ©ã‚¹ã®ä½œæˆ


```html
package com.volkruss.mytodo.app.todo;

import java.io.Serializable;

import lombok.Getter;
import lombok.Setter;

@Getter
@Setter
public class TodoForm implements Serializable{

	private static final long serialVersionUID = 1L;

	private String todoTitle;

}
```


### ä¸€è¦§è¡¨ç¤º


ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«ä¸€è¦§è¡¨ç¤ºç”¨ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨æ„ã—ã¾ã™ã€‚ã¾ãŸformã¯ç™»å ´ã—ãªã„ã®ã§ä¸€æ—¦ã“ã“ã§ã¯æ”¾ç½®ã—ã¾ã™ã€‚

```java
package com.volkruss.mytodo.app.todo;

import java.util.Collection;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import com.volkruss.mytodo.domain.model.Todo;
import com.volkruss.mytodo.domain.service.todo.TodoService;

@Controller
// å…¨ã¦ã®ãƒ‘ã‚¹ã¯todoä»¥ä¸‹ã«ãªã‚‹
@RequestMapping("/todo")
public class TodoController {
	
	@Autowired
	private TodoService todoService;
	
	@GetMapping("/list")
	public String list(Model model) {
		Collection<Todo> todos = todoService.findAll();
		model.addAttribute("todos", todos);
		return "todo/list";
	}
	
}
```


/todo/listã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§todoã®ä¸€è¦§ã‚’å–å¾—ã§ãã¾ã™ã€‚æ¬¡ã«viewã‚’ä½œæˆã—ã¾ã™

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <head>
        <title>ã‚¿ã‚¹ã‚¯ä¸€è¦§</title>
    </head>
    <body>
        <div id="wrapper">
        	<h1>ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ</h1>
        	<ul th:each="todo : ${todos}">
        		<li th:text="${todo.todoTitle}"></li>
        	</ul>
    	</div>
    </body>
</html>
```


ä¸€æ™‚çš„ã«todoã‚’è¡¨ç¤ºã•ã›ã‚ˆã†ãœã£ã¦ã“ã¨ã§ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã‚„ã£ã¦ã¾ã™ãŒã€ç§ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¿®æ­£ã—ã¾ã™ã€‚ï¼ˆå¾Œã§ã¾ãŸæˆ»ã—ã¾ã™ï¼‰

```java
package com.volkruss.mytodo.app.todo;

import java.util.Collection;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import com.volkruss.mytodo.domain.model.Todo;
import com.volkruss.mytodo.domain.service.todo.TodoService;

@Controller
// å…¨ã¦ã®ãƒ‘ã‚¹ã¯todoä»¥ä¸‹ã«ãªã‚‹
@RequestMapping("/todo")
public class TodoController {
	
	@Autowired
	private TodoService todoService;
	
	@GetMapping("/list")
	public String list(Model model) {
		//Collection<Todo> todos = todoService.findAll();
		Todo todo1 = new Todo();
		todo1.setTodoId("1");
		todo1.setTodoTitle("ã‚®ãƒ£ãƒ«ã‚²ãƒ¼ã‚’è²·ã†");
		
		Todo todo2 = new Todo();
		todo2.setTodoId("2");
		todo2.setTodoTitle("ã‚²ãƒ¼ãƒãƒ¼ã‚ºã«è¡Œã");
		
		Todo todo3 = new Todo();
		todo3.setTodoId("3");
		todo3.setTodoTitle("K-Booksã«è¡Œã");
		
		Collection<Todo> todos = List.of(todo1,todo2,todo3);
		
		model.addAttribute("todos", todos);
		return "todo/list";
	}
}
```


![ç”»åƒ](/551/3.png)


### Create TODOã®å®Ÿè£…


todoã‚’ä½œæˆã™ã‚‹å‡¦ç†ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®è¨˜è¼‰ã‚’å…ƒã«æˆ»ã—ã¦ãŠãã¾ã™ã€‚

ãƒãƒƒãƒ”ãƒ³ã‚°å‡¦ç†ã‚’è¡Œã†ã®ã§pomã«è¿½è¨˜ã—ã¾ã™ã€‚ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯com.github.dozermapperã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

```html
		<dependency>
			<groupId>org.modelmapper</groupId>
			<artifactId>modelmapper</artifactId>
			<version>2.4.2</version>
		</dependency>
```


ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä¿®æ­£ã™ã‚‹

```html
package com.volkruss.mytodo.app.todo;

import java.util.Collection;
import java.util.Objects;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import com.volkruss.mytodo.domain.model.Todo;
import com.volkruss.mytodo.domain.service.todo.TodoService;

@Controller
// å…¨ã¦ã®ãƒ‘ã‚¹ã¯todoä»¥ä¸‹ã«ãªã‚‹
@RequestMapping("/todo")
public class TodoController {
	
	@Autowired
	private TodoService todoService;

	@GetMapping("/list")
	public String list(Model model) {
		Collection<Todo> todos = todoService.findAll();

		// ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ã™ã‚‹
		String resultMessage = (String) model.getAttribute("result");
		if(Objects.nonNull(resultMessage)) {
			model.addAttribute("result",resultMessage);
		}
		
		model.addAttribute("todos", todos);
		return "todo/list";
	}
	
	@PostMapping("/create")
	public String create(@Validated @ModelAttribute("todoForm") TodoForm todoForm, BindingResult bindingResult,Model model, RedirectAttributes attributes) {
		
		if(bindingResult.hasErrors()) {
			return list(model);
		}
		ModelMapper mapper = new ModelMapper();
		Todo todo = mapper.map(todoForm, Todo.class);
		
		todoService.create(todo);
		
		//resultã¨ã„ã†keyã§ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã™ã‚‹
		attributes.addFlashAttribute("result","Created successfully!");
		//ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
		return "redirect:/todo/list";
	}
}
```


#### @Validated


Formã‚¯ãƒ©ã‚¹ã§@NotNullãªã©ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã§ã€ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç°¡å˜ã«å®Ÿæ–½ã§ãã¾ã™ã€‚ãã®æ™‚ã«å—ã‘å–ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚¯ãƒ©ã‚¹ã§@Validatedã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ãŠãã“ã¨ã§ã€Formã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿæ–½ã•ã‚Œã¾ã™ã€‚

#### BindingResult


ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã—ãŸçµæœã€ã‚¨ãƒ©ãƒ¼ã¨ã‹ãŒã‚ã‚Œã°hasErrorsã§å–å¾—ã§ãã¾ã™ã€‚

#### @ModelAttribute


ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å†…å®¹ã‚’ModelAttributeã§æŒ‡å®šã—ãŸã‚¯ãƒ©ã‚¹ã«ã‚»ãƒƒãƒˆã§ãã¾ã™ã€‚å±æ€§åã‚’ä»˜ã‘ã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ãŒã€ã©ã£ã¡ã§ã‚‚è‰¯ã•ãã†ãªæ„Ÿã˜ãŒã—ã¾ã™ã€‚

#### RedirectAttributes


ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã¨ãã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä»˜ä¸ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã€å¼•æ•°ã«æŒã£ã¦ã„ã¾ã™ã€‚ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä»˜ä¸ã—ã¦ã„ã¾ã™ã€‚TERASOLUNAã®messagesPanelã¯ä½¿ã‚ãšã«ã‚„ã‚Šã¾ã™ã€‚

#### ModelMapper


åŒã˜åç§°ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‹æ‰‹ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦ãã‚Œã¾ã™ã€‚

### ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹


ãƒ•ã‚©ãƒ¼ãƒ ã«ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ç°¡å˜ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã‚ˆã†ã«ã™ã‚‹ã€‚ã¾ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã®ã§pomã‚’ä¿®æ­£ã™ã‚‹

```html
  <dependency>
    <groupId>org.hibernate.validator</groupId>
    <artifactId>hibernate-validator</artifactId>
    <version>6.0.9.Final</version>
  </dependency>
```


```java
package com.volkruss.mytodo.app.todo;

import java.io.Serializable;

import javax.validation.constraints.NotNull;
import javax.validation.constraints.Size;

import lombok.Getter;
import lombok.Setter;

@Getter
@Setter
public class TodoForm implements Serializable{

	private static final long serialVersionUID = 1L;
	
	@NotNull
	@Size
	private String todoTitle;

}
```


htmlã‚’ä¿®æ­£ã—ã¾ã™ã€‚ä¸€è¦§ç”»é¢ã®ä¸Šéƒ¨ã«ç™»éŒ²ã‚¨ãƒªã‚¢ã‚’è¨­ã‘ã¾ã™ã€‚

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <head>
        <title>ã‚¿ã‚¹ã‚¯ä¸€è¦§</title>
    </head>
    <body>
        <div id="wrapper">
        	<div>
        		<th:block th:text="${result}"></th:block>
        		<form th:object="${todoForm}" th:action="@{/todo/create}" th:method="post">
        			 <input type="text" name ="todoTitle">
        			 <button>é€ä¿¡</button>
        		</form>
        	</div>
        	<h1>ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ</h1>
        	<ul th:each="todo : ${todos}">
        		<li th:text="${todo.todoTitle}"></li>
        	</ul>
    	</div>
    </body>
</html>

```


ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯<th:block th:text=â€${result}â€></th:block>ã¨ã„ã†ã§ã€nullã®å ´åˆã¯è¡¨ç¤ºã•ã‚Œãªã„ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

inputã®nameå±æ€§ã¯formã‚¯ãƒ©ã‚¹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¨åŒã˜ã«ã—ã¾ã™ã€‚

![ç”»åƒ](/551/4.png)


æœ¬å½“ã¯ã“ã“ã§çµ‚äº†ã—ã¦ã„ã‚‹ã‚¿ã‚¹ã‚¯ã‚’é™¤ã„ã¦ï¼•ä»¶ä»¥ä¸Šã‚ã£ãŸå ´åˆã¯ãƒ€ãƒ¡ã£ã¦ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã—ã¦ã„ã¾ã™ãŒã€ä¸€æ—¦æ”¾ç½®ã—ã¾ã™ã€‚

## Finish TODOã®å®Ÿè£…


formã‚¯ãƒ©ã‚¹ã«todIdã‚’ä»˜ä¸ã—ã¦finishã‹ã‚‰åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ãã®æ™‚ã«groupsã‚’è¨­å®šã—ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‹ã©ã†ã‹ã‚’æ±ºå®šã—ã¾ã™

ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®æ–¹ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

```html
package com.volkruss.mytodo.app.todo;

import java.io.Serializable;

import javax.validation.constraints.NotEmpty;
import javax.validation.constraints.Size;

import lombok.Getter;
import lombok.Setter;

@Getter
@Setter
public class TodoForm implements Serializable{
	
	// å…¥åŠ›ãƒã‚§ãƒƒã‚¯ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã‚’ã™ã‚‹ãŸã‚ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚
	public static interface TodoCreate{
		
	};
	
	public static interface TodoFinish{
		
	};

	private static final long serialVersionUID = 1L;
	
	@NotEmpty(groups = {TodoFinish.class})
	private String todoId;
	
	@NotEmpty(groups = {TodoCreate.class})
	@Size(min=2, max=30, groups = {TodoCreate.class})
	private String todoTitle;

}
```


ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä¿®æ­£ã—ã¾ã™

ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã®ä»˜ä¸ãªã©ã¯ç™»éŒ²ã¨åŒã˜ã§ã™ã€‚ãƒã‚¤ãƒ³ãƒˆã¯ã€@Validated({Default.class,TodoFinish.class})ã¨ã™ã‚‹ã“ã¨ã§ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹éš›ã®ã‚¯ãƒ©ã‚¹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

```java
package com.volkruss.mytodo.app.todo;

import java.util.Collection;
import java.util.Objects;

import javax.validation.groups.Default;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import com.volkruss.mytodo.app.todo.TodoForm.TodoCreate;
import com.volkruss.mytodo.app.todo.TodoForm.TodoFinish;
import com.volkruss.mytodo.domain.model.Todo;
import com.volkruss.mytodo.domain.service.todo.TodoService;

@Controller
// å…¨ã¦ã®ãƒ‘ã‚¹ã¯todoä»¥ä¸‹ã«ãªã‚‹
@RequestMapping("/todo")
public class TodoController {
	
	@Autowired
	private TodoService todoService;

	@GetMapping("/list")
	public String list(Model model) {
		Collection<Todo> todos = todoService.findAll();

		// ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ã™ã‚‹
		String resultMessage = (String) model.getAttribute("result");
		if(Objects.nonNull(resultMessage)) {
			model.addAttribute("result",resultMessage);
		}
		
		model.addAttribute("todos", todos);
		return "todo/list";
	}
	
	@PostMapping("/create")
	public String create(@Validated({Default.class,TodoCreate.class}) @ModelAttribute("todoForm") TodoForm todoForm, BindingResult bindingResult,Model model, RedirectAttributes attributes) {
		
		if(bindingResult.hasErrors()) {
			return list(model);
		}
		ModelMapper mapper = new ModelMapper();
		Todo todo = mapper.map(todoForm, Todo.class);
		
		todoService.create(todo);
		
		//resultã¨ã„ã†keyã§ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã™ã‚‹
		attributes.addFlashAttribute("result","Created successfully!");
		//ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
		return "redirect:/todo/list";
	}
	
	@PostMapping("/finish")
	public String finish(
			@Validated({Default.class,TodoFinish.class}) TodoForm form,BindingResult bindingResult, Model model,
			RedirectAttributes attributes) {
		if(bindingResult.hasErrors()) {
			return list(model);
		}
		todoService.finish(form.getTodoId());
		
		//resultã¨ã„ã†keyã§ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã™ã‚‹
		attributes.addFlashAttribute("result","Finished  successfully!");
		//ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
		return "redirect:/todo/list";
		
	}
}
```


ãƒ“ãƒ¥ãƒ¼ã‚‚ç·¨é›†ã—ã¾ã™ã€‚finishã«ã¯todoIdã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã®ã§ã€ãã‚Œã¯inputè¦ç´ ã®hiddenã«ã¦è¨­å®šã—ã¦ã—ã¾ãˆã°OKã§ã™

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <head>
        <title>ã‚¿ã‚¹ã‚¯ä¸€è¦§</title>
    </head>
    <body>
        <div id="wrapper">
        	<div>
        		<th:block th:text="${result}"></th:block>
        		<form th:object="${todoForm}" th:action="@{/todo/create}" th:method="post">
        			 <input type="text" name ="todoTitle">
        			 <button>é€ä¿¡</button>
        		</form>
        	</div>
        	<h1>ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ</h1>
        	<ul th:each="todo : ${todos}">
        		<li th:text="${todo.todoTitle}"></li>
				<!-- å®Œäº†ã—ãŸå ´åˆã¯å®Œäº†ã‚’ä»˜ã‘ã‚‹ -->
					<th:block th:if="${todo.finished == true}">
					    <span>å®Œäº†</span><!-- è¡¨ç¤ºã•ã‚Œã‚‹-->
					</th:block>
					<!-- å®Œäº†ãƒœã‚¿ãƒ³ã¯input hiddenã§è¦ç´ ã‚’ã¤ã‘ã‚‹ -->
					<form th:object="${todoForm}" th:action="@{/todo/finish}" th:method="post">
						<input type="hidden" name="todoId" th:value="${todo.todoId}">
						<button>FINISH</button>
					</form>
				
        	</ul>
    	</div>
    </body>
</html>
```


![ç”»åƒ](/551/5.png)


## Delete TODOã®å®Ÿè£…


å‰Šé™¤å‡¦ç†ã‚‚finishã¨åŒã˜è¦é ˜ã§ã™ã€‚

ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä¿®æ­£ã™ã‚‹

```java
package com.volkruss.mytodo.app.todo;

import java.io.Serializable;

import javax.validation.constraints.NotEmpty;
import javax.validation.constraints.Size;

import lombok.Getter;
import lombok.Setter;

@Getter
@Setter
public class TodoForm implements Serializable{
	
	// å…¥åŠ›ãƒã‚§ãƒƒã‚¯ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã‚’ã™ã‚‹ãŸã‚ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚
	public static interface TodoCreate{
		
	};
	
	public static interface TodoFinish{
		
	};

	public static interface TodoDelete{
		
	};
	
	private static final long serialVersionUID = 1L;
	
	@NotEmpty(groups = {TodoFinish.class, TodoDelete.class})
	private String todoId;
	
	@NotEmpty(groups = {TodoCreate.class})
	@Size(min=2, max=30, groups = {TodoCreate.class})
	private String todoTitle;
	
}

```


ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä¿®æ­£ã™ã‚‹

ã‚„ã‚‹ã“ã¨ã¯ä¸€ç·’ã§ã™ã€‚

```java
package com.volkruss.mytodo.app.todo;

import java.util.Collection;
import java.util.Objects;

import javax.validation.groups.Default;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import com.volkruss.mytodo.app.todo.TodoForm.TodoCreate;
import com.volkruss.mytodo.app.todo.TodoForm.TodoDelete;
import com.volkruss.mytodo.app.todo.TodoForm.TodoFinish;
import com.volkruss.mytodo.domain.model.Todo;
import com.volkruss.mytodo.domain.service.todo.TodoService;

@Controller
// å…¨ã¦ã®ãƒ‘ã‚¹ã¯todoä»¥ä¸‹ã«ãªã‚‹
@RequestMapping("/todo")
public class TodoController {
	
	@Autowired
	private TodoService todoService;

	@GetMapping("/list")
	public String list(Model model) {
		Collection<Todo> todos = todoService.findAll();

		// ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ã™ã‚‹
		String resultMessage = (String) model.getAttribute("result");
		if(Objects.nonNull(resultMessage)) {
			model.addAttribute("result",resultMessage);
		}
		
		model.addAttribute("todos", todos);
		return "todo/list";
	}
	
	@PostMapping("/create")
	public String create(@Validated({Default.class,TodoCreate.class}) @ModelAttribute("todoForm") TodoForm todoForm, BindingResult bindingResult,Model model, RedirectAttributes attributes) {
		
		if(bindingResult.hasErrors()) {
			return list(model);
		}
		ModelMapper mapper = new ModelMapper();
		Todo todo = mapper.map(todoForm, Todo.class);
		
		todoService.create(todo);
		
		//resultã¨ã„ã†keyã§ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã™ã‚‹
		attributes.addFlashAttribute("result","Created successfully!");
		//ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
		return "redirect:/todo/list";
	}
	
	@PostMapping("/finish")
	public String finish(
			@Validated({Default.class,TodoFinish.class}) TodoForm form,BindingResult bindingResult, Model model,
			RedirectAttributes attributes) {
		if(bindingResult.hasErrors()) {
			return list(model);
		}
		todoService.finish(form.getTodoId());
		
		//resultã¨ã„ã†keyã§ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã™ã‚‹
		attributes.addFlashAttribute("result","Finished  successfully!");
		//ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
		return "redirect:/todo/list";
	}
	
	@PostMapping("delete")
	public String delete(
		@Validated({Default.class,TodoDelete.class}) TodoForm form,
		BindingResult bindingResult, Model model,
		RedirectAttributes attributes
			) {
		
		if(bindingResult.hasErrors()) {
			return list(model);
		}
		
		todoService.delete(form.getTodoId());
		
		//resultã¨ã„ã†keyã§ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã™ã‚‹
		attributes.addFlashAttribute("result","Deleted   successfully!");
		//ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
		return "redirect:/todo/list";	
	}
}

```


ãƒ“ãƒ¥ãƒ¼ã‚’ä¿®æ­£ã™ã‚‹

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <head>
        <title>ã‚¿ã‚¹ã‚¯ä¸€è¦§</title>
    </head>
    <body>
        <div id="wrapper">
        	<div>
        		<th:block th:text="${result}"></th:block>
        		<form th:object="${todoForm}" th:action="@{/todo/create}" th:method="post">
        			 <input type="text" name ="todoTitle">
        			 <button>é€ä¿¡</button>
        		</form>
        	</div>
        	<h1>ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ</h1>
        	<ul th:each="todo : ${todos}">
        		<li th:text="${todo.todoTitle}"></li>
				<!-- å®Œäº†ã—ãŸå ´åˆã¯å®Œäº†ã‚’ä»˜ã‘ã‚‹ -->
					<th:block th:if="${todo.finished == true}">
					    <span>å®Œäº†</span><!-- è¡¨ç¤ºã•ã‚Œã‚‹-->
					</th:block>
					<!-- å®Œäº†ãƒœã‚¿ãƒ³ã¯input hiddenã§è¦ç´ ã‚’ã¤ã‘ã‚‹ -->
					<form th:object="${todoForm}" th:action="@{/todo/finish}" th:method="post">
						<input type="hidden" name="todoId" th:value="${todo.todoId}">
						<button>FINISH</button>
					</form>
					<!-- å‰Šé™¤ãƒœã‚¿ãƒ³ã€€-->
					<form th:object="${todoForm}" th:action="@{/todo/delete}" th:method="post">
						<input type="hidden" name="todoId" th:value="${todo.todoId}">
						<button>DELETE</button>
					</form>
				
        	</ul>
    	</div>
    </body>
</html>
```


ã†ã¾ãå‹•ä½œã—ã¾ã™

![ç”»åƒ](/551/6.png)


æœ¬å½“ã¯ï¼•ä»¶ä»¥ä¸Šãªã‚‰ã‚ãƒ¼ã ã“ãƒ¼ã ã¨ã„ã†ãƒ­ã‚¸ãƒƒã‚¯ãŒå…¥ã‚‹ã®ã§ã™ãŒã€ä¸€æ—¦ã“ã“ã¾ã§ã§ä¸»è»¸ã¨ãªã‚‹ã“ã¨ã¯SpringBootã¨jpaã§å®Ÿè£…ã§ãã¾ã—ãŸã€‚
