<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@keisukesiratori"/><meta property="og:site_name" content="Edelstein"/><title>ソースで理解するWordPressの起動処理 ２</title><meta name="robots" content="index,follow"/><meta name="description" content="ソースで理解するWordPressの起動処理 ２"/><meta property="og:title" content="ソースで理解するWordPressの起動処理 ２"/><meta property="og:description" content="ソースで理解するWordPressの起動処理 ２"/><meta property="og:url" content="http:localhost:3000/posts/p769"/><meta property="og:type" content="website"/><meta property="og:image" content="https://locahost:3000/undefined"/><meta property="og:image:alt" content="ソースで理解するWordPressの起動処理 ２"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="700"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/df6bb53438996960.css" as="style"/><link rel="stylesheet" href="/_next/static/css/df6bb53438996960.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-480c748fb908b436.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a840d570c522cf0.js" defer=""></script><script src="/_next/static/chunks/7-a9ae6bf2d6049209.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-31ed6b5e8c78747a.js" defer=""></script><script src="/_next/static/J_6bGXgj6-te2jiJiU_T5/_buildManifest.js" defer=""></script><script src="/_next/static/J_6bGXgj6-te2jiJiU_T5/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen bg-zinc-800"><header class="sticky top-0 border-b border-zinc-400 z-10 bg-zinc-900 text-slate-400"><div class="max-w-4xl mx-auto flex justify-between items-center h-12"><a href="/">Home</a><a target="_blank" href="https://github.com/jirentaicho">Github</a><a target="_blank" href="https://zenn.dev/misaka">Zenn</a></div></header><main class="flex-1 max-w-4xl w-full mx-auto"><div class="prose prose-lg max-w-none text-emerald-400"><h1 class="mt-12">ソースで理解するWordPressの起動処理 ２</h1><span>2021.12.26</span><div class="space-x-2"><span><a class="text-emerald-300" href="/categories/WordPress/">WordPress</a></span></div></div></main><footer class="bg-zinc-900 text-slate-400"><div class="max-w-4xl w-full mx-auto h-24 flex items-center justify-center"><div>© volkruss.com / Edelstein</div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"ソースで理解するWordPressの起動処理 ２","date":"2021.12.26","description":"ソースで理解するWordPressの起動処理 ２","categories":["WordPress"]},"content":"\u003cp\u003e前回はwp-blog-headerからwp-loadへいき、wp-configからwp-settingsまでの処理を確認しました。\u003c/p\u003e\n\u003cp\u003e今回はwp-blog-headerに戻ってきて、wp関数を実行しているところについて見ていきます。\u003c/p\u003e\n\u003cp\u003e前回までで、wp-includesにあるファイルまでローディングされ、mustプラグイン及び、有効化しているプラグインのロード、そしてテーマの読み込みと、WP_Queryオブジェクトの生成、functions.phpの読み込みなど、ワードプレスのコアからテーマまでのロードが完了しています。\u003c/p\u003e\n\u003cp\u003eそして次に流れるwp関数はコメントにもあるようにWordPressのqueryのセットアップになります\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token comment\"\u003e// Set up the WordPress query.\u003c/span\u003e\n\t\u003cspan class=\"token function\"\u003ewp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこのwp関数は以下のようになっています。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token doc-comment comment\"\u003e/**\n * Set up the WordPress query.\n *\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 2.0.0\n *\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP\u003c/span\u003e       \u003cspan class=\"token parameter\"\u003e$wp\u003c/span\u003e           Current WordPress environment instance.\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Query\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$wp_query\u003c/span\u003e     WordPress Query object.\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Query\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$wp_the_query\u003c/span\u003e Copy of the WordPress Query object.\n *\n * \u003cspan class=\"token keyword\"\u003e@param\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e|\u003c/span\u003e\u003cspan class=\"token keyword\"\u003earray\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$query_vars\u003c/span\u003e Default WP_Query arguments.\n */\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003ewp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$query_vars\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e''\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eglobal\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_the_query\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"token variable\"\u003e$wp\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$query_vars\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eisset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_the_query\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token variable\"\u003e$wp_the_query\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWPクラスのオブジェクトのmain関数を実行しています。これはwp-includes\\class-wp.phpに定義があります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token doc-comment comment\"\u003e/**\n\t * Sets up all of the variables required by the WordPress environment.\n\t *\n\t * The action \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003e@see\u003c/span\u003e 'wp'\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e has one parameter that references the WP object. It\n\t * allows for accessing the properties and methods to further manipulate the\n\t * object.\n\t *\n\t * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 2.0.0\n\t *\n\t * \u003cspan class=\"token keyword\"\u003e@param\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e|\u003c/span\u003e\u003cspan class=\"token keyword\"\u003earray\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$query_args\u003c/span\u003e Passed to parse_request().\n\t */\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$query_args\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e''\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token this keyword\"\u003e$this\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003einit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token this keyword\"\u003e$this\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003eparse_request\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$query_args\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token this keyword\"\u003e$this\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003esend_headers\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token this keyword\"\u003e$this\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003equery_posts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token this keyword\"\u003e$this\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003ehandle_404\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token this keyword\"\u003e$this\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003eregister_globals\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\t\t\u003cspan class=\"token doc-comment comment\"\u003e/**\n\t\t * Fires once the WordPress environment has been set up.\n\t\t *\n\t\t * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 2.1.0\n\t\t *\n\t\t * \u003cspan class=\"token keyword\"\u003e@param\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$this\u003c/span\u003e Current WordPress environment instance (passed by reference).\n\t\t */\u003c/span\u003e\n\t\t\u003cspan class=\"token function\"\u003edo_action_ref_array\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'wp'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003earray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token this keyword\"\u003e$this\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e最初のinitはwp-settingsでも登場したものでしょう\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token comment\"\u003e// Set up current user.\u003c/span\u003e\n\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'wp'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003einit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e次にRewriteオブジェクトを利用してリクエストの解析を行います。\u003c/p\u003e\n\u003cp\u003e次にキャッシュ、コンテンツタイプなど、追加のHTTPヘッダを送信します。Content-Type ヘッダを設定します。\u003c/p\u003e\n\u003cp\u003e次にメインクエリを実行します。\u003c/p\u003e\n\u003cp\u003e次にリクエストURLが見つからない場合に404ヘッダーを返します。\u003c/p\u003e\n\u003cp\u003e最後にワードプレスのグローバル変数をセットします。$postsなんてのもここで設定されています。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003eregister_globals\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003eglobal\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\t\t\u003cspan class=\"token comment\"\u003e// Extract updated query vars back into global namespace.\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003eforeach\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword type-casting\"\u003earray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token property\"\u003equery_vars\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$key\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$value\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$key\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$value\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\t\t\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'query_string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token this keyword\"\u003e$this\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token property\"\u003equery_string\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'posts'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e        \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token property\"\u003eposts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'post'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e         \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eisset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token property\"\u003epost\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token property\"\u003epost\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'request'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e      \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token property\"\u003erequest\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\t\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003eis_single\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003eis_page\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'more'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e   \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\t\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'single'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\t\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_query\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003eis_author\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'authordata'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eget_userdata\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token function\"\u003eget_queried_object_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eそして処理はwp-blog-headerに戻り、wp-includesのtemplate-loader.phpをロードします。\u003c/p\u003e\n\u003cp\u003eここでテーマのテンプレートとなるファイルをロードしています。\u003c/p\u003e\n\u003cp\u003ecall_user_funcではis_singleの場合はget_single_templateにてsingle テンプレートのパスを取得できればincluedeします。\u003c/p\u003e\n\u003cp\u003e初期処理の最後にテーマのパーツファイルをインクルードしているということですね。\u003c/p\u003e\n\u003cp\u003eテーマで作成したファイルは$postとかでメインクエリの結果を取得していますが、裏ではこのwpメソッドが動いてグローバル変数を設定していたのです。\u003c/p\u003e\n\u003cp\u003eサブクエリを利用すると新しいWP_Queryが作成されるので、利用用途によっては正しくwp reset postdataを実行する必要があります。\u003c/p\u003e\n\u003cp\u003eこれにてWordPressの起動処理は完了です。\u003c/p\u003e","slug":"p769"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"p769"},"buildId":"J_6bGXgj6-te2jiJiU_T5","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>