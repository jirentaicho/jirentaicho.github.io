<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@keisukesiratori"/><meta property="og:site_name" content="Edelstein"/><title>ソースで理解するWordPressの起動処理 １</title><meta name="robots" content="index,follow"/><meta name="description" content="ソースで理解するWordPressの起動処理 １"/><meta property="og:title" content="ソースで理解するWordPressの起動処理 １"/><meta property="og:description" content="ソースで理解するWordPressの起動処理 １"/><meta property="og:url" content="http:localhost:3000/posts/p748"/><meta property="og:type" content="website"/><meta property="og:image" content="https://locahost:3000/undefined"/><meta property="og:image:alt" content="ソースで理解するWordPressの起動処理 １"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="700"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/df6bb53438996960.css" as="style"/><link rel="stylesheet" href="/_next/static/css/df6bb53438996960.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-480c748fb908b436.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a840d570c522cf0.js" defer=""></script><script src="/_next/static/chunks/7-a9ae6bf2d6049209.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-31ed6b5e8c78747a.js" defer=""></script><script src="/_next/static/J_6bGXgj6-te2jiJiU_T5/_buildManifest.js" defer=""></script><script src="/_next/static/J_6bGXgj6-te2jiJiU_T5/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen bg-zinc-800"><header class="sticky top-0 border-b border-zinc-400 z-10 bg-zinc-900 text-slate-400"><div class="max-w-4xl mx-auto flex justify-between items-center h-12"><a href="/">Home</a><a target="_blank" href="https://github.com/jirentaicho">Github</a><a target="_blank" href="https://zenn.dev/misaka">Zenn</a></div></header><main class="flex-1 max-w-4xl w-full mx-auto"><div class="prose prose-lg max-w-none text-emerald-400"><h1 class="mt-12">ソースで理解するWordPressの起動処理 １</h1><span>2021.12.26</span><div class="space-x-2"><span><a class="text-emerald-300" href="/categories/WordPress/">WordPress</a></span></div></div></main><footer class="bg-zinc-900 text-slate-400"><div class="max-w-4xl w-full mx-auto h-24 flex items-center justify-center"><div>© volkruss.com / Edelstein</div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"ソースで理解するWordPressの起動処理 １","date":"2021.12.26","description":"ソースで理解するWordPressの起動処理 １","categories":["WordPress"]},"content":"\u003cp\u003eワードプレスはテーマを作ればOKみたいな風潮がありますが、コアのソースを見てメインクエリとサブクエリを理解したり、DB構造からタクソノミーを理解したりしていくと、ワードプレスって面白いって思えるようになります。（私はフロント側の実装が好きじゃないので特に）\u003c/p\u003e\n\u003cp\u003eというわけで今回はWordPressの起動処理についてみていきます。\u003c/p\u003e\n\u003ch2\u003eindex.php\u003c/h2\u003e\n\u003cp\u003eワードプレスの最初の処理はここから始まります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token doc-comment comment\"\u003e/**\n * Tells WordPress to load the WordPress theme and output it.\n *\n * \u003cspan class=\"token keyword\"\u003e@var\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003ebool\u003c/span\u003e\u003c/span\u003e\n */\u003c/span\u003e\n\u003cspan class=\"token function\"\u003edefine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'WP_USE_THEMES'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant boolean\"\u003etrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token doc-comment comment\"\u003e/** Loads the WordPress Environment and Template */\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003erequire\u003c/span\u003e \u003cspan class=\"token constant\"\u003e__DIR__\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'/wp-blog-header.php'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWP_USE_THEMESという定数を定義しています。\u003c/p\u003e\n\u003cp\u003ewp-blog-header.phpを見ていきます\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eisset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_did_header\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n\t\u003cspan class=\"token variable\"\u003e$wp_did_header\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token constant boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"token comment\"\u003e// Load the WordPress library.\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003erequire_once\u003c/span\u003e \u003cspan class=\"token constant\"\u003e__DIR__\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'/wp-load.php'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"token comment\"\u003e// Set up the WordPress query.\u003c/span\u003e\n\t\u003cspan class=\"token function\"\u003ewp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"token comment\"\u003e// Load the theme template.\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003erequire_once\u003c/span\u003e \u003cspan class=\"token constant\"\u003eABSPATH\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token constant\"\u003eWPINC\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'/template-loader.php'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eここで重要そうなものが登場していますね。wp-loadとwp関数です。ワードプレスそのもののセットアップを行っていそうですね。そしてそれが終わるとテーマの読み込みが走っています。\u003c/p\u003e\n\u003cp\u003ewp-load.php\u003c/p\u003e\n\u003cp\u003eまず最初に定数が定義されます\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token doc-comment comment\"\u003e/** Define ABSPATH as this file's directory */\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!\u003c/span\u003e \u003cspan class=\"token function\"\u003edefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'ABSPATH'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token function\"\u003edefine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'ABSPATH'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003e__DIR__\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'/'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eプラグインとかのソースを見ると頻出する定数「ABSPATH」です。これはつまりwp-load.phpが存在するパスということです。プラグイン開発する場合は頻出になると思います。\u003c/p\u003e\n\u003cp\u003eその後はエラーレベルの設定とwp-config.phpのロードになります。wp-config.phpがない場合はインストール処理に進みます。\u003c/p\u003e\n\u003cp\u003ewp-config.phpはデータベースの接続情報などを定義します。よくデータベースの情報なんだっけ？って時に見たりしてます。最後にwp-settings.phpを読み込んでいます。\u003c/p\u003e\n\u003cp\u003ewp-settings.php\u003c/p\u003e\n\u003cp\u003eここでは大量のファイルを読み込んでいます。ワードプレス起動の準備をしているような感じ。処理もとても長いです。ワードプレスの共通関数ファイル群を読み込んだり、プラグインを読み込んだりしています。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token doc-comment comment\"\u003e/**\n * Stores the location of the WordPress directory of functions, classes, and core content.\n *\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 1.0.0\n */\u003c/span\u003e\n\u003cspan class=\"token function\"\u003edefine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'WPINC'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'wp-includes'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token doc-comment comment\"\u003e/**\n * Version information for the current WordPress release.\n *\n * These can't be directly globalized in version.php. When updating,\n * we're including version.php from another installation and don't want\n * these values to be overridden if already set.\n *\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$wp_version\u003c/span\u003e             The WordPress version string.\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e    \u003cspan class=\"token parameter\"\u003e$wp_db_version\u003c/span\u003e          WordPress database version.\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$tinymce_version\u003c/span\u003e        TinyMCE version.\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$required_php_version\u003c/span\u003e   The required PHP version string.\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$required_mysql_version\u003c/span\u003e The required MySQL version string.\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$wp_local_package\u003c/span\u003e       Locale code of the package.\n */\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eglobal\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_version\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_db_version\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$tinymce_version\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$required_php_version\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$required_mysql_version\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$wp_local_package\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003erequire\u003c/span\u003e \u003cspan class=\"token constant\"\u003eABSPATH\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token constant\"\u003eWPINC\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'/version.php'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003erequire\u003c/span\u003e \u003cspan class=\"token constant\"\u003eABSPATH\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token constant\"\u003eWPINC\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'/load.php'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewp-includesフォルダのファイルを読み込んでいます。ここらのファイルはアクション系の関数とかが用意されています。\u003c/p\u003e\n\u003cp\u003eタームを取得するときも、ここのディレクトリのファイルが実行されています。\u003c/p\u003e\n\u003cp\u003eその後プラグインをロードします。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token function\"\u003ewp_plugin_directory_constants\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'wp_plugin_paths'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003earray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Load must-use plugins.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eforeach\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token function\"\u003ewp_get_mu_plugins\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$mu_plugin\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003einclude_once\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$mu_plugin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"token doc-comment comment\"\u003e/**\n\t * Fires once a single must-use plugin has loaded.\n\t *\n\t * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 5.1.0\n\t *\n\t * \u003cspan class=\"token keyword\"\u003e@param\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$mu_plugin\u003c/span\u003e Full path to the plugin's main file.\n\t */\u003c/span\u003e\n\t\u003cspan class=\"token function\"\u003edo_action\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'mu_plugin_loaded'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$mu_plugin\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eunset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$mu_plugin\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eいわゆるmu-pluginsの読み込みを行います。mu-pluginsについては以下のように定義されています\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!\u003c/span\u003e \u003cspan class=\"token function\"\u003edefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'WPMU_PLUGIN_DIR'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token function\"\u003edefine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'WPMU_PLUGIN_DIR'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eWP_CONTENT_DIR\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'/mu-plugins'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Full path, no trailing slash.\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eその後、テーマディレクトリを設定、有効プラグインのロードを行います。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token comment\"\u003e// Register the default theme directory root.\u003c/span\u003e\n\u003cspan class=\"token function\"\u003eregister_theme_directory\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token function\"\u003eget_theme_root\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!\u003c/span\u003e \u003cspan class=\"token function\"\u003eis_multisite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token comment\"\u003e// Handle users requesting a recovery mode link and initiating recovery mode.\u003c/span\u003e\n\t\u003cspan class=\"token function\"\u003ewp_recovery_mode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003einitialize\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Load active plugins.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eforeach\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token function\"\u003ewp_get_active_and_valid_plugins\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$plugin\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token function\"\u003ewp_register_plugin_realpath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$plugin\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003einclude_once\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$plugin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"token doc-comment comment\"\u003e/**\n\t * Fires once a single activated plugin has loaded.\n\t *\n\t * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 5.1.0\n\t *\n\t * \u003cspan class=\"token keyword\"\u003e@param\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$plugin\u003c/span\u003e Full path to the plugin's main file.\n\t */\u003c/span\u003e\n\t\u003cspan class=\"token function\"\u003edo_action\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'plugin_loaded'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$plugin\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eunset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$plugin\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eplugins_loadedでプラグインの読み込みが完了すると、WP_Queryオブジェクトの生成やリライトルールに関するWP_Rewriteオブジェクトを生成します。メインクエリ実行するWPオブジェクトなどを生成していくと、その後テーマのセットアップが行われます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token doc-comment comment\"\u003e/**\n * WordPress Query object\n *\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Query\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$wp_the_query\u003c/span\u003e WordPress Query object.\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 2.0.0\n */\u003c/span\u003e\n\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'wp_the_query'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Query\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token doc-comment comment\"\u003e/**\n * Holds the reference to @see $wp_the_query\n * Use this global for WordPress queries\n *\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Query\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$wp_query\u003c/span\u003e WordPress Query object.\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 1.5.0\n */\u003c/span\u003e\n\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'wp_query'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'wp_the_query'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token doc-comment comment\"\u003e/**\n * Holds the WordPress Rewrite object for creating pretty URLs\n *\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Rewrite\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$wp_rewrite\u003c/span\u003e WordPress rewrite component.\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 1.5.0\n */\u003c/span\u003e\n\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'wp_rewrite'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Rewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token doc-comment comment\"\u003e/**\n * WordPress Object\n *\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$wp\u003c/span\u003e Current WordPress environment instance.\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 2.0.0\n */\u003c/span\u003e\n\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'wp'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token doc-comment comment\"\u003e/**\n * WordPress Widget Factory Object\n *\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Widget_Factory\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$wp_widget_factory\u003c/span\u003e\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 2.8.0\n */\u003c/span\u003e\n\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'wp_widget_factory'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Widget_Factory\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token doc-comment comment\"\u003e/**\n * WordPress User Roles\n *\n * \u003cspan class=\"token keyword\"\u003e@global\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Roles\u003c/span\u003e \u003cspan class=\"token parameter\"\u003e$wp_roles\u003c/span\u003e WordPress role management object.\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 2.0.0\n */\u003c/span\u003e\n\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'wp_roles'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWP_Roles\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token doc-comment comment\"\u003e/**\n * Fires before the theme is loaded.\n *\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 2.6.0\n */\u003c/span\u003e\n\u003cspan class=\"token function\"\u003edo_action\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'setup_theme'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこの後は、ロケール情報など設定後に、テーマのfunctions.phpと子テーマのfunctions.phpの読み込みを行います。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token comment\"\u003e// Load the functions for the active theme, for both parent and child theme if applicable.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eforeach\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token function\"\u003ewp_get_active_and_valid_themes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$theme\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token function\"\u003efile_exists\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$theme\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'/functions.php'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$theme\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'/functions.php'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eunset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$theme\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eその後は現在のユーザーをセットアップして、タクソノミーやウィジェットのセットアップを行います。\u003c/p\u003e\n\u003cp\u003e全てのプラグインやテーマがロードされるとwp_loadedアクションを実行して処理が完了します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-php\"\u003e\u003ccode class=\"language-php\"\u003e\u003cspan class=\"token comment\"\u003e// Set up current user.\u003c/span\u003e\n\u003cspan class=\"token global\"\u003e$GLOBALS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'wp'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003einit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token doc-comment comment\"\u003e/**\n * Fires after WordPress has finished loading but before any headers are sent.\n *\n * Most of WP is loaded at this stage, and the user is authenticated. WP continues\n * to load on the \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003e@see\u003c/span\u003e 'init'\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e hook that follows (e.g. widgets), and many plugins instantiate\n * themselves on it for all sorts of reasons (e.g. they need a user, a taxonomy, etc.).\n *\n * If you wish to plug an action once WP is loaded, use the \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword\"\u003e@see\u003c/span\u003e 'wp_loaded'\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e hook below.\n *\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 1.5.0\n */\u003c/span\u003e\n\u003cspan class=\"token function\"\u003edo_action\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'init'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Check site status.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token function\"\u003eis_multisite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token variable\"\u003e$file\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ems_site_check\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token constant boolean\"\u003etrue\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!==\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$file\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003erequire\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$file\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003edie\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eunset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$file\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token doc-comment comment\"\u003e/**\n * This hook is fired once WP, all plugins, and the theme are fully loaded and instantiated.\n *\n * Ajax requests should use wp-admin/admin-ajax.php. admin-ajax.php can handle requests for\n * users not logged in.\n *\n * \u003cspan class=\"token keyword\"\u003e@link\u003c/span\u003e https://codex.wordpress.org/AJAX_in_Plugins\n *\n * \u003cspan class=\"token keyword\"\u003e@since\u003c/span\u003e 3.0.0\n */\u003c/span\u003e\n\u003cspan class=\"token function\"\u003edo_action\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'wp_loaded'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eここまでくると、wp-blog-header.phpのwp関数が実行されます。また次回に。\u003c/p\u003e","slug":"p748"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"p748"},"buildId":"J_6bGXgj6-te2jiJiU_T5","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>