---
title: 正規表現の基礎を学ぶ
date: 2022.03.21
description: 正規表現の基礎を学ぶ
categories: ['未分類']
---

正規表現の本が手元に来た

そろそろ常識？ マンガでわかる「正規表現」

表紙の微萌えキャラ（失礼）が様々な例を正規表現で解決していく物語だ。レイヴィニア＝バードウェイ似の女がお気に入りです。
* 図解などもあるのでわかりやすい。
* 正規表現一覧みたいなのじゃ理解できない人におすすめ
  * それは私です
* 基本的な使い方を説明した後で具体例の説明がある
* エディタやプログラミング言語でどうやって使うかなどもある

というわけで本を読んで少し正規表現をやってみたので以下に残しておきます。実行言語はPHPです

## サンプル


例に対しる回答をとりあえず記載していきます。

また以下の関数をよく使います
* preg_match
  * マッチしたら1が返る。第三引数に配列を指定すればマッチした”最初の”要素が格納される
* preg_match_all
  * 第三引数の配列にマッチした要素が全て入る
* preg_grep
  * 配列を検査できる
* preg_replace
  * 正規表現検索および置換を行う

また正規表現を扱う際には/で挟みます
* preg_match(“/mis[a]ka/”,”misaka”)
  * 1

## 何か1文字にマッチ


.は何か1文字です。misak〇が該当します

```php
dd( preg_grep("/misak./" , ["misaka","misaki","misato"]) );
..........
^ array:2 [
  0 => "misaka"
  1 => "misaki"
]
```


..で2文字になります

```php
dd( preg_grep("/mi..ka/" , ["misaka","misaki","mitaka"]) );
............
^ array:2 [
  0 => "misaka"
  2 => "mitaka"
]
```


## どれか一文字


[]の中でどれかの文字を指定する

```php
dd( preg_grep("/mi[st]aka/" , ["misaka","migaki","mitaka"]) );
.............
^ array:2 [
  0 => "misaka"
  2 => "mitaka"
]
```


## 範囲にマッチ

* [A-Z]

```php
dd( preg_grep("/fun[a-d]tion/" , ["function","funetion","funation"]) );
.........
^ array:2 [
  0 => "function"
  2 => "funation"
]
```


## メタ文字

* 正規表現の中で使われる特殊な文字
* 今までの.[]などがそれに該当
* 正規表現で何かをするぞ！という目印です

## 特殊な1文字にマッチ

* \d 0-9
* \w 英数字

```php
dd( preg_grep("/\dfile.jpg/" , ["6file.jpg","zfile.jpg","6file,jpg"]) );
................
^ array:2 [
  0 => "6file.jpg"
  2 => "6file,jpg"
]
```


この時間違った拡張子,jpgまでマッチしている。これは.が何か1文字としてマッチしているため、なのでエスケープしてあげる必要がある

メタ文字の前に\を付けることでメタ文字を文字として扱えます

```php
dd( preg_grep("/\dfile\.jpg/" , ["6file.jpg","zfile.jpg","6file,jpg"]) );
.............
^ array:1 [
  0 => "6file.jpg"
]
```


## 先頭・末尾にマッチ

* ^
  * 先頭以外での利用とは違う
    * 以外での利用とは違う
* $
  * 末尾

```php
dd( preg_grep("/^御坂/" , ["御坂妹は御坂美琴の妹です","常盤台の電撃姫、御坂美琴","第３位の苗字は御坂"]) );
........
^ array:1 [
  0 => "御坂妹は御坂美琴の妹です"
]
```


御坂で始まる文字列のみが取得できました。

```php
dd( preg_grep("/御坂$/" , ["御坂妹は御坂美琴の妹です","常盤台の電撃姫、御坂美琴","第３位の苗字は御坂"]) );
.........
^ array:1 [
  2 => "第３位の苗字は御坂"
]
```


御坂で終わる文字列を取得できました。

## あってもなくても


?を使ってあってもなくてもを表現します

```php
dd( preg_grep("/御坂?/" , ["御坂","御坂妹","御","御坂美琴"]) );
............
^ array:3 [
  0 => "御坂"
  1 => "御坂妹"
  3 => "御坂美琴"
]
```


## 数値繰り返し

* {数値}で繰り返しを表現する
  * \d{3}なら数値三桁

```php
dd( preg_grep("/\d{3}-\d{4}-\d{4}$/" , ["000-0000-0001","995-54-455","234-2322-233332"]) );
............
^ array:1 [
  0 => "000-0000-0001"
]
```


最後に$がついて末尾を表す理由は、233332という数値でも数値が4回繰り返されているからマッチしてしまう。そのため$を付けて末尾を4桁で指定しています。

## 繰り返し

* *は0回以上の繰り返しです

```php
dd( preg_grep("/<div .*?>/" , ["<div class='container'>container</div>","<p class='text'>text</p>","<span>fire</span>"]) );
..........................
^ array:1 [
  0 => "<div class='container'>container</div>"
]
```


divタグを、どのような形式でも取得できます

## 以上、以下

* {n,}
  * n以上
* {n,m}
  * n以上m以下

結構荒いですが本にもあったサンプルです。先頭が￥で末尾が-であることが条件

```html
dd( preg_grep("/￥\d{1,3},000-/" , ["￥1,000-","￥200,000-","￥1,000,000-"]) );
.......
^ array:2 [
  0 => "￥1,000-"
  1 => "￥200,000-"
]
```


## 置換、最小範囲、グループ化


平成を令和に置換します。

```php
$pattern = "/平成/";
$target = "平成4年、令和3年、平成5年";
$replace = "令和";
dd( preg_replace($pattern, $replace, $target) );
..........................
^ "令和4年、令和3年、令和5年"
```


$targetの$patternを$replaceに置換しています。



次は＜＞を「」に置換します。配列を利用します

```php
$pattern = array("/＜/","/＞/");
$target = "＜御坂美琴＞（白井黒子）＜＞＜豆＞";
$replace = array("「","」");
dd( preg_replace($pattern, $replace, $target) );
...........................
^ "「御坂美琴」（白井黒子）「」「豆」"
```


もっとスマートに置換できます

```php
$pattern = "/＜(.*?)＞/";
$target = "＜御坂美琴＞（白井黒子）＜＞＜豆＞";
$replace = "「$1」";
dd( preg_replace($pattern, $replace, $target) );
...........
^ "「御坂美琴」（白井黒子）「」「豆」"
```

* .*?は何かの文字列を最小範囲で繰り返すの意味
  * ＜御坂美琴＞も＜＞もマッチするということ
* ()はグループ化です。()でマッチしたものを$1で利用しています。
  * グループ化すると中身が一時保存される

グループ化の使い方

例えば置換で文字を消したい時、妹御坂と10032号妹御坂を削除するケース

```php
$pattern = "/妹|10032号妹御坂/";
$target = "妹御坂、ワースト御坂、美琴御坂、番外個体御坂、10032号妹御坂";
$replace = "";
dd( preg_replace($pattern, $replace, $target) );
.................
^ "御坂、ワースト御坂、美琴御坂、番外個体御坂、"
```


妹御坂が消せていないのでグループ化してあげます

```php
$pattern = "/(妹|10032号妹)御坂/";
$target = "妹御坂、ワースト御坂、美琴御坂、番外個体御坂、10032号妹御坂";
$replace = "";
dd( preg_replace($pattern, $replace, $target) );
...................
^ "、ワースト御坂、美琴御坂、番外個体御坂、"
```


## 先読み

* 先読み
  * 後ろに〇〇がついている時に前の文字を調べる単位などの絞り込みに便利100グラム、100年
    * 単位などの絞り込みに便利100グラム、100年
    * 100グラム、100年

円の場合にXXX円にする例

```php
$pattern = "/\d+円/"; //数値が1回以上の繰り返しと円
$target = "100円、100年、100番";
$replace = "XXX";
dd( preg_replace($pattern, $replace, $target) );
.....................
^ "XXX、100年、100番"
```


これは失敗している。円までが置換されているため。そこで先読みの登場

```php
$pattern = "/\d+(?=円)/";
$target = "100円、100年、100番";
$replace = "XXX";
dd( preg_replace($pattern, $replace, $target) );
................
^ "XXX円、100年、100番"
```


(?=〇)で先読みする

## 後読み

* 後読み
  * 前に●●がついている時に後ろの文字を調べる年号などの絞り込みに便利平成4年、令和3年
    * 年号などの絞り込みに便利平成4年、令和3年
    * 平成4年、令和3年

先読みと理解の仕方は同じ、令和の時だけXXに置換する

```php
$pattern = "/(?<=令和)\d+/";
$target = "令和3年、平成31年、昭和60年";
$replace = "XX";
dd( preg_replace($pattern, $replace, $target) );
................
^ "令和XX年、平成31年、昭和60年"
```


(?<=●)で後読みする

## 否定的先読み

* 否定的先読み
  * 後ろに〇〇がついていない時に前の文字を調べる拡張子の絞り込みに便利.txt以外のファイル
    * 拡張子の絞り込みに便利.txt以外のファイル
    * .txt以外のファイル

.txt以外のファイルを置換します

```php
$pattern = "/file(?!\.txt)/";
$target = "file.txt、file.jpg、file.mp4";
$replace = "done";
dd( preg_replace($pattern, $replace, $target) );
`````````````````````
^ "file.txt、done.jpg、done.mp4"
```


(?!〇)で否定的先読みをする→拡張子はメタ文字なのでエスケープしている

## 否定的後読み

* 否定的後読み
  * 前に●●がついてない時に後ろの文字を調べる東京都と京都など“京都”だけにマッチしたい
    * 東京都と京都など“京都”だけにマッチしたい
    * “京都”だけにマッチしたい

京都だけを変換する

```php
$pattern = "/(?<!東)京都/";
$target = "東京都品川区、京都宇治市、東京都港区";
$replace = "京都府";
dd( preg_replace($pattern, $replace, $target) );
................
^ "東京都品川区、京都府宇治市、東京都港区"
```


ざっくりと正規表現の基礎を勉強しました。本ではもっと詳しく漫画や図などを使って説明しています。正規表現苦手な人におすすめです
