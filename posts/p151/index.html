<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@keisukesiratori"/><meta property="og:site_name" content="Edelstein"/><title>C# | yaml | 気色の悪い構造を解析する</title><meta name="robots" content="index,follow"/><meta name="description" content="C# | yaml | 気色の悪い構造を解析する"/><meta property="og:title" content="C# | yaml | 気色の悪い構造を解析する"/><meta property="og:description" content="C# | yaml | 気色の悪い構造を解析する"/><meta property="og:url" content="http:localhost:3000/posts/p151"/><meta property="og:type" content="website"/><meta property="og:image" content="https://locahost:3000/undefined"/><meta property="og:image:alt" content="C# | yaml | 気色の悪い構造を解析する"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="700"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/df6bb53438996960.css" as="style"/><link rel="stylesheet" href="/_next/static/css/df6bb53438996960.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-480c748fb908b436.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a840d570c522cf0.js" defer=""></script><script src="/_next/static/chunks/7-a9ae6bf2d6049209.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-31ed6b5e8c78747a.js" defer=""></script><script src="/_next/static/_k0KM30rhR250p_rOC5lF/_buildManifest.js" defer=""></script><script src="/_next/static/_k0KM30rhR250p_rOC5lF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen bg-zinc-800"><header class="sticky top-0 border-b border-zinc-400 z-10 bg-zinc-900 text-slate-400"><div class="max-w-4xl mx-auto flex justify-between items-center h-12"><a href="/">Home</a><a target="_blank" href="https://github.com/jirentaicho">Github</a><a target="_blank" href="https://zenn.dev/misaka">Zenn</a></div></header><main class="flex-1 max-w-4xl w-full mx-auto"><div class="prose prose-lg max-w-none text-emerald-400"><h1 class="mt-12">C# | yaml | 気色の悪い構造を解析する</h1><span>2021.10.14</span><div class="space-x-2"><span><a class="text-emerald-300" href="/categories/WPF/">WPF</a></span></div></div></main><footer class="bg-zinc-900 text-slate-400"><div class="max-w-4xl w-full mx-auto h-24 flex items-center justify-center"><div>© volkruss.com / Edelstein</div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"C# | yaml | 気色の悪い構造を解析する","date":"2021.10.14","description":"C# | yaml | 気色の悪い構造を解析する","categories":["WPF"]},"content":"\u003cp\u003eこんにちは。\u003c/p\u003e\n\u003cp\u003eこの記事は前回の記事にもリンクしてあります。\u003c/p\u003e\n\u003ch3\u003e複雑な構造を表現する\u003c/h3\u003e\n\u003cp\u003eyamlファイルを作るときに大変だったこととして、以下のような気色の悪い構造になっている場合の解析について記載します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003escenario:\n  first:\n    type: MESSAGE\n    next: choiceman\n    back: back.jpg\n    right: keke.png\n    left: kanon.png\n    render:\n    - speaker: 可可\n      message:\n      - かのん見て！！！\n      - ぼろーーーーん！！\n    - speaker: かのん\n      message:\n      - 歌える\n      - 一人じゃないから\n    - speaker: 可可\n      message:\n      - くぅうううう\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003escenarioクラスの中にfirstクラスがあってと複雑化していますが、Dictionaryを使って表現しました。\u003c/p\u003e\n\u003cp\u003e参考：C# | Dictionaryを使って柔軟なyamlファイルを作成する\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eScenario\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e scenario \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e set\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこうするとfirstはstringで、その中身をScenarioクラスで管理するようにできます。\u003c/p\u003e\n\u003cp\u003eこの後に問題となるのがrenderの箇所でした。renderはクラスとして、それを配列で管理しています。さらにrenderクラスにはmessageという配列がある状態です。\u003c/p\u003e\n\u003cp\u003eyamldotnetは、リストでも配列を表現できますのでRenderYamlというクラスのリストをrenderとして用意します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eList\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eRenderYaml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e render \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e set\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eRenderYamlクラスは以下のような定義でmessageのリストを持っています。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eRenderYaml\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e string speaker \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e set\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eList\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e message \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e set\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこれでシリアライズとデシアライズはOKです。\u003c/p\u003e\n\u003ch3\u003eどうやって画面に出すか\u003c/h3\u003e\n\u003cp\u003eここからが少し問題でした。じゃあこいつらをどうやって画面に出力するのか？\u003c/p\u003e\n\u003cp\u003eまずは、デシアライズしたyamlファイルを管理できるYamlManagerクラスをシングルトンで作成しておきます。\u003c/p\u003e\n\u003cp\u003eそしてシナリオ一覧を表示するには、Dictionaryのkey情報だけを持ったコンボボックスが必要でしたので、以下のようにしてリストを作成しました。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e keys \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eYamlManager\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escenarioData\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escenario\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eKeys\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eToList\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003ekeys\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eForEach\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003ethis\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elist\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eAdd\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこれでkey情報をループしてkey情報だけが表示されるコンボボックスのソースを作成します。\u003c/p\u003e\n\u003cp\u003e上記のkey情報を元にシナリオデータを取得します。\u003c/p\u003e\n\u003cp\u003e→ストアクラスを作成して、表示中のkey情報をいつでも取り出せるようにしました。（frameを使っていたため）\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/151/1.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e choiceKey \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003emyComboBox\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eSelectedItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eToString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// ここでページを変更して、choiceKeyを渡します。\u003c/span\u003e\n\u003cspan class=\"token class-name\"\u003eStore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCurrentScenarioKey \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e choiceKey\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003emessageも複数あるので、index番号をコンボボックスに表示して、それを選択したら詳細をテキストブロックに表示します。\u003c/p\u003e\n\u003cp\u003e以下のように、mytalkListには配列のインデックス番号を列挙させて、そのインデックス番号に応じて、mylistboxというListBoxにmessageの要素を出します。ListBoxの要素がクリックされたら、textboxに表示させています。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLabel\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eContent\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e会話リスト\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eComboBox\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003e\u003cspan class=\"token namespace\"\u003ex:\u003c/span\u003eName\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003emytalkList\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eItemsSource\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{Binding TalkList}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eWidth\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e120\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eSelectionChanged\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eselectArrayIndex\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLabel\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eContent\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e会話内容\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eListBox\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003e\u003cspan class=\"token namespace\"\u003ex:\u003c/span\u003eName\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003emylistbox\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e  \u003cspan class=\"token attr-name\"\u003eItemsSource\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{Binding TalkDetailList}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eSelectionChanged\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eTalkDetailEvent\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLabel\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eContent\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e会話内容\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eTextBox\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003e\u003cspan class=\"token namespace\"\u003ex:\u003c/span\u003eName\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003emydetail\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eText\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eTextWrapping\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eWrap\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/151/2.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003eindex番号のリストは以下のようにして作成します。\u003c/p\u003e\n\u003cp\u003e便利なYamlManagerから、ストアに設定されているkey情報を元にデータを取ってきます。\u003c/p\u003e\n\u003cp\u003eあとはIndexをToStringしてあげればOKです。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003ethis.talkList = new ObservableCollection\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e();\nvar scenarioData = YamlManager.getInstance().scenarioData.scenario[currentKey];\nvar messages = scenarioData.render;\nforeach (var item in messages)\n{\n    this.talkList.Add(messages.IndexOf(item).ToString());\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eindexは文字列なので、messages[Int32.Parse(index)]でint化してmessageの配列から、メッセージの内容を取得します。\u003c/p\u003e\n\u003cp\u003e取得したメッセージをtalkDetailListに突っ込んで完了です。常にコンボボックスの変更を監視して値を変更している感じです。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token comment\"\u003e// 選択中のインデックス番号を取得して\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e index \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003emytalkList\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eSelectedItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eToString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e scenarioData \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eYamlManager\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escenarioData\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escenario\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ecurrentKey\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e messages \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e scenarioData\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e list \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e messages\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eInt32\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eParse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eindex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// 話し手を設定する。\u003c/span\u003e\n\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003espekaer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eText\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e list\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003espeaker\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003ethis\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etalkDetailList\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eClear\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// 会話内容をリストに突っ込む。\u003c/span\u003e\n\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003elist\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emessage\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eForEach\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003ethis\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etalkDetailList\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eAdd\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e簡単に便利なクラスを紹介します。\u003c/p\u003e\n\u003cp\u003e基本的には変数を保持しておくシングルトンクラスです。\u003c/p\u003e\n\u003ch3\u003eYamlManager\u003c/h3\u003e\n\u003cp\u003e変数の一覧はYamlオブジェクトのクラスでDictionaryを利用して以下のようにデシアライズしたりシリアライズされます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e string\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e valiable \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e set\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e基本的に画面に表示するリストはObservableCollectionが楽でしたので、getValiableListメソッドで、ObeservableCollectionにDictionaryの内容を突っ込んでいます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eYamlManager\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eYamlManager\u003c/span\u003e instance \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eYamlManager\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token comment\"\u003e//ここはそのうち除去してください。\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eYamlData\u003c/span\u003e yamlData \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e set\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eScenarioData\u003c/span\u003e scenarioData \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e set\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eYamlManager\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eYamlManager\u003c/span\u003e \u003cspan class=\"token function\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e instance\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eObservableCollection\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e string\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003egetValiableList\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e oc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eObservableCollection\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e string\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n            foreach \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eKeyValuePair\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e string\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e item in \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escenarioData\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003evaliable\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003eoc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eAdd\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e string\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003eitem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eKey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003eitem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eValue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e oc\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eStore\u003c/h3\u003e\n\u003cp\u003eSotreはシナリオ名を保持するだけです。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eStore\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eStore\u003c/span\u003e instance \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eStore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eStore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eStore\u003c/span\u003e \u003cspan class=\"token function\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e instance\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token comment\"\u003e/*\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e         * 利用する値を記載しています。\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e         * インスタンスを取得してから利用するようにするため、\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e         * staticな変数にはしないでください。\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e         * */\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e string \u003cspan class=\"token class-name\"\u003eCurrentScenarioKey\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYamlDotnetを使って割と気色の悪い構造のyamlファイルをデシアライズしても、扱い方はそれぞれですがきちんと扱うことができます。\u003c/p\u003e\n\u003cp\u003e最初のうちはyamlファイル使うならjs側のelectronがいいかもしれないなんて言いましたが、YamlDotNet一択です。。\u003c/p\u003e","slug":"p151"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"p151"},"buildId":"_k0KM30rhR250p_rOC5lF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>