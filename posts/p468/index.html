<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@keisukesiratori"/><meta property="og:site_name" content="Edelstein"/><title>ゼロからのOS自作入門 | day05_1</title><meta name="robots" content="index,follow"/><meta name="description" content="ゼロからのOS自作入門 | day05_1"/><meta property="og:title" content="ゼロからのOS自作入門 | day05_1"/><meta property="og:description" content="ゼロからのOS自作入門 | day05_1"/><meta property="og:url" content="http:localhost:3000/posts/p468"/><meta property="og:type" content="website"/><meta property="og:image" content="https://locahost:3000/undefined"/><meta property="og:image:alt" content="ゼロからのOS自作入門 | day05_1"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="700"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/df6bb53438996960.css" as="style"/><link rel="stylesheet" href="/_next/static/css/df6bb53438996960.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-480c748fb908b436.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a840d570c522cf0.js" defer=""></script><script src="/_next/static/chunks/7-a9ae6bf2d6049209.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-31ed6b5e8c78747a.js" defer=""></script><script src="/_next/static/lX7wN9kUXyXjoEt2YQkrU/_buildManifest.js" defer=""></script><script src="/_next/static/lX7wN9kUXyXjoEt2YQkrU/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen bg-zinc-800"><header class="sticky top-0 border-b border-zinc-400 z-10 bg-zinc-900 text-slate-400"><div class="max-w-4xl mx-auto flex justify-between items-center h-12"><a href="/">Home</a><a target="_blank" href="https://github.com/jirentaicho">Github</a><a target="_blank" href="https://zenn.dev/misaka">Zenn</a></div></header><main class="flex-1 max-w-4xl w-full mx-auto"><div class="prose prose-lg max-w-none text-emerald-400"><h1 class="mt-12">ゼロからのOS自作入門 | day05_1</h1><span>2021.12.08</span><div class="space-x-2"><span><a class="text-emerald-300" href="/categories/OS/">OS</a></span></div></div></main><footer class="bg-zinc-900 text-slate-400"><div class="max-w-4xl w-full mx-auto h-24 flex items-center justify-center"><div>© volkruss.com / Edelstein</div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"ゼロからのOS自作入門 | day05_1","date":"2021.12.08","description":"ゼロからのOS自作入門 | day05_1","categories":["OS"]},"content":"\u003cp\u003e少し空いてしまいましたが続きをやっていきます。\u003c/p\u003e\n\u003cp\u003e実は面白い本を見つけました。「解析魔法少女美咲ちゃん マジカル・オープン！」という本です。\u003c/p\u003e\n\u003cp\u003e「あなたの名前を入力してね」みたいなページがあるのだが、本に出てくる”お兄ちゃん”になれるのだ。しかし、そのお兄ちゃんの設定が”典型的なダメ兄で負け犬人生”ということで、なんとも複雑な感情になれる。\u003c/p\u003e\n\u003cp\u003e本の内容はバイナリエディタを使って悪いこと自分のソフトを守ろうという内容。（まだあまり読んでない）アセンブラ初心者も楽しく勉強できそう？？\u003c/p\u003e\n\u003ch2\u003e文字を書く\u003c/h2\u003e\n\u003cp\u003e「頑張ると文字の形をした絵を描くこともできるはずです」文字の表示とはそういうことらしいです。\u003c/p\u003e\n\u003ch3\u003e振り返り\u003c/h3\u003e\n\u003cp\u003eちょっとピクセルを描く処理についておさらいしておきます。\u003c/p\u003e\n\u003cp\u003eまず描画に必要な情報を取得するにはGOP(Graphics Output Protocol)という機能を使います。\u003c/p\u003e\n\u003cp\u003e必要な情報は以下です\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eフレームバッファの先頭アドレス\u003c/li\u003e\n\u003cli\u003eフレームバッファの表示と非表示領域\u003c/li\u003e\n\u003cli\u003e１ピクセルのデータ形式。１ピクセルが何バイトか\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e箇条書きですがざっくり振り返りを進めます\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e定義したOpenGOPメソッドを介して変数gopにGOPを設定します。（詳細は省略されてます）\u003c/li\u003e\n\u003cli\u003eこのgopからgop-\u003eMode-\u003eFrameBufferBaseのようにフレームバッファの情報を取得します。\u003c/li\u003e\n\u003cli\u003egop-\u003eMode-\u003eFrameBufferBaseで取得したUINT8* frame_bufferの[n]に対して色を指定(例えば255)することでフレームバッファに描画を行います。\u003c/li\u003e\n\u003cli\u003e白で塗りつぶすならばgop-\u003eMode-\u003eFrameBufferSizeだけループさせる\u003c/li\u003e\n\u003cli\u003eそしてカーネル側で、このframe_buffer_baseを引数で受け取り描画を行います。\u003c/li\u003e\n\u003cli\u003ereinterpret_castを利用して整数をポインタに変換します。uinit64_tをreinterpret_cast\u0026#x3C;uint8_t*\u003eとする\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e第四章を振り返る\u003c/h3\u003e\n\u003cp\u003e第四章ではクラスを分けて便利に描画できるようにしました。\u003c/p\u003e\n\u003cp\u003eまた箇条書きで描いていきます\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePixelWriterという抽象クラスを用意しました。こいつはフレームバッファーを受取ります。また、Writeメソッドを仮想関数として用意\u003c/li\u003e\n\u003cli\u003ePixelAtメソッドでフレームバッファに描画する箇所を取得します\u003c/li\u003e\n\u003cli\u003eオーバーライドするWritePixel関数でPixelAtで取得した箇所に1ピクセルを描画します\u003c/li\u003e\n\u003cli\u003e1ピクセルは32ビット=4バイトなのでフレームバッファの先頭からバイト位置を計算するにはpixel_positionに4をかける\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e改めて文字を書く\u003c/h2\u003e\n\u003cp\u003e都度都度振り返りを挟んで処理を理解しないといけないです。\u003c/p\u003e\n\u003cp\u003e文字列を描画するには塗るか塗らないかという情報を用意しておいて、PixelWriterのWriteメソッドを呼び出します。\u003c/p\u003e\n\u003cp\u003eこのメソッドをWriteAsciiメソッドとしてコンポジションでWriteメソッドを呼び出します。→ピクセルの描画方法と切り離して変更に強い実装にする。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/468/1.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003ch2\u003eヘッダーファイルの作成\u003c/h2\u003e\n\u003cp\u003eC++では関数やクラスという単位でファイルに分割できる。今回はcppファイルを分割して、ヘッダファイルを宣言してincludeする\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e#include \u003cspan class=\"token string\"\u003e\"frame_buffer_config.hpp\"\u003c/span\u003e\n#include \u003cspan class=\"token string\"\u003e\"graphics.hpp\"\u003c/span\u003e\n#include \u003cspan class=\"token string\"\u003e\"font.hpp\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eまたMakefileに修正が入っているのでgitを確認する\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/468/2.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003ch2\u003eフォントを増やす\u003c/h2\u003e\n\u003cp\u003ehankaku.txtはgitからダウンロードしました。そしてそれをバイナリファイル→オブジェクトファイルに変換する※toolsもgitからダウンロードしておきました\u003c/p\u003e\n\u003cp\u003e権限がバグってたので全部付与しました。→　chmod 777 makefont.py\u003c/p\u003e\n\u003cp\u003eまずbinを作成して\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/468/3.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003eオブジェクトファイルを作成する\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/468/4.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003eオプション引数が -0に見えたが -O オーが正解です。\u003c/p\u003e\n\u003cp\u003eそしてエラー\u003c/p\u003e\n\u003cp\u003eこいつまじなんなの？\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/468/5.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003eしかも前回と同じことしても全くダメ\u003c/p\u003e\n\u003cp\u003e仕方ないのでgitのブランチを切り替えてみます。せっかく手打ちしてんおに！！！\u003c/p\u003e\n\u003cp\u003e結局変わらない＾＾＾＾＾＾＾＾；；；\u003c/p\u003e\n\u003cp\u003e時間がもったいないので一旦ここで手を止めます。。。。。\u003c/p\u003e\n\u003cp\u003eやったこと\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eevalをつける\u003c/li\u003e\n\u003cli\u003eevalをつけない\u003c/li\u003e\n\u003cli\u003esource $HOME/osbook/devenv/buildenv.sh\u003c/li\u003e\n\u003cli\u003eブランチをday05cに変更\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e↑ぜーんぶだめ\u003c/p\u003e","slug":"p468"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"p468"},"buildId":"lX7wN9kUXyXjoEt2YQkrU","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>