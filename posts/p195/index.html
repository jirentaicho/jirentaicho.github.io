<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@keisukesiratori"/><meta property="og:site_name" content="Edelstein"/><title>ゼロからのOS自作入門 | day01</title><meta name="robots" content="index,follow"/><meta name="description" content="ゼロからのOS自作入門 | day01"/><meta property="og:title" content="ゼロからのOS自作入門 | day01"/><meta property="og:description" content="ゼロからのOS自作入門 | day01"/><meta property="og:url" content="http:localhost:3000/posts/p195"/><meta property="og:type" content="website"/><meta property="og:image" content="https://locahost:3000/undefined"/><meta property="og:image:alt" content="ゼロからのOS自作入門 | day01"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="700"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/df6bb53438996960.css" as="style"/><link rel="stylesheet" href="/_next/static/css/df6bb53438996960.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-480c748fb908b436.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a840d570c522cf0.js" defer=""></script><script src="/_next/static/chunks/7-a9ae6bf2d6049209.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-31ed6b5e8c78747a.js" defer=""></script><script src="/_next/static/bXc5Sirceq9aybu69XHfq/_buildManifest.js" defer=""></script><script src="/_next/static/bXc5Sirceq9aybu69XHfq/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen bg-zinc-800"><header class="sticky top-0 border-b border-zinc-400 z-10 bg-zinc-900 text-slate-400"><div class="max-w-4xl mx-auto flex justify-between items-center h-12"><a href="/">Home</a><a target="_blank" href="https://github.com/jirentaicho">Github</a><a target="_blank" href="https://zenn.dev/misaka">Zenn</a></div></header><main class="flex-1 max-w-4xl w-full mx-auto"><div class="prose prose-lg max-w-none text-emerald-400"><h1 class="mt-12">ゼロからのOS自作入門 | day01</h1><span>2021.11.29</span><div class="space-x-2"><span><a class="text-emerald-300" href="/categories/OS/">OS</a></span></div></div></main><footer class="bg-zinc-900 text-slate-400"><div class="max-w-4xl w-full mx-auto h-24 flex items-center justify-center"><div>© volkruss.com / Edelstein</div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"ゼロからのOS自作入門 | day01","date":"2021.11.29","description":"ゼロからのOS自作入門 | day01","categories":["OS"]},"content":"\u003cp\u003eKindle Unlimitedでそれっぽい本をパラパラと読んでいたらOSの自作に興味を持ってしまったので買いました。\u003c/p\u003e\n\u003cp\u003e分厚い本っぽいのでKindleで買ったのですが、マーカーとかコピペとかできないやつだったのでガッカリ。\u003c/p\u003e\n\u003cp\u003eまあ本でもコピペなんぞできないんで気を取り直して進めてみました。\u003c/p\u003e\n\u003cp\u003eまずは第１章\u003c/p\u003e\n\u003ch3\u003e事前準備\u003c/h3\u003e\n\u003cp\u003e自分はKubernetesの環境作りで既にWindowsでUbuntuが使える状態だったのですが、VirtualBoxでUbuntuを使うことにしました。\u003c/p\u003e\n\u003cp\u003eVirtualBox\u003c/p\u003e\n\u003cp\u003ehttps://www.virtualbox.org/\u003c/p\u003e\n\u003cp\u003eデータ領域は80Gを付与しました。デフォルトの10Gだと足りません。\u003c/p\u003e\n\u003cp\u003eUbuntu\u003c/p\u003e\n\u003cp\u003ehttps://jp.ubuntu.com/download\u003c/p\u003e\n\u003cp\u003eUbuntu Desktop 20.04.3 LTSを利用しました。\u003c/p\u003e\n\u003ch3\u003eOkteta\u003c/h3\u003e\n\u003cp\u003eバイナリエディタです。前に仕事でバイナリエディタを使ったことがあるのですが（データの件数確認程度）その時の苦しい記憶が蘇ってきました。\u003c/p\u003e\n\u003cp\u003eそれはさておき、意味不明な文字列をひたすら打ち込みました。疲れました。\u003c/p\u003e\n\u003cp\u003eちなみに「１行あたりのバイト数を設定…」で”16″にしても、画面サイズをデカくして表示しないと参考書のように表示されませんでした。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003esum BOOT64.EFI\n12430     2\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/195/1.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003eこのコマンドで問題がないことを確認して次は実行です。\u003c/p\u003e\n\u003ch3\u003e実行\u003c/h3\u003e\n\u003cp\u003e家に使ってないパソコンがあったのでそれで試すことにしました。USBメモリは64Gのがあったのでそれを利用しました。\u003c/p\u003e\n\u003cp\u003eVirtualBoxでUSBメモリを認識させるには、拡張パックが必要とのことで以下のサイトを参考に導入します\u003c/p\u003e\n\u003cp\u003ehttps://pc-karuma.net/virtualbox-mount-usb-flash-drive/\u003c/p\u003e\n\u003cp\u003eFailed to create a proxy device for the USB device というエラーが起きたのですが、3.0ポートで接続してるのが問題らしいので2.0ポートに接続したら、POKANという音とともに認識したっぽいポップアップが出てきた\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/195/2.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003e参考書のやりかただとUSBの探し方が意味不明だったのでdevフォルダでUSBを抜き差ししててlsコマンドで確認するとsdbというフォルダがそれだと理解した\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/195/3.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003e色々ミスったがコピーまで完了。。。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/195/4.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003eUSBを引っこ抜いて使ってないパソコンに差し込んで起動します。\u003c/p\u003e\n\u003cp\u003eそして無事失敗。。。原因は不明\u003c/p\u003e\n\u003ch3\u003eエミュレーターで実行\u003c/h3\u003e\n\u003cp\u003eというわけでエミュレーターで行います。\u003c/p\u003e\n\u003cp\u003e付録AとGithubを見ても、qemuのセットアップがわからなかったので適当に以下でinstallをしました。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eqemu-img\n\nコマンド \u0026#x26;#39;qemu-img\u0026#x26;#39; が見つかりません。次の方法でインストールできます:\n\nsudo apt install qemu-utils\n\nmisaka@misaka-VirtualBox:~$ sudo apt install qemu-utils\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eqemu-img create -f raw disk.img 200M\nFormatting \u0026#x26;#39;disk.img\u0026#x26;#39;, fmt=raw size=209715200\nmisaka@misaka-VirtualBox:~/ドキュメント$ mkfs.fat -n \u0026#x26;#39;MIKAN OS\u0026#x26;#39; -s 2 -f 2 -R 32 -F 32 disl.img\nmkfs.fat 4.1 (2017-01-24)\nmkfs.fat: unable to open disl.img: No such file or directory\nmisaka@misaka-VirtualBox:~/ドキュメント$ mkfs.fat -n \u0026#x26;#39;MIKAN OS\u0026#x26;#39; -s 2 -f 2 -R 32 -F 32 disk.img\nmkfs.fat 4.1 (2017-01-24)\nmisaka@misaka-VirtualBox:~/ドキュメント$ mkdir -p mnt\nmisaka@misaka-VirtualBox:~/ドキュメント$ sudo mount -o loop disk.img mnt\n[sudo] misaka のパスワード: \nmisaka@misaka-VirtualBox:~/ドキュメント$ sudo mkdir -P mnt/EFI/BOOT\nmkdir: 無効なオプション -- \u0026#x26;#39;P\u0026#x26;#39;\nTry \u0026#x26;#39;mkdir --help\u0026#x26;#39; for more information.\nmisaka@misaka-VirtualBox:~/ドキュメント$ sudo mkdir -p mnt/EFI/BOOT\nmisaka@misaka-VirtualBox:~/ドキュメント$ sudo cp BOOT64.EFI mnt/EFI/BOOT/BOOT64.EFI\nmisaka@misaka-VirtualBox:~/ドキュメント$ sudo umount mnt\nmisaka@misaka-VirtualBox:~/ドキュメント$ qemu-system-x86_64 \\\n\u0026#x26;gt; -drive if=pflash,file=$HOME/osbook/devenv/OVMF_CODE.fd \\\n\u0026#x26;gt; -drive if=pflash,file=$HOME/osbook/devenv/OVMF_VARS.fd \\\n\u0026#x26;gt; -hda disk.img\n\nコマンド \u0026#x26;#39;qemu-system-x86_64\u0026#x26;#39; が見つかりません。次の方法でインストールできます:\n\nsudo apt install qemu-system-x86      # version 1:4.2-3ubuntu6.18, or\nsudo apt install qemu-system-x86-xen  # version 1:4.2-3ubuntu6.18\n\nmisaka@misaka-VirtualBox:~/ドキュメント$ sudo apt install qemu-system-x86\nパッケージリストを読み込んでいます... 完了\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eここで何かに気が付く、あれ？環境構築が必要？？\u003c/p\u003e\n\u003cp\u003ehttps://github.com/uchan-nos/mikanos-build\u003c/p\u003e\n\u003cp\u003eとりあえずビルド環境の構築を行う\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003egit clone https://github.com/uchan-nos/mikanos-build.git osbook\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eここまで行って再度実行。ハローワールドしない。。。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/195/5.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003e本を読むとrun_qemu.shというシェルがあるよ:)とのことなのでそれで試すと\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/195/6.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003eきました。入力していたマシン語には問題は無かったようなので一安心。\u003c/p\u003e\n\u003cp\u003e正直２進数とか１６進数とか、この業界にいても無視してきました。。。\u003c/p\u003e\n\u003ch3\u003eハローワールドが表示されるまで\u003c/h3\u003e\n\u003cp\u003eUSB起動の場合\u003c/p\u003e\n\u003cp\u003eCPUがBIOSを実行する→BIOSが接続されているストレージを検索する→ストレージ中の実行可能ファイルをメインメモリに書き出す→CPUがメインメモリに書き出したファイルを実行する。\u003c/p\u003e\n\u003ch3\u003eC/C＋＋の導入\u003c/h3\u003e\n\u003cp\u003eここでVirtualBoxで割り当てている10Gの容量が足りなくなり拡張しようとしたら起動しなくなったので最初から作り直した。容量を80Gにして作成\u003c/p\u003e\n\u003cp\u003e（HDDがなくてダブルSSDで動いてるパソコンなので80Gは痛い・・・)\u003c/p\u003e\n\u003cp\u003elld-linkってコマンドが見つかりませんってエラーになったので、githubに戻って以下まで実施\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eansible-playbook -K -i ansible_inventory ansible_provision.yml\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eさぁ、これでhello.efiが作成できるようになったので、さっそくエミュレータで起動してみます。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/195/7.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003eなんとか動きました。。day01なのにめっちゃ疲れた\u003c/p\u003e\n\u003cp\u003eネット見ないと環境構築できないってので少し戸惑ったが、最初の一歩を踏み出せたので良かった。\u003c/p\u003e\n\u003cp\u003e正直Kindle版は失敗したなぁと思ったが本も７４４ページあるそうなので・・・\u003c/p\u003e","slug":"p195"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"p195"},"buildId":"bXc5Sirceq9aybu69XHfq","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>