<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@keisukesiratori"/><meta property="og:site_name" content="Edelstein"/><title>SpringBootで動的に作ったCSVファイルをダウンロードさせる</title><meta name="robots" content="index,follow"/><meta name="description" content="SpringBootで動的に作ったCSVファイルをダウンロードさせる"/><meta property="og:title" content="SpringBootで動的に作ったCSVファイルをダウンロードさせる"/><meta property="og:description" content="SpringBootで動的に作ったCSVファイルをダウンロードさせる"/><meta property="og:url" content="http:localhost:3000/posts/p2817"/><meta property="og:type" content="website"/><meta property="og:image" content="https://locahost:3000/undefined"/><meta property="og:image:alt" content="SpringBootで動的に作ったCSVファイルをダウンロードさせる"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="700"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/df6bb53438996960.css" as="style"/><link rel="stylesheet" href="/_next/static/css/df6bb53438996960.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-480c748fb908b436.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a840d570c522cf0.js" defer=""></script><script src="/_next/static/chunks/7-a9ae6bf2d6049209.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-31ed6b5e8c78747a.js" defer=""></script><script src="/_next/static/Kg6aT1KjKvSFgnl13Mv2i/_buildManifest.js" defer=""></script><script src="/_next/static/Kg6aT1KjKvSFgnl13Mv2i/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen bg-zinc-800"><header class="sticky top-0 border-b border-zinc-400 z-10 bg-zinc-900 text-slate-400"><div class="max-w-4xl mx-auto flex justify-between items-center h-12"><a href="/">Home</a><a target="_blank" href="https://github.com/jirentaicho">Github</a><a target="_blank" href="https://zenn.dev/misaka">Zenn</a></div></header><main class="flex-1 max-w-4xl w-full mx-auto"><div class="prose prose-lg max-w-none text-emerald-400"><h1 class="mt-12">SpringBootで動的に作ったCSVファイルをダウンロードさせる</h1><span>2022.06.22</span><div class="space-x-2"><span><a class="text-emerald-300" href="/categories/Spring/">Spring</a></span></div></div></main><footer class="bg-zinc-900 text-slate-400"><div class="max-w-4xl w-full mx-auto h-24 flex items-center justify-center"><div>© volkruss.com / Edelstein</div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"SpringBootで動的に作ったCSVファイルをダウンロードさせる","date":"2022.06.22","description":"SpringBootで動的に作ったCSVファイルをダウンロードさせる","categories":["Spring"]},"content":"\u003cp\u003eCSVデータを動的に作成してダウンロードさせるため、JacksonのCsvMapperを利用してCSV形式のファイルを作成します。\u003c/p\u003e\n\u003cp\u003e私の好きな書籍「現場至上主義 Spring Boot2徹底活用」の一部分です。が、ダウンロードされるcsvファイルが空ファイルになっていました。(抜けてる箇所があったらすみません。そのまま動かしたのでなく、参考に自分の作ったコードで動かした時の挙動です)\u003c/p\u003e\n\u003cp\u003e該当箇所\u003c/p\u003e\n\u003cp\u003ehttps://github.com/miyabayt/spring-boot-doma2-sample/blob/master/sample-web-base/src/main/java/com/sample/web/base/view/CsvView.java\u003c/p\u003e\n\u003cp\u003e結果的にはwriteToResponseを使ってファイルの出力に成功しました\u003c/p\u003e\n\u003cp\u003eソース\u003c/p\u003e\n\u003cp\u003ehttps://github.com/jirentaicho/BookOhFoo/blob/main/src/main/java/com/volkruss/BookOhFoo/system/controller/CsvDownLoadView.java\u003c/p\u003e\n\u003cp\u003e今回はまず、前提知識としてファイルに文字列を書き込むってどうやるの？ってところから、\u003c/p\u003e\n\u003ch2\u003eファイルに書き込むってどうやるの？\u003c/h2\u003e\n\u003cp\u003eそもそもOutputStreamWriterとBufferedOutputStreamみたいなのがあるけど何をどうすればファイルに文字を書き込めるのか？関連記事(記事下部)にもあるように、基本的にはバッファリングを使いまとめて読み書きしてしまうことが多いです。\u003c/p\u003e\n\u003cp\u003eバッファリングをする機能は以下です\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBufferedOutputStream\n\u003cul\u003e\n\u003cli\u003eバイトストリーム\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eBufferedWriter\n\u003cul\u003e\n\u003cli\u003e文字ストリーム\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eとりあえずファイルに文字を書き込んでみます\u003c/h3\u003e\n\u003cp\u003eよくあるサンプルコードはtry文とかで見た目は複雑になっているが、try-with-resourcesを使うことでとてもシンプルになります。\u003c/p\u003e\n\u003cp\u003e以下はcolor.txtというファイルにwhiteという文字列を書き込むだけのコードです。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@GetMapping\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/sell/sample\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token function\"\u003ehoge\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethrows\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIOException\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eFileWriter\u003c/span\u003e fileWriter \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFileWriter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"color.txt\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        fileWriter\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"white\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"sample\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOutputStreamWriterとBufferedOutputStreamじゃなくてFileWriterじゃねーか！と思ったかもしれませんが、これはOutputStreamWriterを継承しているだけなので基本的には同じようなものだと考えましょう。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFileWriter\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eOutputStreamWriter\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFileWriter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e fileName\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethrows\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIOException\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003esuper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFileOutputStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efileName\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFileWriter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e fileName\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eboolean\u003c/span\u003e append\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethrows\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIOException\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003esuper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFileOutputStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efileName\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e append\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e省略\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/2817/1.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003eOutputStreamWriterというのは文字列をそのまま処理できます。これは文字ストリーム(文字の連続)をバイトストリーム(バイトの連続)に変換してくれます。そのためfileWriter.write(“white”);のように書き込みが可能です。\u003c/p\u003e\n\u003ch3\u003eBufferedOutputStreamを使ってみよう\u003c/h3\u003e\n\u003cp\u003e次はBufferedOutputStreamを使ってみます。これはバイトストリームを扱うので文字列を書き込むことはできません。\u003c/p\u003e\n\u003cp\u003eコンストラクタにOutputStreamが必要です。ここでFileOutputStreamをnewして渡してあげます。FileOutputStreamは引数にファイル名を受取ります\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@GetMapping\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/sell/sample\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token function\"\u003ehoge\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethrows\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIOException\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eBufferedOutputStream\u003c/span\u003e writer \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBufferedOutputStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFileOutputStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"color.txt\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e text \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"BLACK\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// 文字列をバイトに変換する\u003c/span\u003e\n        writer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetBytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eStandardCharsets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eUTF_8\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"sample\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/2817/2.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003cp\u003e書き込むときには文字列でなくバイトを渡しています。なので以下の違いがあるのがわかります\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOutputStreamWriter\n\u003cul\u003e\n\u003cli\u003e文字列を書き込める\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eBufferedOutputStream\n\u003cul\u003e\n\u003cli\u003eバイトを書き込める\u003c/li\u003e\n\u003cli\u003e文字列は書き込めない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eBufferedWriterを使ってみる\u003c/h3\u003e\n\u003cp\u003eここまでくるとなんとなくどうやって書くのかわかるかと思います。以下のようにしてBufferedWriterを利用します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@GetMapping\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/sell/sample\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token function\"\u003ehoge\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethrows\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIOException\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eBufferedWriter\u003c/span\u003e writer \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBufferedWriter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFileWriter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"color.txt\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        writer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Can i break it\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"sample\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/2817/3.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003ch2\u003eCSVファイルをダウンロードする\u003c/h2\u003e\n\u003cp\u003eここからはCSVファイルをダウンロードするコードについて見ていきます\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token class-name\"\u003eCsvSchema\u003c/span\u003e schema \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e csvMapper\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eschemaFor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eclazz\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewithHeader\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token class-name\"\u003eByteArrayOutputStream\u003c/span\u003e outputStream \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateTemporaryOutputStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eWriter\u003c/span\u003e writer \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eOutputStreamWriter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoutputStream\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Windows-31J\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    csvMapper\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewriter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewriteValue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewriter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token function\"\u003ewriteToResponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresponse\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eout\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ecreateTemporaryOutputStreamは一時的なOutputStreamを作成してくれます。戻り値はByteArrayOutputStreamです。これはファイルなどでなくバイト配列を出力先にするものです。\u003c/p\u003e\n\u003cp\u003ehttp://www.kab-studio.biz/Programing/JavaA2Z/Word/00000901.html\u003c/p\u003e\n\u003cp\u003eそしてcsvMapper.writer(schema).writeValue(writer, data);でwriteしているのでしょう。\u003c/p\u003e\n\u003cp\u003e何となく動きはわかると思います。Writerを使ってバイト配列にcsvの内容を書き込んでいるということが。\u003c/p\u003e\n\u003cp\u003eさて、これはエラー無く動くのですが書き込んだ奴はどこいったのか・・・\u003c/p\u003e\n\u003cp\u003eそこでwriteToResponse(response,out);を使いました。\u003c/p\u003e\n\u003cp\u003eこれだけだとurlに応じたファイル名でファイルがダウンロードされますが、しっかりcsvが書き込まれています。※画像はヘッダのみ\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/2817/4.png\" alt=\"画像\"\u003e\u003c/p\u003e\n\u003ch3\u003eファイル名の指定など\u003c/h3\u003e\n\u003cp\u003eファイル名などを指定する際にはレスポンスのヘッダーを設定してあげます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e filename \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"csv.csv\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e encodedFilename \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eURLEncoder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eencode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efilename\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"UTF-8\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e contentDisposition \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eformat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"attachment; filename*=UTF-8''%s\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e encodedFilename\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nresponse\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetHeader\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token constant\"\u003eCONTENT_TYPE\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token function\"\u003egetContentType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nresponse\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetHeader\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token constant\"\u003eCONTENT_DISPOSITION\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e contentDisposition\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e一応、ダウンロードさせることを明示して、文字コードやファイル名を指定しています。このattachmentというのがダウンロードすべきであることを示していて、Webページとして表示したいよって時はinlineを使います\u003c/p\u003e\n\u003cp\u003ehttps://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Content-Disposition\u003c/p\u003e\n\u003cp\u003eただcsvファイルはinlineにしていもダウンロードされてしまいました。\u003c/p\u003e\n\u003ch2\u003e関連記事\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"/posts/p1951\"\u003eリンク\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/posts/p492\"\u003eリンク\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003e参考記事\u003c/h2\u003e\n\u003cp\u003ehttps://zenn.dev/kawakawaryuryu/articles/8924849b88590cda4e22\u003c/p\u003e","slug":"p2817"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"p2817"},"buildId":"Kg6aT1KjKvSFgnl13Mv2i","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>