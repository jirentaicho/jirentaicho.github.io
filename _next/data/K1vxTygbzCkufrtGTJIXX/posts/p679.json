{"pageProps":{"frontMatter":{"title":"Laravel8とJetstreamのメモ１","date":"2021.12.21","description":"Laravel8とJetstreamのメモ１","categories":["Laravel"]},"content":"<p>JetStreamというガンダムに出てきそうな機能を利用すると、とても多くの設定が行われますが、とても追いつけないので少しずつですがメモを残していきます。</p>\n<p>Jetstreamを入れてしまえばある程度使えるようになってしまうので、ある程度理解している状態までいければと思います。</p>\n<p>公式ドキュメント</p>\n<p>今回はLivewireをメインに見ていきます。</p>\n<p>今回は以下についてザックリ確認していきます</p>\n<ul>\n<li>概要</li>\n<li>ログイン</li>\n<li>登録</li>\n<li>プロファイル</li>\n<li>Livewire</li>\n</ul>\n<h2>LivewireとInertia</h2>\n<p>jetstreamを利用する際に選択できるフロントエンド機能です。公式ドキュメントから簡単に説明すると、LivewireはVue.jsなどのJavaScriptの機能を使わずともリアクティブなビューを表現できます。InertiaはVue.jsを完全利用してビューを構築します。</p>\n<p>JestreamとLivewireのインストール</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">php artisan jetstream:install livewire\nphp artisan jetstream:install livewire --teams\n</code></pre></div>\n<p>JetstreamとInertiaのインストール</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">php artisan jetstream:install inertia\nphp artisan jetstream:install inertia --teams\n</code></pre></div>\n<h2>Laravel Fortify</h2>\n<p>認証についてはLaravel Fortifyによって行われます。</p>\n<p>config\\fortify.phpというファイルにガードや認証後のリダイレクトについて設定があります。</p>\n<p>通常の認証後のリダイレクト先はRouteServiceProviderのHOMEの値を利用します</p>\n<h3>ルートとコントローラー</h3>\n<p>Laravel Breezeとの違いとしてActionとしてコントローラーやルートを変更できます。</p>\n<p>app/Actionsディレクトリが該当します。</p>\n<h3>View</h3>\n<p>Jeststreamをインストールすると以下にViewが作成されます。</p>\n<p>Livewireを使用している場合、ビューはアプリケーションのresources/viewsディレクトリレイアウトはresources/views/layouts/app.blade.php</p>\n<p>Inertiaを使用している場合、「ページ」はresources/js/Pagesディレクトリレイアウトはresources/js/Layouts/AppLayout.vue</p>\n<h2>プロフィールページ</h2>\n<p>プロフィールページには名前やパスワードの変更、アカウント削除などに関して表示があります。これらは\\resources\\views\\profile\\show.blade.phpに記載があり、また同フォルダのファイルがコンポーネントとして表示されています。</p>\n<h2>ログイン</h2>\n<p>ログインに関するViewはresources\\views\\auth\\login.blade.phpにあります。</p>\n<p>またログイン時のビューを変更するにはapp\\Providers\\JetstreamServiceProvider.phpのbootメソッドを修正します。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">boot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">configurePermissions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token scope\">Jetstream<span class=\"token punctuation\">::</span></span><span class=\"token function\">deleteUsersUsing</span><span class=\"token punctuation\">(</span><span class=\"token scope\">DeleteUser<span class=\"token punctuation\">::</span></span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// ここ追加</span>\n        <span class=\"token scope\">Fortify<span class=\"token punctuation\">::</span></span><span class=\"token function\">loginView</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">view</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'auth.sample-login'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3>ユーザー認証方法のカスタマイズ</h3>\n<p>ユーザー認証を行う方法をカスタマイズするのもJetstreamServiceProviderにて行うことができます。クラスを用意する方法とクロージャを利用する方法があり、クラスを利用するにはFortify::authenticateUsingに独自のクラスを渡します。</p>\n<p>またクロージャを利用するにはbootメソッドに記載をします</p>\n<p>詳細はこちら</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">boot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">configurePermissions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token scope\">Jetstream<span class=\"token punctuation\">::</span></span><span class=\"token function\">deleteUsersUsing</span><span class=\"token punctuation\">(</span><span class=\"token scope\">DeleteUser<span class=\"token punctuation\">::</span></span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// ここ追加</span>\n        <span class=\"token scope\">Fortify<span class=\"token punctuation\">::</span></span><span class=\"token function\">authenticateUsing</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Request</span> <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token function\">dd</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token scope\">User<span class=\"token punctuation\">::</span></span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">name</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token scope\">Hash<span class=\"token punctuation\">::</span></span><span class=\"token function\">check</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">passwrod</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$user</span><span class=\"token operator\">-></span><span class=\"token property\">password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token variable\">$user</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><img src=\"/679/1.png\" alt=\"画像\"></p>\n<h3>パスワードリセット</h3>\n<p>パスワードをリセットについてはapp\\Actions\\Fortify\\UpdateUserPassword.phpをカスタムします。</p>\n<p>ここで新しいパスワードの検証から更新までを行います。</p>\n<h2>登録</h2>\n<p>登録処理を行うと app\\Actions\\Fortify\\ CreateNewUser.phpが実行されます。</p>\n<p>createメソッドにて検証とユーザー作成までを行います。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">create</span><span class=\"token punctuation\">(</span><span class=\"token keyword type-hint\">array</span> <span class=\"token variable\">$input</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n      \n        <span class=\"token function\">dd</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$input</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token scope\">Validator<span class=\"token punctuation\">::</span></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$input</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'name'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'required'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'string'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'max:255'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'email'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'required'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'string'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'email'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'max:255'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'unique:users'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token operator\">=></span> <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">passwordRules</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'terms'</span> <span class=\"token operator\">=></span> <span class=\"token scope\">Jetstream<span class=\"token punctuation\">::</span></span><span class=\"token function\">hasTermsAndPrivacyPolicyFeature</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'required'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'accepted'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">validate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token scope\">User<span class=\"token punctuation\">::</span></span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'name'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$input</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'email'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$input</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'email'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token operator\">=></span> <span class=\"token scope\">Hash<span class=\"token punctuation\">::</span></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$input</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><img src=\"/679/2.png\" alt=\"画像\"></p>\n<p>無理矢理ソーシャル用に適合させることもできました。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">create</span><span class=\"token punctuation\">(</span><span class=\"token keyword type-hint\">array</span> <span class=\"token variable\">$input</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n      \n        <span class=\"token scope\">Validator<span class=\"token punctuation\">::</span></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$input</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'name'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'required'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'string'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'max:255'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'email'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'required'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'string'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'email'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'max:255'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'unique:users'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token operator\">=></span> <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">passwordRules</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'terms'</span> <span class=\"token operator\">=></span> <span class=\"token scope\">Jetstream<span class=\"token punctuation\">::</span></span><span class=\"token function\">hasTermsAndPrivacyPolicyFeature</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'required'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'accepted'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">validate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token scope\">User<span class=\"token punctuation\">::</span></span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'name'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$input</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'email'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$input</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'email'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'social_id'</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"hogehoge\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'provider'</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"MY_TWITTER\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'nickname'</span> <span class=\"token operator\">=></span> <span class=\"token string double-quoted-string\">\"Example\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token operator\">=></span> <span class=\"token scope\">Hash<span class=\"token punctuation\">::</span></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$input</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><img src=\"/679/3.png\" alt=\"画像\"></p>\n<h3>登録用View</h3>\n<p>登録用のViewはログインの時と同じように設定できます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">boot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">configurePermissions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token scope\">Jetstream<span class=\"token punctuation\">::</span></span><span class=\"token function\">deleteUsersUsing</span><span class=\"token punctuation\">(</span><span class=\"token scope\">DeleteUser<span class=\"token punctuation\">::</span></span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// ここ追加</span>\n        <span class=\"token scope\">Fortify<span class=\"token punctuation\">::</span></span><span class=\"token function\">registerView</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">view</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'auth.sample-register'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>またデフォルトのViewは以下にあります。</p>\n<p>resources\\views\\auth\\register.blade.php</p>\n<h3>メールアドレスの確認</h3>\n<p>登録時にメールアドレスの確認を行う機能も提供されていますが、デフォルトでは無効になっています。</p>\n<p>config\\fortify.phpのコメントアウト箇所のコメントアウトを外します。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token string single-quoted-string\">'features'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n        <span class=\"token scope\">Features<span class=\"token punctuation\">::</span></span><span class=\"token function\">registration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token scope\">Features<span class=\"token punctuation\">::</span></span><span class=\"token function\">resetPasswords</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// ここのコメントアウトを外す</span>\n        <span class=\"token scope\">Features<span class=\"token punctuation\">::</span></span><span class=\"token function\">emailVerification</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token scope\">Features<span class=\"token punctuation\">::</span></span><span class=\"token function\">updateProfileInformation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token scope\">Features<span class=\"token punctuation\">::</span></span><span class=\"token function\">updatePasswords</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token scope\">Features<span class=\"token punctuation\">::</span></span><span class=\"token function\">twoFactorAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'confirmPassword'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n</code></pre></div>\n<p>次にUserモデルのクラスにMustVerifyEmailインターフェースを実装させる必要があります。</p>\n<p>参考</p>\n<h2>プロファイル</h2>\n<p>プロファイル管理機能は、ユーザー名やメールアドレスの変更などの入口となっています。これらのバリデーションと更新は以下のクラスで行われます</p>\n<p>app\\Actions\\Fortify\\UpdateUserProfileInformation.php</p>\n<p>updateメソッドの引数になっている$userは現在ログインしているユーザー、そして$inputにはフォームの入力内容が設定されています。</p>\n<h3>プロファイルのView</h3>\n<p>Viewファイルは以下で定義されており自由にフォームを追加することができます。追加した内容は上述した$inputにて拾うことができます</p>\n<p>resources\\views\\profile\\update-profile-information-form.blade.php</p>\n<p>フォームを追加して確認する</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">update</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">,</span> <span class=\"token keyword type-hint\">array</span> <span class=\"token variable\">$input</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">dd</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$input</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><img src=\"/679/4.png\" alt=\"画像\"></p>\n<h3>アカウントの削除</h3>\n<p>プロファイル管理画面にあるアカウント削除を実行すると以下のクラスが実行されます。</p>\n<p>app\\Actions\\Jetstream\\DeleteUser.php</p>\n<p>この機能を無効化するにはconfig\\jetstream.phpの設定を修正します。Viewからも表示が消えます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token string single-quoted-string\">'features'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n        <span class=\"token comment\">// Features::termsAndPrivacyPolicy(),</span>\n        <span class=\"token comment\">// Features::profilePhotos(),</span>\n        <span class=\"token comment\">// Features::api(),</span>\n        <span class=\"token comment\">// Features::teams(['invitations' => true]),</span>\n        <span class=\"token comment\">//ここをコメントアウトする</span>\n        <span class=\"token comment\">//Features::accountDeletion(),</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n</code></pre></div>\n<h2>Livewire</h2>\n<p>アカウント削除ではLivewireモーダルコンポーネントがバックエンドと通信を行っています。（パスワードの確認）</p>\n<h3>bladeの読み込み</h3>\n<p>show.blade.phpではアカウント削除機能が有効の場合にdelete-user-formを表示するようになっています。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\">@<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token scope\">Laravel<span class=\"token punctuation\">\\</span>Jetstream<span class=\"token punctuation\">\\</span>Jetstream<span class=\"token punctuation\">::</span></span><span class=\"token function\">hasAccountDeletionFeatures</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">&#x3C;</span>x<span class=\"token operator\">-</span>jet<span class=\"token operator\">-</span>section<span class=\"token operator\">-</span>border <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n     <span class=\"token operator\">&#x3C;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"mt-10 sm:mt-0\"</span><span class=\"token operator\">></span>\n       @<span class=\"token function\">livewire</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'profile.delete-user-form'</span><span class=\"token punctuation\">)</span>\n     <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n@<span class=\"token keyword\">endif</span>\n</code></pre></div>\n<h3>ロジックの発火</h3>\n<p>bladeファイルを見るとなにやら処理を行っているのがわかります</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token operator\">&#x3C;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"mt-5\"</span><span class=\"token operator\">></span>\n   <span class=\"token operator\">&#x3C;</span>x<span class=\"token operator\">-</span>jet<span class=\"token operator\">-</span>danger<span class=\"token operator\">-</span>button wire<span class=\"token punctuation\">:</span>click<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"confirmUserDeletion\"</span> wire<span class=\"token punctuation\">:</span>loading<span class=\"token operator\">.</span>attr<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"disabled\"</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Delete Account'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n   <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>x<span class=\"token operator\">-</span>jet<span class=\"token operator\">-</span>danger<span class=\"token operator\">-</span>button<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n</code></pre></div>\n<p>モーダルを表示しているようですが、このメソッドの定義は以下にあります。</p>\n<p>vendor\\laravel\\jetstream\\src\\Http\\Livewire\\DeleteUserForm.phpに定義があります。</p>\n<p>ここがtrueになると実際のパスワード入力箇所が表示されるようになりますね。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token doc-comment comment\">/**\n     * Indicates if user deletion is being confirmed.\n     *\n     * <span class=\"token keyword\">@var</span> <span class=\"token class-name\"><span class=\"token keyword\">bool</span></span>\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$confirmingUserDeletion</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>パスワードのチェック処理を消してしまうことで、ボタンを押してユーザーを削除することもできます</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">deleteUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Request</span> <span class=\"token variable\">$request</span><span class=\"token punctuation\">,</span> <span class=\"token class-name type-declaration\">DeletesUsers</span> <span class=\"token variable\">$deleter</span><span class=\"token punctuation\">,</span> <span class=\"token class-name type-declaration\">StatefulGuard</span> <span class=\"token variable\">$auth</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">resetErrorBag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/*</span>\n<span class=\"token comment\">        if (! Hash::check($this->password, Auth::user()->password)) {</span>\n<span class=\"token comment\">            throw ValidationException::withMessages([</span>\n<span class=\"token comment\">                'password' => [__('This password does not match our records.')],</span>\n<span class=\"token comment\">            ]);</span>\n<span class=\"token comment\">        }</span>\n<span class=\"token comment\">        */</span>\n\n        <span class=\"token variable\">$deleter</span><span class=\"token operator\">-></span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token scope\">Auth<span class=\"token punctuation\">::</span></span><span class=\"token function\">user</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">fresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$auth</span><span class=\"token operator\">-></span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token function\">hasSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token function\">session</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">invalidate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token function\">session</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">regenerateToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>DeleteUserFormクラスのdeleteメソッドが呼ばれて、DeleteUserクラスのdeleteメソッドが呼ばれてデータベースからユーザーが削除されます。</p>\n<h5>おまけルーティングの設定</h5>\n<p>vendor\\laravel\\fortify\\routes\\routes.php</p>","slug":"p679"},"__N_SSG":true}