{"pageProps":{"frontMatter":{"title":"SpringBoot | jarファイルをUbuntu環境で実行する | Postgre","date":"2022.05.30","description":"SpringBoot | jarファイルをUbuntu環境で実行する | Postgre","categories":["Linux"]},"content":"<p>今回はVirtualBoxにUbuntuを入れて、SpringBootで作ったアプリを動かす環境を構築してみます。データベースのセットアップも必要になるので、データベースのセットアップが一番面倒でした。</p>\n<p>やること</p>\n<ul>\n<li>jarファイルを作成する</li>\n<li>共有フォルダを通してjarファイルを仮想環境で利用できるようにする</li>\n<li>Javaのインストール</li>\n<li>Postgreのインストール\n<ul>\n<li>ロールの追加</li>\n<li>追加したロールのパスワードを変更</li>\n<li>データベースの追加</li>\n<li>postgresql.confの修正</li>\n</ul>\n</li>\n<li>serviceの再起動</li>\n<li>jarファイルの実行</li>\n</ul>\n<h2>jarの準備</h2>\n<p>buildすることで\\build\\libsにjarファイルが作成されます。intellijからbuild実行しました。</p>\n<p><img src=\"/2616/1.png\" alt=\"画像\"></p>\n<h2>共有フォルダ</h2>\n<p>参考サイトの通りやると共有フォルダが使えましたので、jarファイルの移送ができました。</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\"># インストール\nsudo apt install virtualbox-guest-utils\n# マウント\nsudo mount.vboxsf a /var/webapp</code></pre></div>\n<ul>\n<li>ローカルPCのaというフォルダを共有フォルダにしていて、VirtualBoxでも名前をそのままaにしていたのでaになっています</li>\n<li>Ubuntu側は/var/webappを指定しましたが、jarさえ取得できればいいのでどこでもOKです</li>\n</ul>\n<p><img src=\"/2616/2.png\" alt=\"画像\"></p>\n<h2>Javaをインストール</h2>\n<p><img src=\"/2616/3.png\" alt=\"画像\"></p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo apt install openjdk-16-jre-headless</code></pre></div>\n<p>jarファイルを実行してみると、データベースを利用するアプリなので、データベースに接続できないエラーになります</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">./transactiontest-0.0.1-SNAPSHOT.jar</code></pre></div>\n<p><img src=\"/2616/4.png\" alt=\"画像\"></p>\n<h2>Postgreをインストール</h2>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo apt install postgresql</code></pre></div>\n<ul>\n<li>インストールでデフォルトのPostgresロールに関連しているpostgresユーザーが作成される</li>\n</ul>\n<p>postgresユーザーに切り替える</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo -i -u postgres</code></pre></div>\n<p>データベースを利用する</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">psql</code></pre></div>\n<p>パスワードの変更</p>\n<ul>\n<li>パスワードが設定されておらずアカウントロック状態</li>\n<li>これだとrootユーザーからでないとログインができない</li>\n<li>passwd postgres\n<ul>\n<li>パスワードを入力してパスワードの変更を行う</li>\n</ul>\n</li>\n</ul>\n<p>root権限で行います</p>\n<p><img src=\"/2616/5.png\" alt=\"画像\"></p>\n<p>直接postgresユーザーでデータベースにログイン</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo -u postgres psql</code></pre></div>\n<h3>ロールの追加</h3>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">createuser --interactive</code></pre></div>\n<ul>\n<li>–interactive\n<ul>\n<li>対話形式で作成します</li>\n</ul>\n</li>\n<li>createdb\n<ul>\n<li>データベースを作成します</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"/2616/6.png\" alt=\"画像\"></p>\n<p>Linuxユーザーを作成する</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo adduser kakine</code></pre></div>\n<p><img src=\"/2616/7.png\" alt=\"画像\"></p>\n<h2>作成したデータベースにログインする</h2>\n<ul>\n<li>通常はユーザー名と同じデータベースにログインされる</li>\n<li>psql -d {データベース名}でデータベースを指定してログインする</li>\n</ul>\n<p><img src=\"/2616/8.png\" alt=\"画像\"></p>\n<h2>postgresql.confの修正</h2>\n<p>postgresql.confを探します</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo find / -name postgresql.conf</code></pre></div>\n<p><img src=\"/2616/9.png\" alt=\"画像\"></p>\n<ul>\n<li>/etc/postgresql/12/main/にあることがわかります</li>\n</ul>\n<p><img src=\"/2616/10.png\" alt=\"画像\"></p>\n<ul>\n<li>listen_addressesのコメントアウトを消去します</li>\n</ul>\n<p>順番前後してしまい申し訳ないですが、SpringBootがユーザー名とパスワードでアクセスするために、作成したkakineユーザーのパスワードも変更しておきます</p>\n<p><img src=\"/2616/11.png\" alt=\"画像\"></p>\n<ul>\n<li>データベースにアクセスする</li>\n<li>kakineのパスワードを変更する</li>\n</ul>\n<p>そしてサービスを再起動します</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo service postgresql restart</code></pre></div>\n<p>ポートの状況を見ると5432が利用されていることがわかります</p>\n<p><img src=\"/2616/12.png\" alt=\"画像\"></p>\n<h2>jarの実行</h2>\n<p>もう一度jarファイルを実行します</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">./transactiontest-0.0.1-SNAPSHOT.jar</code></pre></div>\n<p><img src=\"/2616/13.png\" alt=\"画像\"></p>\n<p>アプリケーションが実行されていることがわかります</p>\n<p>ブラウザで確認してもSpringBootが実行されていることがわかります</p>\n<p><img src=\"/2616/14.png\" alt=\"画像\"></p>\n<h2>コマンドメモ</h2>\n<ul>\n<li>sudo apt install net-tools\n<ul>\n<li>ifconfigとか使えるようになります</li>\n</ul>\n</li>\n<li>サービスの再起動\n<ul>\n<li>sudo service postgresql restart</li>\n</ul>\n</li>\n<li>サービスの状態を確認\n<ul>\n<li>sudo service –status-all</li>\n</ul>\n</li>\n<li>ユーザーの切り替え\n<ul>\n<li>su – kakine</li>\n</ul>\n</li>\n</ul>\n<p>kakineロールのパスワードの変更</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">kakine@misaka:~$ psql -d school\npsql (12.11 (Ubuntu 12.11-0ubuntu0.20.04.1))\nType &#x26;quot;help&#x26;quot; for help.\n\nschool=# alter role kakine with password &#x26;#39;teitoku&#x26;#39;;\nALTER ROLE\nschool=# </code></pre></div>\n<h2>参考</h2>\n<ul>\n<li>VirtualBoxの共有フォルダーを使ってjarをコピーしています\n<ul>\n<li>https://sankame.github.io/blog/2020-04-30-virtualbox_share_folder/</li>\n</ul>\n</li>\n<li>Postgreのインストール\n<ul>\n<li>https://www.digitalocean.com/community/tutorials/how-to-install-postgresql-on-ubuntu-20-04-quickstart-ja</li>\n</ul>\n</li>\n</ul>","slug":"p2616"},"__N_SSG":true}