{"pageProps":{"frontMatter":{"title":"Linux | ユーザーとグループ","date":"2022.05.30","description":"Linux | ユーザーとグループ","categories":["Linux"]},"content":"<p>久しぶりにUbuntuを触ったので少しLinuxのユーザーについて勉強しました。</p>\n<p>Linuxのユーザーはグループに属することができます。</p>\n<ul>\n<li>グループは複数のユーザーに対して一括して権限を設定できる\n<ul>\n<li>ファイルやディレクトリに所有グループを設定できます</li>\n</ul>\n</li>\n<li>グループは主グループと補助グループがある</li>\n<li>ユーザーは必ず主グループに所属する必要がある</li>\n</ul>\n<h2>idコマンド</h2>\n<ul>\n<li>ユーザーの情報を見ることができます</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">misaka@misaka:~$ id misaka\nuid=1000(misaka) gid=1000(misaka) groups=1000(misaka),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),120(lpadmin),132(lxd),133(sambashare)\nmisaka@misaka:~$ id kakine\nuid=1001(kakine) gid=1001(kakine) groups=1001(kakine)\nmisaka@misaka:~$ id postgres\nuid=127(postgres) gid=135(postgres) groups=135(postgres),113(ssl-cert)\nmisaka@misaka:~$ </code></pre></div>\n<ul>\n<li>id kakine\n<ul>\n<li>手動で追加したユーザーなので最低限の情報が付与されている</li>\n<li>()の文字はIDに紐づく名前</li>\n</ul>\n</li>\n</ul>\n<h2>アカウント設定ファイル</h2>\n<ul>\n<li>/etc/passwd\n<ul>\n<li>ユーザーの基本情報</li>\n</ul>\n</li>\n<li>/etc/shadow\n<ul>\n<li>ハッシュ化されたパスワード情報</li>\n</ul>\n</li>\n<li>/etc/group\n<ul>\n<li>グループの基本情報</li>\n</ul>\n</li>\n</ul>\n<h3>passwd</h3>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">misaka@misaka:/etc$ sudo cat /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\ngdm:x:125:130:Gnome Display Manager:/var/lib/gdm3:/bin/false\nsssd:x:126:131:SSSD system user,,,:/var/lib/sss:/usr/sbin/nologin\nmisaka:x:1000:1000:misaka,,,:/home/misaka:/bin/bash\nsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\npostgres:x:127:135:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash\nkakine:x:1001:1001:kakine,,,:/home/kakine:/bin/bash</code></pre></div>\n<ul>\n<li>:区切りで情報が表示されています\n<ul>\n<li>ユーザー名</li>\n<li>パスワードpasswdでは表示せずxが格納される</li>\n<li>UIDユーザーに割り当てられているID</li>\n<li>GID主グループのグループID</li>\n<li>コメント</li>\n<li>ホームディレクトリ</li>\n<li>ログインシェル\n<ul>\n<li>passwdでは表示せずxが格納される</li>\n<li>ユーザーに割り当てられているID</li>\n<li>主グループのグループID</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3>shadow</h3>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">misaka@misaka:/etc$ sudo cat /etc/shadow\nroot:!:19140:0:99999:7:::\ndaemon:*:18858:0:99999:7:::\nbin:*:18858:0:99999:7:::\nsys:*:18858:0:99999:7:::\nsync:*:18858:0:99999:7:::\ngames:*:18858:0:99999:7:::\nmisaka:$6$s4ImRIkKlVPcY6yk$gDwQahh3N8C47rRdXS9i9uN2FAGYVhlxvQFH0Juu1X1or7/Kw3qoe6hIVjUH63LNIspZqWOEj.k3LscB4Y.Fh.:19140:0:99999:7:::\nsystemd-coredump:!!:19140::::::\npostgres:$6$LZ3ZK2vw9Op7V/cJ$phRALVjQEOwJqPeZYr5qh3Prlgqg2bL3cwYmPT.yqmX9qWVE1LXKHOhUar4DRZEbNsl74S3TYemVQo/fDVeJP0:19141:0:99999:7:::\nkakine:$6$WlGDxsM3wpGQN.H0$DdDIGrbXimxe6SjuGRnUxBzqYc/RLEuhExEBVXMPu8pkWePgH8HkyhItUmSI55ZZDjVuKa1onqEWCVgrKMXQW.:19141:0:99999:7:::\nmisaka@misaka:/etc$ </code></pre></div>\n<ul>\n<li>ユーザー</li>\n<li>ハッシュ化されたパスワード</li>\n<li>最終変更日\n<ul>\n<li>1969/12/31からの経過日数</li>\n</ul>\n</li>\n<li>変更可能最短日数\n<ul>\n<li>0はいつでも変更可能</li>\n</ul>\n</li>\n<li>パスワード有効期限</li>\n<li>警告日</li>\n<li>使用不可になるまでの日数\n<ul>\n<li>パスワードの有効期限が過ぎてから使用不可になるまでの日数</li>\n</ul>\n</li>\n<li>アカウント有効期限</li>\n<li>予備項目</li>\n</ul>\n<h3>group</h3>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">misaka@misaka:/etc$ sudo cat /etc/group\nroot:x:0:\ndaemon:x:1:\nbin:x:2:\nsys:x:3:\nmisaka:x:1000:\nsambashare:x:133:misaka\nsystemd-coredump:x:999:\nvboxsf:x:134:\npostgres:x:135:\nkakine:x:1001:</code></pre></div>\n<ul>\n<li>グループ名</li>\n<li>パスワード</li>\n<li>GID</li>\n<li>所属メンバー\n<ul>\n<li>補助グループのユーザー</li>\n</ul>\n</li>\n</ul>\n<h2>ユーザー追加時のデフォルト設定</h2>\n<p>/etc/login.defsが設定ファイル</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">misaka@misaka:/etc$ sudo cat /etc/login.defs\n#\n# Password aging controls:\n#\n#\tPASS_MAX_DAYS\tMaximum number of days a password may be used.\n#\tPASS_MIN_DAYS\tMinimum number of days allowed between password changes.\n#\tPASS_WARN_AGE\tNumber of days warning given before a password expires.\n#\nPASS_MAX_DAYS\t99999\nPASS_MIN_DAYS\t0\nPASS_WARN_AGE\t7\n\n#\n# Min/max values for automatic uid selection in useradd\n#\nUID_MIN\t\t\t 1000\nUID_MAX\t\t\t60000\n# System accounts\n#SYS_UID_MIN\t\t  100\n#SYS_UID_MAX\t\t  999</code></pre></div>\n<ul>\n<li>PASS_MAX_DAYS\n<ul>\n<li>パスワードの最大有効日数</li>\n</ul>\n</li>\n<li>UID_MIN\n<ul>\n<li>ここで指定した値以上のUIDがユーザー作成時に付与される</li>\n</ul>\n</li>\n</ul>\n<h2>グループの追加</h2>\n<ul>\n<li>groupadd -g 2000 school\n<ul>\n<li>-gでGIDを指定できる</li>\n</ul>\n</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo groupadd -g 9999 school</code></pre></div>\n<ul>\n<li>GIDを9999で作成</li>\n<li>schoolという名前のグループを作成</li>\n</ul>\n<h2>ユーザーの追加</h2>\n<ul>\n<li>useradd -u 9998 -g 9999 mejaha\n<ul>\n<li>-uでUIDを指定できる</li>\n<li>-gでGIDを指定できる</li>\n</ul>\n</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">misaka@misaka:~$ sudo groupadd -g 9999 school\nmisaka@misaka:~$ \nmisaka@misaka:~$ sudo useradd -u 9998 -g 9999 mejaha\nmisaka@misaka:~$ \nmisaka@misaka:~$ id mejaha\nuid=9998(mejaha) gid=9999(school) groups=9999(school)</code></pre></div>\n<ul>\n<li>GIDを指定したので指定したGIDに所属している</li>\n</ul>\n<h3>パスワードを確認する</h3>\n<p>今作ったユーザーはパスワードを設定してないのでどうなっているのか確認します</p>\n<p><img src=\"/2666/1.png\" alt=\"画像\"></p>\n<p>!になっていました。これがおそらくアカウントロック状態なのでしょうか。</p>\n<p>パスワードを変更して再度確認してみます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">misaka@misaka:~$ sudo passwd mejaha\n新しいパスワード: \n新しいパスワードを再入力してください: \npasswd: パスワードは正しく更新されました</code></pre></div>\n<p><img src=\"/2666/2.png\" alt=\"画像\"></p>\n<p>ハッシュ化されたパスワードが設定されています</p>\n<h2>参考</h2>\n<ul>\n<li>基礎からしっかり学ぶ Linux入門</li>\n</ul>","slug":"p2666"},"__N_SSG":true}