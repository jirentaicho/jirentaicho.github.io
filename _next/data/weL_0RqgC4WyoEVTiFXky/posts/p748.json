{"pageProps":{"frontMatter":{"title":"ソースで理解するWordPressの起動処理 １","date":"2021.12.26","description":"ソースで理解するWordPressの起動処理 １","categories":["WordPress"]},"content":"<p>ワードプレスはテーマを作ればOKみたいな風潮がありますが、コアのソースを見てメインクエリとサブクエリを理解したり、DB構造からタクソノミーを理解したりしていくと、ワードプレスって面白いって思えるようになります。（私はフロント側の実装が好きじゃないので特に）</p>\n<p>というわけで今回はWordPressの起動処理についてみていきます。</p>\n<h2>index.php</h2>\n<p>ワードプレスの最初の処理はここから始まります。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token doc-comment comment\">/**\n * Tells WordPress to load the WordPress theme and output it.\n *\n * <span class=\"token keyword\">@var</span> <span class=\"token class-name\"><span class=\"token keyword\">bool</span></span>\n */</span>\n<span class=\"token function\">define</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'WP_USE_THEMES'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token doc-comment comment\">/** Loads the WordPress Environment and Template */</span>\n<span class=\"token keyword\">require</span> <span class=\"token constant\">__DIR__</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/wp-blog-header.php'</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>WP_USE_THEMESという定数を定義しています。</p>\n<p>wp-blog-header.phpを見ていきます</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$wp_did_header</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token variable\">$wp_did_header</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// Load the WordPress library.</span>\n\t<span class=\"token keyword\">require_once</span> <span class=\"token constant\">__DIR__</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/wp-load.php'</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// Set up the WordPress query.</span>\n\t<span class=\"token function\">wp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// Load the theme template.</span>\n\t<span class=\"token keyword\">require_once</span> <span class=\"token constant\">ABSPATH</span> <span class=\"token operator\">.</span> <span class=\"token constant\">WPINC</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/template-loader.php'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ここで重要そうなものが登場していますね。wp-loadとwp関数です。ワードプレスそのもののセットアップを行っていそうですね。そしてそれが終わるとテーマの読み込みが走っています。</p>\n<p>wp-load.php</p>\n<p>まず最初に定数が定義されます</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token doc-comment comment\">/** Define ABSPATH as this file's directory */</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token function\">defined</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'ABSPATH'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">define</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'ABSPATH'</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">__DIR__</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>プラグインとかのソースを見ると頻出する定数「ABSPATH」です。これはつまりwp-load.phpが存在するパスということです。プラグイン開発する場合は頻出になると思います。</p>\n<p>その後はエラーレベルの設定とwp-config.phpのロードになります。wp-config.phpがない場合はインストール処理に進みます。</p>\n<p>wp-config.phpはデータベースの接続情報などを定義します。よくデータベースの情報なんだっけ？って時に見たりしてます。最後にwp-settings.phpを読み込んでいます。</p>\n<p>wp-settings.php</p>\n<p>ここでは大量のファイルを読み込んでいます。ワードプレス起動の準備をしているような感じ。処理もとても長いです。ワードプレスの共通関数ファイル群を読み込んだり、プラグインを読み込んだりしています。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token doc-comment comment\">/**\n * Stores the location of the WordPress directory of functions, classes, and core content.\n *\n * <span class=\"token keyword\">@since</span> 1.0.0\n */</span>\n<span class=\"token function\">define</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'WPINC'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'wp-includes'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token doc-comment comment\">/**\n * Version information for the current WordPress release.\n *\n * These can't be directly globalized in version.php. When updating,\n * we're including version.php from another installation and don't want\n * these values to be overridden if already set.\n *\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> <span class=\"token parameter\">$wp_version</span>             The WordPress version string.\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\"><span class=\"token keyword\">int</span></span>    <span class=\"token parameter\">$wp_db_version</span>          WordPress database version.\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> <span class=\"token parameter\">$tinymce_version</span>        TinyMCE version.\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> <span class=\"token parameter\">$required_php_version</span>   The required PHP version string.\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> <span class=\"token parameter\">$required_mysql_version</span> The required MySQL version string.\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> <span class=\"token parameter\">$wp_local_package</span>       Locale code of the package.\n */</span>\n<span class=\"token keyword\">global</span> <span class=\"token variable\">$wp_version</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$wp_db_version</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$tinymce_version</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$required_php_version</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$required_mysql_version</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$wp_local_package</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">require</span> <span class=\"token constant\">ABSPATH</span> <span class=\"token operator\">.</span> <span class=\"token constant\">WPINC</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/version.php'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">require</span> <span class=\"token constant\">ABSPATH</span> <span class=\"token operator\">.</span> <span class=\"token constant\">WPINC</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/load.php'</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>wp-includesフォルダのファイルを読み込んでいます。ここらのファイルはアクション系の関数とかが用意されています。</p>\n<p>タームを取得するときも、ここのディレクトリのファイルが実行されています。</p>\n<p>その後プラグインをロードします。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">wp_plugin_directory_constants</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token global\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'wp_plugin_paths'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Load must-use plugins.</span>\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">wp_get_mu_plugins</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$mu_plugin</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">include_once</span> <span class=\"token variable\">$mu_plugin</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token doc-comment comment\">/**\n\t * Fires once a single must-use plugin has loaded.\n\t *\n\t * <span class=\"token keyword\">@since</span> 5.1.0\n\t *\n\t * <span class=\"token keyword\">@param</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> <span class=\"token parameter\">$mu_plugin</span> Full path to the plugin's main file.\n\t */</span>\n\t<span class=\"token function\">do_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'mu_plugin_loaded'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$mu_plugin</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">unset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$mu_plugin</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>いわゆるmu-pluginsの読み込みを行います。mu-pluginsについては以下のように定義されています</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token function\">defined</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'WPMU_PLUGIN_DIR'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">define</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'WPMU_PLUGIN_DIR'</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">WP_CONTENT_DIR</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/mu-plugins'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Full path, no trailing slash.</span>\n\t<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>その後、テーマディレクトリを設定、有効プラグインのロードを行います。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Register the default theme directory root.</span>\n<span class=\"token function\">register_theme_directory</span><span class=\"token punctuation\">(</span> <span class=\"token function\">get_theme_root</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token function\">is_multisite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// Handle users requesting a recovery mode link and initiating recovery mode.</span>\n\t<span class=\"token function\">wp_recovery_mode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Load active plugins.</span>\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">wp_get_active_and_valid_plugins</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$plugin</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">wp_register_plugin_realpath</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$plugin</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">include_once</span> <span class=\"token variable\">$plugin</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token doc-comment comment\">/**\n\t * Fires once a single activated plugin has loaded.\n\t *\n\t * <span class=\"token keyword\">@since</span> 5.1.0\n\t *\n\t * <span class=\"token keyword\">@param</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> <span class=\"token parameter\">$plugin</span> Full path to the plugin's main file.\n\t */</span>\n\t<span class=\"token function\">do_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'plugin_loaded'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$plugin</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">unset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$plugin</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>plugins_loadedでプラグインの読み込みが完了すると、WP_Queryオブジェクトの生成やリライトルールに関するWP_Rewriteオブジェクトを生成します。メインクエリ実行するWPオブジェクトなどを生成していくと、その後テーマのセットアップが行われます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token doc-comment comment\">/**\n * WordPress Query object\n *\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\">WP_Query</span> <span class=\"token parameter\">$wp_the_query</span> WordPress Query object.\n * <span class=\"token keyword\">@since</span> 2.0.0\n */</span>\n<span class=\"token global\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'wp_the_query'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WP_Query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token doc-comment comment\">/**\n * Holds the reference to @see $wp_the_query\n * Use this global for WordPress queries\n *\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\">WP_Query</span> <span class=\"token parameter\">$wp_query</span> WordPress Query object.\n * <span class=\"token keyword\">@since</span> 1.5.0\n */</span>\n<span class=\"token global\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'wp_query'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token global\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'wp_the_query'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token doc-comment comment\">/**\n * Holds the WordPress Rewrite object for creating pretty URLs\n *\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\">WP_Rewrite</span> <span class=\"token parameter\">$wp_rewrite</span> WordPress rewrite component.\n * <span class=\"token keyword\">@since</span> 1.5.0\n */</span>\n<span class=\"token global\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'wp_rewrite'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WP_Rewrite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token doc-comment comment\">/**\n * WordPress Object\n *\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\">WP</span> <span class=\"token parameter\">$wp</span> Current WordPress environment instance.\n * <span class=\"token keyword\">@since</span> 2.0.0\n */</span>\n<span class=\"token global\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'wp'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token doc-comment comment\">/**\n * WordPress Widget Factory Object\n *\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\">WP_Widget_Factory</span> <span class=\"token parameter\">$wp_widget_factory</span>\n * <span class=\"token keyword\">@since</span> 2.8.0\n */</span>\n<span class=\"token global\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'wp_widget_factory'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WP_Widget_Factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token doc-comment comment\">/**\n * WordPress User Roles\n *\n * <span class=\"token keyword\">@global</span> <span class=\"token class-name\">WP_Roles</span> <span class=\"token parameter\">$wp_roles</span> WordPress role management object.\n * <span class=\"token keyword\">@since</span> 2.0.0\n */</span>\n<span class=\"token global\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'wp_roles'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WP_Roles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token doc-comment comment\">/**\n * Fires before the theme is loaded.\n *\n * <span class=\"token keyword\">@since</span> 2.6.0\n */</span>\n<span class=\"token function\">do_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'setup_theme'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>この後は、ロケール情報など設定後に、テーマのfunctions.phpと子テーマのfunctions.phpの読み込みを行います。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Load the functions for the active theme, for both parent and child theme if applicable.</span>\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">wp_get_active_and_valid_themes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$theme</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">file_exists</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$theme</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/functions.php'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">include</span> <span class=\"token variable\">$theme</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/functions.php'</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">unset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$theme</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>その後は現在のユーザーをセットアップして、タクソノミーやウィジェットのセットアップを行います。</p>\n<p>全てのプラグインやテーマがロードされるとwp_loadedアクションを実行して処理が完了します。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Set up current user.</span>\n<span class=\"token global\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'wp'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-></span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token doc-comment comment\">/**\n * Fires after WordPress has finished loading but before any headers are sent.\n *\n * Most of WP is loaded at this stage, and the user is authenticated. WP continues\n * to load on the <span class=\"token punctuation\">{</span><span class=\"token keyword\">@see</span> 'init'<span class=\"token punctuation\">}</span> hook that follows (e.g. widgets), and many plugins instantiate\n * themselves on it for all sorts of reasons (e.g. they need a user, a taxonomy, etc.).\n *\n * If you wish to plug an action once WP is loaded, use the <span class=\"token punctuation\">{</span><span class=\"token keyword\">@see</span> 'wp_loaded'<span class=\"token punctuation\">}</span> hook below.\n *\n * <span class=\"token keyword\">@since</span> 1.5.0\n */</span>\n<span class=\"token function\">do_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'init'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Check site status.</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">is_multisite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token function\">ms_site_check</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token constant boolean\">true</span> <span class=\"token operator\">!==</span> <span class=\"token variable\">$file</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">require</span> <span class=\"token variable\">$file</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">unset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$file</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token doc-comment comment\">/**\n * This hook is fired once WP, all plugins, and the theme are fully loaded and instantiated.\n *\n * Ajax requests should use wp-admin/admin-ajax.php. admin-ajax.php can handle requests for\n * users not logged in.\n *\n * <span class=\"token keyword\">@link</span> https://codex.wordpress.org/AJAX_in_Plugins\n *\n * <span class=\"token keyword\">@since</span> 3.0.0\n */</span>\n<span class=\"token function\">do_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'wp_loaded'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>ここまでくると、wp-blog-header.phpのwp関数が実行されます。また次回に。</p>","slug":"p748"},"__N_SSG":true}