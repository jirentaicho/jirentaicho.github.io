{"pageProps":{"frontMatter":{"title":"SpringBootでSpockテスト環境を作る","date":"2022.05.23","description":"SpringBootでSpockテスト環境を作る","categories":["Spring"]},"content":"<p>SpringBootとSpockでテストを行うための環境構築を行います。</p>\n<p>なんか全然動かなくて困った。。というわけで環境構築編ということでやったことをメモしていきます。</p>\n<p>起きたエラー</p>\n<ul>\n<li>No Tests found for given includes</li>\n<li>The Spock JUnit runner cannot execute because Spock 1.2.0-groovy-2.4 is not compatible with Groovy 3.0.10</li>\n</ul>\n<h2>環境構築</h2>\n<p>まずはbuild.gradleにてSpockとGroovyを使うように依存の追加を行います</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">plugins <span class=\"token punctuation\">{</span>\n\tid <span class=\"token string\">'org.springframework.boot'</span> version <span class=\"token string\">'2.6.7'</span>\n\tid <span class=\"token string\">'io.spring.dependency-management'</span> version <span class=\"token string\">'1.0.11.RELEASE'</span>\n\tid <span class=\"token string\">'java'</span>\n\tid <span class=\"token string\">'groovy'</span> <span class=\"token comment\">//追加</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token spread operator\">...</span><span class=\"token punctuation\">.</span>\n<span class=\"token property-access\">dependencies</span> <span class=\"token punctuation\">{</span>\n<span class=\"token spread operator\">...</span>\n\t<span class=\"token comment\">// spockのため</span>\n\ttestImplementation <span class=\"token string\">'org.springframework.boot:spring-boot-starter-test'</span>\n\ttestImplementation <span class=\"token string\">'org.spockframework:spock-spring:2.1-groovy-3.0'</span>\n\ttestImplementation <span class=\"token string\">'org.spockframework:spock-core:2.1-groovy-3.0'</span>\n\timplementation <span class=\"token string\">'org.codehaus.gmavenplus:gmavenplus-plugin:1.13.1'</span>\n\t<span class=\"token comment\">// SpockがJunit4でSpringBoot2.2以降がJunit5なので以下で対応</span>\n\ttestImplementation <span class=\"token string\">'org.junit.vintage:junit-vintage-engine:5.8.2'</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token spread operator\">...</span>\n</code></pre></div>\n<p>そしてテストクラスは以下のようなgroovyというパッケージを用意しておきます</p>\n<p><img src=\"/2548/1.png\" alt=\"画像\"></p>\n<p>テストクラスはテスト対象のクラスに対してAlt+Enterで作成して、作成したgroovyのパッケージに移動させました。</p>\n<p><img src=\"/2548/2.png\" alt=\"画像\"></p>\n<p>Groovyの設定ができてないってエラーになっています</p>\n<p><img src=\"/2548/3.png\" alt=\"画像\"></p>\n<p>Configure Groovy SDK…をクリックします</p>\n<p>ライブラリがないのでダウンロードにチェックを入れてOKを押します。この時groovy-4.0.0を選んでください。</p>\n<p><img src=\"/2548/4.png\" alt=\"画像\"></p>\n<p>これで表示が消えました</p>\n<p>あとクラスの右上にGradleのゾウさんマークがあって、そこをクリックしたらCannot resolve symbol ‘spock’ってエラーが消えました→すみませんクリックしたらエラーが解消されてしまったのでキャプチャとか取ってません</p>\n<p>これでテストが実行可能になりました</p>\n<p><img src=\"/2548/5.png\" alt=\"画像\"></p>\n<p>参考</p>\n<p>https://www.jetbrains.com/help/idea/getting-started-with-groovy.html#run_groovy</p>\n<h2>No Tests found for given includes</h2>\n<p>このまま実行しても「No Tests found for given includes」というエラーになりました。</p>\n<p>これを解消するにはIntelliJの右上の歯車マークからSettings画面を表示してBuild.Execution,DeploymentからGradleを選択して、Run tests usingのセレクトボックスからIntelliJ IDEAを選択します</p>\n<p><img src=\"/2548/6.png\" alt=\"画像\"></p>\n<p>これでエラーが消えて実行できるようになります。</p>\n<h2>The Spock JUnit runner cannot execute because Spock 1.2.0-groovy-2.4 is not compatible with Groovy 3.0.10</h2>\n<p>これはエラーの通りで、うっかりミスをしていました。実はライブラリのダウンロードの時に古いバージョンをダウンロードしてしまいました。</p>\n<p>プロジェクトを右クリックしてOpen Module Settingsからgroovyを選択して－ボタンを押すとライブラリを削除できます</p>\n<p><img src=\"/2548/7.png\" alt=\"画像\"></p>\n<p>そしたらプロジェクト右クリックでAdd Framework Support…を選択して、もう一度ダウンロードできます。</p>\n<p>もしダウンロード済でバージョンの指定だけしたい場合はUse libraryから選択できます</p>\n<p><img src=\"/2548/8.png\" alt=\"画像\"></p>\n<p>これでエラーなくテストが行えるようになりました。</p>\n<p><img src=\"/2548/9.png\" alt=\"画像\"></p>\n<p>次回は実際にテストコードを書いていきます</p>\n<h2>参考</h2>\n<ul>\n<li>https://luran.me/284\n<ul>\n<li>韓国語のサイトです</li>\n</ul>\n</li>\n</ul>","slug":"p2548"},"__N_SSG":true}