{"pageProps":{"frontMatter":{"title":"カスタムタクソノミーを理解する","date":"2021.12.07","description":"カスタムタクソノミーを理解する","categories":["WordPress"]},"content":"<p>前回はデータベースの定義からタクソノミーとタームがどういったものなのかを見ていきました。今回はより詳細を見ていきます。</p>\n<p>まずはタクソノミーというものから見ていきます。</p>\n<p>カテゴリとタグを付与した投稿を公開した際に、タクソノミーには、categoryとpost_tagというのがつけられていました。</p>\n<p><img src=\"/434/1.png\" alt=\"画像\"></p>\n<p>タクソノミーを知るにはコードを見るのが早いということで、見ていきます。少し長いですが初期化メソッドを全文載せます</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">create_initial_taxonomies</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">global</span> <span class=\"token variable\">$wp_rewrite</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token function\">did_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'init'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$rewrite</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string single-quoted-string\">'category'</span>    <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'post_tag'</span>    <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'post_format'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token doc-comment comment\">/**\n\t\t * Filters the post formats rewrite base.\n\t\t *\n\t\t * <span class=\"token keyword\">@since</span> 3.1.0\n\t\t *\n\t\t * <span class=\"token keyword\">@param</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> <span class=\"token parameter\">$context</span> Context of the rewrite base. Default 'type'.\n\t\t */</span>\n\t\t<span class=\"token variable\">$post_format_base</span> <span class=\"token operator\">=</span> <span class=\"token function\">apply_filters</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'post_format_rewrite_base'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'type'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$rewrite</span>          <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string single-quoted-string\">'category'</span>    <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'hierarchical'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'slug'</span>         <span class=\"token operator\">=></span> <span class=\"token function\">get_option</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'category_base'</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">get_option</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'category_base'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">'category'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'with_front'</span>   <span class=\"token operator\">=></span> <span class=\"token operator\">!</span> <span class=\"token function\">get_option</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'category_base'</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token variable\">$wp_rewrite</span><span class=\"token operator\">-></span><span class=\"token function\">using_index_permalinks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'ep_mask'</span>      <span class=\"token operator\">=></span> <span class=\"token constant\">EP_CATEGORIES</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'post_tag'</span>    <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'hierarchical'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'slug'</span>         <span class=\"token operator\">=></span> <span class=\"token function\">get_option</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'tag_base'</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">get_option</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'tag_base'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">'tag'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'with_front'</span>   <span class=\"token operator\">=></span> <span class=\"token operator\">!</span> <span class=\"token function\">get_option</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'tag_base'</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token variable\">$wp_rewrite</span><span class=\"token operator\">-></span><span class=\"token function\">using_index_permalinks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'ep_mask'</span>      <span class=\"token operator\">=></span> <span class=\"token constant\">EP_TAGS</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'post_format'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$post_format_base</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'slug'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$post_format_base</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name return-type\">false</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token function\">register_taxonomy</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token string single-quoted-string\">'category'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string single-quoted-string\">'post'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string single-quoted-string\">'hierarchical'</span>          <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'query_var'</span>             <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'category_name'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rewrite'</span>               <span class=\"token operator\">=></span> <span class=\"token variable\">$rewrite</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'category'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'public'</span>                <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_ui'</span>               <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_admin_column'</span>     <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'_builtin'</span>              <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'capabilities'</span>          <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'manage_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'manage_categories'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'edit_terms'</span>   <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'edit_categories'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'delete_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'delete_categories'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'assign_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'assign_categories'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_in_rest'</span>          <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rest_base'</span>             <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'categories'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rest_controller_class'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'WP_REST_Terms_Controller'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">register_taxonomy</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token string single-quoted-string\">'post_tag'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string single-quoted-string\">'post'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string single-quoted-string\">'hierarchical'</span>          <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'query_var'</span>             <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'tag'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rewrite'</span>               <span class=\"token operator\">=></span> <span class=\"token variable\">$rewrite</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'post_tag'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'public'</span>                <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_ui'</span>               <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_admin_column'</span>     <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'_builtin'</span>              <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'capabilities'</span>          <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'manage_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'manage_post_tags'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'edit_terms'</span>   <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'edit_post_tags'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'delete_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'delete_post_tags'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'assign_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'assign_post_tags'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_in_rest'</span>          <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rest_base'</span>             <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'tags'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rest_controller_class'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'WP_REST_Terms_Controller'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">register_taxonomy</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token string single-quoted-string\">'nav_menu'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string single-quoted-string\">'nav_menu_item'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string single-quoted-string\">'public'</span>            <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'hierarchical'</span>      <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'labels'</span>            <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'name'</span>          <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Navigation Menus'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'singular_name'</span> <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Navigation Menu'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'query_var'</span>         <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rewrite'</span>           <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_ui'</span>           <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'_builtin'</span>          <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_in_nav_menus'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">register_taxonomy</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token string single-quoted-string\">'link_category'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string single-quoted-string\">'link'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string single-quoted-string\">'hierarchical'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'labels'</span>       <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'name'</span>                       <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Link Categories'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'singular_name'</span>              <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Link Category'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'search_items'</span>               <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Search Link Categories'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'popular_items'</span>              <span class=\"token operator\">=></span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'all_items'</span>                  <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'All Link Categories'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'edit_item'</span>                  <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Edit Link Category'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'update_item'</span>                <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Update Link Category'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'add_new_item'</span>               <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Add New Link Category'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'new_item_name'</span>              <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'New Link Category Name'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'separate_items_with_commas'</span> <span class=\"token operator\">=></span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'add_or_remove_items'</span>        <span class=\"token operator\">=></span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'choose_from_most_used'</span>      <span class=\"token operator\">=></span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'back_to_items'</span>              <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'← Go to Link Categories'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'capabilities'</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'manage_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'manage_links'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'edit_terms'</span>   <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'manage_links'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'delete_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'manage_links'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'assign_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'manage_links'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'query_var'</span>    <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rewrite'</span>      <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'public'</span>       <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_ui'</span>      <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'_builtin'</span>     <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">register_taxonomy</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token string single-quoted-string\">'post_format'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string single-quoted-string\">'post'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string single-quoted-string\">'public'</span>            <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'hierarchical'</span>      <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'labels'</span>            <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'name'</span>          <span class=\"token operator\">=></span> <span class=\"token function\">_x</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Formats'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'post format'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'singular_name'</span> <span class=\"token operator\">=></span> <span class=\"token function\">_x</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Format'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'post format'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'query_var'</span>         <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rewrite'</span>           <span class=\"token operator\">=></span> <span class=\"token variable\">$rewrite</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'post_format'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_ui'</span>           <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'_builtin'</span>          <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_in_nav_menus'</span> <span class=\"token operator\">=></span> <span class=\"token function\">current_theme_supports</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'post-formats'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">register_taxonomy</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token string single-quoted-string\">'wp_theme'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'wp_template'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string single-quoted-string\">'public'</span>            <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'hierarchical'</span>      <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'labels'</span>            <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'name'</span>          <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Themes'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'singular_name'</span> <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Theme'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'query_var'</span>         <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rewrite'</span>           <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_ui'</span>           <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'_builtin'</span>          <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_in_nav_menus'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_in_rest'</span>      <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>やっていることは非常にシンプルです。register_taxonomyメソッドを呼び出してタクソノミーを登録しているだけです。</p>\n<p>ソースを見るとわかりますが実は多くのタクソノミーが存在していることがわかります。</p>\n<p>実際にテーマ作成時にタクソノミーを追加したいときは register_taxonomyメソッドを使います。</p>\n<p>第一引数にタクソノミー名、第二引数は投稿タイプ、第三引数はパラメータです。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">register_taxonomy</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token string single-quoted-string\">'category'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string single-quoted-string\">'post'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string single-quoted-string\">'hierarchical'</span>          <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'query_var'</span>             <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'category_name'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rewrite'</span>               <span class=\"token operator\">=></span> <span class=\"token variable\">$rewrite</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'category'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'public'</span>                <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_ui'</span>               <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_admin_column'</span>     <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'_builtin'</span>              <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'capabilities'</span>          <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'manage_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'manage_categories'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'edit_terms'</span>   <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'edit_categories'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'delete_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'delete_categories'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'assign_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'assign_categories'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_in_rest'</span>          <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rest_base'</span>             <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'categories'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rest_controller_class'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'WP_REST_Terms_Controller'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>ちなみに、実際の登録処理はregister_taxonomyメソッドの中で呼ばれるwp_insert_termメソッドが行いdo_actionで登録されますが、こちらは触る必要はございません。</p>\n<h2>テーマにカスタムタクソノミーを追加</h2>\n<p>register_taxonomyメソッドがどういったものなのかザックリ見たところでテーマにてカスタムタクソノミーを追加します</p>\n<p>関数リファレンス/register taxonomy</p>\n<p>その前にパラメータを少し確認しておきます。</p>\n<h3>capabilities</h3>\n<p>すみません、これはちょっと難しいと思いました。例えばカテゴリの場合は以下の権限設定になっています</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token string single-quoted-string\">'capabilities'</span>          <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t<span class=\"token string single-quoted-string\">'manage_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'manage_categories'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string single-quoted-string\">'edit_terms'</span>   <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'edit_categories'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string single-quoted-string\">'delete_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'delete_categories'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string single-quoted-string\">'assign_terms'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'assign_categories'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n</code></pre></div>\n<p>で、ユーザーのロールにmanage_categoriesというのが無かった場合はカテゴリの新規登録で401エラーになると思います。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">wp_newCategory</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$args</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">escape</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$args</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token variable\">$username</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$args</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$password</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$args</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$category</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$args</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">login</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$username</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$password</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token variable\">$user</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">error</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token doc-comment comment\">/** This action is documented in wp-includes/class-wp-xmlrpc-server.php */</span>\n\t\t<span class=\"token function\">do_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'xmlrpc_call'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'wp.newCategory'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$args</span><span class=\"token punctuation\">,</span> <span class=\"token this keyword\">$this</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// Make sure the user is allowed to add a category.</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token function\">current_user_can</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'manage_categories'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IXR_Error</span><span class=\"token punctuation\">(</span> <span class=\"token number\">401</span><span class=\"token punctuation\">,</span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Sorry, you are not allowed to add a category.'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>そんな感じで新規作成や編集といったアクションに対するユーザーの必要権限を定義しているのではないかなと思います。</p>\n<h2>簡単なカスタムタクソノミーを作成する</h2>\n<p>以下のメソッドをfunctions.phpに追加してください。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">my_register_taxonomy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">register_taxonomy</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token string single-quoted-string\">'my_test'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string single-quoted-string\">'post'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string single-quoted-string\">'label'</span> <span class=\"token operator\">=></span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Test'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'rewrite'</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'slug'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'test'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'hierarchical'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_ui'</span>           <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_admin_column'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string single-quoted-string\">'show_in_rest'</span>          <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'init'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'my_register_taxonomy'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4>show_admin_column</h4>\n<p>trueを設定すれば下図のように管理画面に表示できます。</p>\n<p><img src=\"/434/2.png\" alt=\"画像\"></p>\n<h4>show_in_rest</h4>\n<p>trueにしないと投稿画面に表示されません。trueにしていても show_uiがfalseだと表示されません。</p>\n<h2>投稿してみる</h2>\n<p>以下を投稿してみます</p>\n<p><img src=\"/434/3.png\" alt=\"画像\"></p>\n<p>新規で追加してみるとデータベースにも反映されているのがわかります</p>\n<p>リレーションテーブルを見ると投稿に対してタームタクソノミーが付与されています</p>\n<p><img src=\"/434/4.png\" alt=\"画像\"></p>\n<p>タームタクソノミーテーブルではmy_testというタクソノミーが設定されているのがわかります。(ここのid4は間違ってdbから消してしまいました)</p>\n<p><img src=\"/434/5.png\" alt=\"画像\"></p>\n<p>そしてタームテーブルではその詳細が見れます</p>\n<p><img src=\"/434/6.png\" alt=\"画像\"></p>\n<p>カスタムタクソノミーを追加することができました。データベースの構造と絡めてみると理解しやすいですね。</p>\n<p>ユーザーの権限については勉強不足で申し訳ないです、改めて勉強してみます。</p>","slug":"p434"},"__N_SSG":true}