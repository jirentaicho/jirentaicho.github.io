{"pageProps":{"frontMatter":{"title":"SpringBoot | FileUploadをPostmanからやってみる","date":"2022.07.27","description":"SpringBoot | FileUploadをPostmanからやってみる","categories":["Spring"]},"content":"<p>SpringBootでファイルの送信とアップロードをPostmanからやってみます。</p>\n<p>以前の記事にデータベースに対してバイト化した画像データを保存するということをやりましたが、今回はファイル自体を保存してみます。今回の方が超絶簡単です。</p>\n<p><a href=\"/posts/p511\">リンク</a></p>\n<h2>ファイルのアップロートを行う</h2>\n<p>以下のようなコントローラーを作成します</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FileController</span> <span class=\"token punctuation\">{</span>\n\t\n\t<span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/file/upload\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">upload</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">MultipartFile</span> file<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">getOriginalFilename</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"done\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>@RequestParamをつけてリクエストのパラメータを受け取ります</li>\n<li>MultipartFileはアップロードしたファイルに使う型です</li>\n<li>getOriginalFilenameで送信されたファイルのファイル名を取得します</li>\n</ul>\n<p>次にPostmanで送信します。かならずkeyは引数で使う変数名と同じfileにします。valueには画像を選択しています。</p>\n<p><img src=\"/3095/1.png\" alt=\"画像\"></p>\n<p>この状態でPostするとdoneという文字列が返ってきます。またログにはファイル名が出力されており、正常にファイルの送信ができていることを確認できます。</p>\n<p><img src=\"/3095/2.png\" alt=\"画像\"></p>\n<h2>ファイルの保存を行う</h2>\n<p>次にファイルを保存してみます。</p>\n<p>MultipartFile#transferToメソッドに指定のパスを渡してあげればいいだけです。</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FileController</span> <span class=\"token punctuation\">{</span>\n\t\n\t<span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/file/upload\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">upload</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">MultipartFile</span> file<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">getOriginalFilename</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tfile<span class=\"token punctuation\">.</span><span class=\"token function\">transferTo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Paths</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"main\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"resources\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"upload\"</span><span class=\"token punctuation\">,</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">getOriginalFilename</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"done\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>Paths.getにsrc/main/resources/uploadのフォルダとファイル名を渡してあげればPathオブジェクトが取得できます</li>\n<li>transferToメソッドにPathを指定してあげれば、アップロードされたファイルがそのフォルダに保存されます</li>\n</ul>\n<p><img src=\"/3095/3.png\" alt=\"画像\"></p>\n<p>予めuploadフォルダは作成しておいてください。</p>\n<p>Springでは簡単にファイルのアップロードができることがわかりました。</p>","slug":"p3095"},"__N_SSG":true}