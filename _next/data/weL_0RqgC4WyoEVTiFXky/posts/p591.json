{"pageProps":{"frontMatter":{"title":"Laravelメモ","date":"2021.12.13","description":"Laravelメモ","categories":["Laravel"]},"content":"<p>色々とプロジェクトで必要になりそうな以下のものをメモとリンクしました。</p>\n<ul>\n<li>Jetstream</li>\n<li>Socialite</li>\n<li>CKEeditor</li>\n<li>TinyMCE</li>\n</ul>\n<h2>Laravel8でvue3を利用するスタート</h2>\n<p>https://dev.to/rjzauner/getting-started-with-laravel-8-vue-3-and-tailwind-5gm9</p>\n<p>tailwind.config.jsは以下のようにしました。</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">module.exports = {\n  content: [\n    &#x26;quot;./index.html&#x26;quot;,\n    &#x26;quot;./src/**/*.{vue,js,ts,jsx,tsx}&#x26;quot;,\n  ],\n  purge: [&#x26;quot;./resources/**/*.vue&#x26;quot;],\n  theme: {\n    extend: {},\n  },\n  plugins: [],\n}\n</code></pre></div>\n<p>参考</p>\n<p>https://github.com/tusharmangle/laravel-vue-tailwind-starter</p>\n<h2>Vueのドキュメント</h2>\n<p>https://v3.ja.vuejs.org/guide/introduction.html</p>\n<h2>Vue3について</h2>\n<p>https://v3.ja.vuejs.org/guide/migration/introduction.html</p>\n<h2>コンポーネントを読みこんで表示する</h2>\n<p>App.vueからSample.vueを読み込む例</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&#x3C;</span>template<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"flex justify-center mt-24\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Sample</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span>script<span class=\"token operator\">></span>\n    <span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">Sample</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./components/Sample.vue'</span>\n    <span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">components</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token maybe-class-name\">Sample</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n</code></pre></div>\n<h2>Jetstream</h2>\n<p><a href=\"https://www.merges.co.jp/archives/2576\">参考</a></p>\n<h2>Socialite</h2>\n<p>https://readouble.com/laravel/8.x/ja/socialite.html</p>\n<p>上記の例ではgithubで決め打ちしているので、以下のようにproviderを取得すると応用が利きます</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$provider</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$reqeust</span><span class=\"token operator\">-></span><span class=\"token property\">provider</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$snsUser</span> <span class=\"token operator\">=</span> <span class=\"token scope\">Socialite<span class=\"token punctuation\">::</span></span><span class=\"token function\">driver</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$provider</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">user</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>emailについてはAPIの状態によっては取得できない（Twitterの場合は設定が必要）それだけでなくSNS側でメールアドレスを変更した際に不具合が出るため、コントローラーではID情報を利用するのが良さそう</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token scope\">User<span class=\"token punctuation\">::</span></span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'social_id'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$sns_user</span><span class=\"token operator\">-></span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\nトークンの設定\n<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n新規登録\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>emailについてはnull許容しておきます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">up</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token scope\">Schema<span class=\"token punctuation\">::</span></span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'users'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Blueprint</span> <span class=\"token variable\">$table</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-></span><span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-></span><span class=\"token keyword type-declaration\">string</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n            <span class=\"token comment\">// social_id</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-></span><span class=\"token keyword type-declaration\">string</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'social_id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">//$table->string('email')->unique();</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-></span><span class=\"token keyword type-declaration\">string</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'email'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">unique</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">nullable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-></span><span class=\"token function\">timestamp</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'email_verified_at'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">nullable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-></span><span class=\"token keyword type-declaration\">string</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-></span><span class=\"token function\">rememberToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-></span><span class=\"token function\">foreignId</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'current_team_id'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">nullable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-></span><span class=\"token keyword type-declaration\">string</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'profile_photo_path'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2048</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">nullable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-></span><span class=\"token function\">timestamps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ついでにsocial_idに値を入れるためUserモデルを修正する必要があります。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">protected</span> <span class=\"token variable\">$fillable</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'email'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'social_id'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//追加</span>\n        <span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>この場合は既存の認証処理をほぼSocialiteで書き換えてしまうので、別途用意したいなどの場合は別テーブルや別モデルを準備する。</p>\n<h2>CKEditor</h2>\n<p>この後で紹介するTinyMCEより直感的なので好きだが、jqueryが必要なので使う際は注意が必要です。いろいろ解説サイトがありすぎたので、一旦まとめます。</p>\n<p>以下のコマンドを実施</p>\n<p>webpack.mix.jsを修正</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">mix<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">js</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resources/js/app.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'public/js'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">copyDirectory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vendor/ckeditor/ckeditor'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'public/js/ckeditor'</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//追加</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">copyDirectory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vendor/tinymce/tinymce'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'public/js/tinymce'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">postCss</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resources/css/app.css'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'public/css'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-import'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tailwindcss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n</code></pre></div>\n<p>以下コマンドを実施</p>\n<p>ckeeditor-config.blade.phpを修正cdnでjqueryを読み込んでいます。必要に応じてここをローカルに取り込んだjqueryに修正できます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token operator\">&#x3C;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> Nothing in life is to be feared<span class=\"token punctuation\">,</span> it is only to be understood<span class=\"token operator\">.</span> Now is the time to understand more<span class=\"token punctuation\">,</span> so that we may fear less<span class=\"token operator\">.</span> <span class=\"token operator\">-</span> Marie Curie <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&#x3C;</span>script src<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"{{ asset('js/ckeditor/ckeditor.js') }}\"</span> referrerpolicy<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"origin\"</span><span class=\"token operator\">></span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> cdnを使っていますが必要に応じて変更します <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span>script\n  src<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"https://code.jquery.com/jquery-3.6.0.min.js\"</span>\n  integrity<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=\"</span>\n  crossorigin<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"anonymous\"</span><span class=\"token operator\">></span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span>script src<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"{{ asset('js/ckeditor/adapters/jquery.js') }}\"</span> referrerpolicy<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"origin\"</span><span class=\"token operator\">></span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span>script<span class=\"token operator\">></span>\n    $<span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'textarea'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token function\">ckeditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n</code></pre></div>\n<p>cke-editor.blade.php</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token operator\">&#x3C;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>form method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"post\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span>textarea id<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"mycke\"</span><span class=\"token operator\">></span>スーパースター！<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>textarea<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n</code></pre></div>\n<p>表示する。例としてwelcome画面から表示します。設定系の読み込みはbodyの閉じタグ以降に記載します。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> フォームの表示 <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span>x<span class=\"token operator\">-</span>forms<span class=\"token operator\">.</span>cke<span class=\"token operator\">-</span>editor<span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    \n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> 設定系の読み込み <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>x<span class=\"token operator\">-</span>head<span class=\"token operator\">.</span>ckeeditor<span class=\"token operator\">-</span>config<span class=\"token operator\">/</span><span class=\"token operator\">></span>\n</code></pre></div>\n<p><img src=\"/591/1.png\" alt=\"画像\"></p>\n<h2>TinyMCE</h2>\n<p>https://www.tiny.cloud/docs/integrations/laravel/laravel-composer-install/</p>\n<p>上記のサイトwebpack.mix.jsは以下のように私の場合では以下のようになった</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">mix<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">js</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resources/js/app.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'public/js'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">copyDirectory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vendor/tinymce/tinymce'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'public/js/tinymce'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">postCss</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resources/css/app.css'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'public/css'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-import'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tailwindcss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>参考サイト通り進めると以下のように表示される</p>\n<p><img src=\"/591/2.png\" alt=\"画像\"></p>\n<p>解説サイトによってはjsで読み込むという手法なのだが（これも実質そうなのだが）コンポーネント化してるのでlaravelっぽい記載になる。</p>","slug":"p591"},"__N_SSG":true}