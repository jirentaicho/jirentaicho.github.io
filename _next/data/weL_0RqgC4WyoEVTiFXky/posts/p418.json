{"pageProps":{"frontMatter":{"title":"WordPressのタームタクソノミーをデータベースから理解する","date":"2021.12.07","description":"WordPressのタームタクソノミーをデータベースから理解する","categories":["WordPress"]},"content":"<p>wordpressを使い始めたころは、mysqlにとりあえず繋げればOKで進めていましたが、データベースを理解するとwordpressについて詳しくなれるということでデータベースを勉強していきます。</p>\n<p>今回は、タクソノミー周りを中心に見ていきます。あとは主要なテーブルをザックリと眺めていきます。</p>\n<p>今回はdockerコンテナを利用しているので以下のようにしてmysqlを立ち上げます</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">D:\\docker\\wordpressmysql&#x26;gt;docker exec -it wordpressmysql_db_1 bash\nroot@9d80a3b7646a:/#\n\nroot@9d80a3b7646a:/# mysql -u wordpress -p\nEnter password:\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 13\nServer version: 8.0.19 MySQL Community Server - GPL\n\nCopyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType &#x26;#39;help;&#x26;#39; or &#x26;#39;\\h&#x26;#39; for help. Type &#x26;#39;\\c&#x26;#39; to clear the current input statement.\n\nmysql&#x26;gt;</code></pre></div>\n<h2>テーブル一覧</h2>\n<p>wordpressで利用しているテーブル一覧を見てみると以下のようになっています。</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">mysql&#x26;gt; show tables;\n+-----------------------+\n| Tables_in_wordpress   |\n+-----------------------+\n| wp_commentmeta        |\n| wp_comments           |\n| wp_links              |\n| wp_options            |\n| wp_postmeta           |\n| wp_posts              |\n| wp_term_relationships |\n| wp_term_taxonomy      |\n| wp_termmeta           |\n| wp_terms              |\n| wp_usermeta           |\n| wp_users              |\n+-----------------------+\n12 rows in set (0.00 sec)</code></pre></div>\n<p>と、思ったけどクライアントを使うことにしました。→プロンプトに表示しきれないので</p>\n<p>クライアントソフトは多々あるのですが、HeidiSQLをつかうことにしました。これはタブがバチバチに増えていかないので使いやすいです。</p>\n<h2>wp_users</h2>\n<p>ログインできるユーザーを管理しています。パスワードはハッシュ化されているので復元は難しそうです。</p>\n<p><img src=\"/418/1.png\" alt=\"画像\"></p>\n<h2>wp_options</h2>\n<p>様々なデータが登録されています。テーマ作成時にもここの値を利用することが多いのでうまくやれば超便利な予感がしますね。</p>\n<p><img src=\"/418/2.png\" alt=\"画像\"></p>\n<h2>wp_posts</h2>\n<p>記事のデータが登録されています。1つの記事には様々なステータスがあります。公開している記事が1つしかないのですが3のレコードが登録されています。</p>\n<p><img src=\"/418/3.png\" alt=\"画像\"></p>\n<p>post_statusによって下書き、継承、公開の3つに分かれています。もしもワークフローなど入れて承認とかも入れるとここのデータは大きくなりそうですね。</p>\n<p>ここのidはobject_idという名前で別テーブルと紐づいていたりします。</p>\n<h2>wp_term_relationships</h2>\n<p>ワードプレスの解説本を読んでもここが理解できませんでした。正直何言ってんだレベルでした。でも実際のデータベースを見れば正体がわかります。</p>\n<p>このテーブルはどのポストにどのタクソノミーが付与されているか管理しています。</p>\n<p>データベースを見るとカテゴリーやタグといったありそうなテーブルがありません。これらはタームタクソノミーという形で管理しているからです。</p>\n<p>このwp_term_relationshipsテーブルには、投稿IDとタームタクソノミーIDで、投稿とタームタクソノミーを紐づけています。</p>\n<p><img src=\"/418/4.png\" alt=\"画像\"></p>\n<p>object_idというのが投稿IDです。歴史的経緯でobject_idになっているそうです。2というのが公開中の記事データに該当しています。</p>\n<p>じゃあタームタクソノミーとはどういうものか見ていきましょう</p>\n<h2>wp_term_taxonomy</h2>\n<p>これはタームがなんのタクソノミーなのかを管理しています。</p>\n<p>急にここでタームとタクソノミーが分かれてしまいましたが、タームというのは詳細情報で、タクソノミーというのはジャンルのようなものですね。</p>\n<p>例えば「カテゴリー」に「日記」「勉強」とあった場合は、カテゴリーがタクソノミーで、日記と勉強はタームということになります。</p>\n<p><img src=\"/418/5.png\" alt=\"画像\"></p>\n<p>上図の場合は、term_idが1のものは、taxonomyがcategoryであるということです。</p>\n<p>となればあとはterm_idが何を指しているのかわかればよいですね</p>\n<h2>wp_terms</h2>\n<p>ここでタームについて管理しています。タームというのは詳細ということなのでそれがカテゴリーなのかタグなのかは関与していません。</p>\n<p><img src=\"/418/6.png\" alt=\"画像\"></p>\n<p>term_id1のラブライブはカテゴリーで、term_id2のラブライブはタグです。</p>\n<p>データベースからタームとタクソノミーがどのように紐づいているのか、そして投稿とどのように紐づいてるのかを見ていきました。</p>\n<p>次回はカスタムタクソノミーなどを行い使いこなせるようにしていきます</p>","slug":"p418"},"__N_SSG":true}