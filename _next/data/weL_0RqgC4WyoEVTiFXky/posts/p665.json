{"pageProps":{"frontMatter":{"title":"laravel8で配列をページネーションする","date":"2021.12.23","description":"laravel8で配列をページネーションする","categories":["Laravel"]},"content":"<p>こんな投稿を見つけた</p>\n<p>laravel8で、配列データをページネーションしたいです。</p>\n<p>まだ未解決なようですが、素晴らしいgistを見つけたので共有します。これで一発です</p>\n<p>https://gist.github.com/vluzrmos/3ce756322702331fdf2bf414fea27bcb</p>\n<h2>配列をページネーションするとは</h2>\n<p>laravelでシンプルにページネーションを実現する際のviewは以下のようになります。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">@foreach($models as $model)\n\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>P</span><span class=\"token punctuation\">></span></span>{{$model->title}}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>P</span><span class=\"token punctuation\">></span></span>\n\t\t@endforeach\n\t\t{{$models->links('vendor.pagination.bootstrap-4')}}\n</code></pre></div>\n<p>$modelsはこんな形で取得してきたらeloquentモデルのコレクションです</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$posts</span> <span class=\"token operator\">=</span> <span class=\"token scope\">post<span class=\"token punctuation\">::</span></span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'delete_flag'</span><span class=\"token punctuation\">,</span><span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">paginate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><img src=\"/665/1.png\" alt=\"画像\"></p>\n<p>このような形のものをページネーションするのは簡単ですが、配列の場合はどうなるのでしょうか？</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$posts</span> <span class=\"token operator\">=</span> <span class=\"token scope\">post<span class=\"token punctuation\">::</span></span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'delete_flag'</span><span class=\"token punctuation\">,</span><span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">paginate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$models</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$posts</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$post</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$model</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IndexViewModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$model</span><span class=\"token operator\">-></span><span class=\"token property\">title</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$post</span><span class=\"token operator\">-></span><span class=\"token property\">title</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$model</span><span class=\"token operator\">-></span><span class=\"token function\">setBody</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$post</span><span class=\"token operator\">-></span><span class=\"token property\">body</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">array_push</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$models</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$model</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n       \n        <span class=\"token keyword\">return</span> <span class=\"token function\">view</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"index\"</span> <span class=\"token punctuation\">,</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"models\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">Error\nCall to a member function links() on array </code></pre></div>\n<p>配列にはlinks()なんてメソッド無いので当然エラーになります。</p>\n<h2>使ってみるとこんな感じ</h2>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">toppage</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Request</span> <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$posts</span> <span class=\"token operator\">=</span> <span class=\"token scope\">post<span class=\"token punctuation\">::</span></span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'delete_flag'</span><span class=\"token punctuation\">,</span><span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$models</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$posts</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$post</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$model</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IndexViewModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$model</span><span class=\"token operator\">-></span><span class=\"token property\">title</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$post</span><span class=\"token operator\">-></span><span class=\"token property\">title</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$model</span><span class=\"token operator\">-></span><span class=\"token function\">setBody</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$post</span><span class=\"token operator\">-></span><span class=\"token property\">body</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">array_push</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$models</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$model</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">paginate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$models</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$request</span><span class=\"token operator\">-></span><span class=\"token property\">id</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       \n        <span class=\"token keyword\">return</span> <span class=\"token function\">view</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"index\"</span> <span class=\"token punctuation\">,</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"data\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">paginate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$items</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$perPage</span> <span class=\"token operator\">=</span> <span class=\"token number\">15</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$page</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$options</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$page</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$page</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token scope\">Paginator<span class=\"token punctuation\">::</span></span><span class=\"token function\">resolveCurrentPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$items</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$items</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Collection</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$items</span> <span class=\"token punctuation\">:</span> <span class=\"token scope\">Collection<span class=\"token punctuation\">::</span></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$items</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LengthAwarePaginator</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$items</span><span class=\"token operator\">-></span><span class=\"token function\">forPage</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$perPage</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$items</span><span class=\"token operator\">-></span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$perPage</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$page</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$options</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ViewにEntityModelを渡すがページネーションもできるというわけです。便利です</p>\n<p>素晴らしいgist、感謝します。</p>\n<h2>URLの設定</h2>\n<p>ページネーションを利用する際にはurlを設定しないとおかしなことになります。</p>\n<p>例えば記事一覧ページはpost?page=2のようにしないといけません。</p>\n<p>LengthAwarePaginatorのコンストラクタを見ると$optionsのpathをkeyにして受け取った文字列をurlとしています。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$items</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$total</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$perPage</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$currentPage</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword type-hint\">array</span> <span class=\"token variable\">$options</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">options</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$options</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$options</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$key</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token punctuation\">{</span><span class=\"token variable\">$key</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">total</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$total</span><span class=\"token punctuation\">;</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">perPage</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$perPage</span><span class=\"token punctuation\">;</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">lastPage</span> <span class=\"token operator\">=</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword type-casting\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$total</span> <span class=\"token operator\">/</span> <span class=\"token variable\">$perPage</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">path</span> <span class=\"token operator\">=</span> <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">path</span> <span class=\"token operator\">!==</span> <span class=\"token string single-quoted-string\">'/'</span> <span class=\"token operator\">?</span> <span class=\"token function\">rtrim</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">path</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">path</span><span class=\"token punctuation\">;</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">currentPage</span> <span class=\"token operator\">=</span> <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">setCurrentPage</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$currentPage</span><span class=\"token punctuation\">,</span> <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">pageName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">items</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$items</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Collection</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$items</span> <span class=\"token punctuation\">:</span> <span class=\"token scope\">Collection<span class=\"token punctuation\">::</span></span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$items</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>なので以下のようにしてあげればurlを設定できます</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">$viewModels = $this->paginate($temp_viewModels,3,$request->id,array('path' => '/pages'));\n</code></pre></div>","slug":"p665"},"__N_SSG":true}