{"pageProps":{"frontMatter":{"title":"SQLのメモ","date":"2021.12.09","description":"SQLのメモ","categories":["SQL"]},"content":"<p>久しぶりにSQLをコンソールから触ったら面白かったので少し遊んでみます。</p>\n<p>テーブル名を変更する</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># alter table lockman rename to characters;</span>\n<span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span>\nmisaka<span class=\"token operator\">=</span><span class=\"token comment\"># select * from characters;</span>\n id <span class=\"token operator\">|</span>     name\n<span class=\"token comment\">----+--------------</span>\n  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> 澁谷かのん\n  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> 唐可可\n  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> 平安名すみれ\n  <span class=\"token number\">4</span> <span class=\"token operator\">|</span> 嵐千砂都\n  <span class=\"token number\">5</span> <span class=\"token operator\">|</span> 葉月恋\n<span class=\"token punctuation\">(</span><span class=\"token number\">5</span> <span class=\"token keyword\">rows</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>テーブルを作成する</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># CREATE TABLE \"profile\" (</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># \"id\" INTEGER NULL,</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># \"description\" VARCHAR NULL</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># )</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># ;</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span>\nmisaka<span class=\"token operator\">=</span><span class=\"token comment\"># select * from profile;</span>\n id <span class=\"token operator\">|</span> description\n<span class=\"token comment\">----+-------------</span>\n</code></pre></div>\n<p>insert</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> profile <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span>description<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token string\">'誕生日：7月17日 / 血液型：O型 / 身長159㎝'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>外部結合１</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># SELECT *</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># FROM characters a</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># LEFT OUTER JOIN profile b</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># ON a.id = b.id</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># WHERE a.id = '1';</span>\n id <span class=\"token operator\">|</span>    name    <span class=\"token operator\">|</span> id <span class=\"token operator\">|</span>               description\n<span class=\"token comment\">----+------------+----+------------------------------------------</span>\n  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> 澁谷かのん <span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">5</span>月<span class=\"token number\">1</span>日 <span class=\"token operator\">/</span> 血液型：A型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">159</span>㎝\n<span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token keyword\">row</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>外部結合２</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># SELECT *</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># FROM characters a</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># LEFT OUTER JOIN profile b</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># ON a.id = b.id</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># WHERE a.id = '6'</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># ;</span>\n id <span class=\"token operator\">|</span>   name   <span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> description\n<span class=\"token comment\">----+----------+----+-------------</span>\n  <span class=\"token number\">6</span> <span class=\"token operator\">|</span> 涼風青葉 <span class=\"token operator\">|</span>    <span class=\"token operator\">|</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token keyword\">row</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>内部結合１</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># SELECT *</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># FROM characters a</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># INNER JOIN profile b</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># ON a.id = b.id</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># WHERE a.id = '3'</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># ;</span>\n id <span class=\"token operator\">|</span>     name     <span class=\"token operator\">|</span> id <span class=\"token operator\">|</span>                description\n<span class=\"token comment\">----+--------------+----+--------------------------------------------</span>\n  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> 平安名すみれ <span class=\"token operator\">|</span>  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">9</span>月<span class=\"token number\">28</span>日 <span class=\"token operator\">/</span> 血液型：AB型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">161</span>㎝\n<span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token keyword\">row</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>内部結合２</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># SELECT *</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># FROM characters a</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># INNER JOIN profile b</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># ON a.id = b.id</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># WHERE a.id = '6'</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># ;</span>\n id <span class=\"token operator\">|</span> name <span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> description\n<span class=\"token comment\">----+------+----+-------------</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">0</span> <span class=\"token keyword\">rows</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>カラムを追加</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># ALTER TABLE profile ADD hobby VARCHAR(20) NULL;</span>\n<span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span>\nmisaka<span class=\"token operator\">=</span><span class=\"token comment\"># select * from profile;</span>\n id <span class=\"token operator\">|</span>                description                 <span class=\"token operator\">|</span> hobby\n<span class=\"token comment\">----+--------------------------------------------+-------</span>\n  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">5</span>月<span class=\"token number\">1</span>日 <span class=\"token operator\">/</span> 血液型：A型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">159</span>㎝   <span class=\"token operator\">|</span>\n  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">7</span>月<span class=\"token number\">17</span>日 <span class=\"token operator\">/</span> 血液型：O型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">159</span>㎝  <span class=\"token operator\">|</span>\n  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">9</span>月<span class=\"token number\">28</span>日 <span class=\"token operator\">/</span> 血液型：AB型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">161</span>㎝ <span class=\"token operator\">|</span>\n  <span class=\"token number\">4</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">2</span>月<span class=\"token number\">25</span>日 <span class=\"token operator\">/</span> 血液型：B型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">155</span>㎝  <span class=\"token operator\">|</span>\n  <span class=\"token number\">5</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">11</span>月<span class=\"token number\">24</span>日 <span class=\"token operator\">/</span> 血液型：A型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">163</span>㎝ <span class=\"token operator\">|</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">5</span> <span class=\"token keyword\">rows</span><span class=\"token punctuation\">)</span>\n\n</code></pre></div>\n<p>update</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># UPDATE profile SET hobby = '短歌' WHERE id = 5;</span>\n<span class=\"token keyword\">UPDATE</span> <span class=\"token number\">1</span>\nmisaka<span class=\"token operator\">=</span><span class=\"token comment\"># select * from profile;</span>\n id <span class=\"token operator\">|</span>                description                 <span class=\"token operator\">|</span>  hobby\n<span class=\"token comment\">----+--------------------------------------------+----------</span>\n  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">5</span>月<span class=\"token number\">1</span>日 <span class=\"token operator\">/</span> 血液型：A型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">159</span>㎝   <span class=\"token operator\">|</span> 歌\n  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">7</span>月<span class=\"token number\">17</span>日 <span class=\"token operator\">/</span> 血液型：O型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">159</span>㎝  <span class=\"token operator\">|</span> コスプレ\n  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">9</span>月<span class=\"token number\">28</span>日 <span class=\"token operator\">/</span> 血液型：AB型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">161</span>㎝ <span class=\"token operator\">|</span> 読書\n  <span class=\"token number\">4</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">2</span>月<span class=\"token number\">25</span>日 <span class=\"token operator\">/</span> 血液型：B型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">155</span>㎝  <span class=\"token operator\">|</span> ダンス\n  <span class=\"token number\">5</span> <span class=\"token operator\">|</span> 誕生日：<span class=\"token number\">11</span>月<span class=\"token number\">24</span>日 <span class=\"token operator\">/</span> 血液型：A型 <span class=\"token operator\">/</span> 身長<span class=\"token number\">163</span>㎝ <span class=\"token operator\">|</span> 短歌\n<span class=\"token punctuation\">(</span><span class=\"token number\">5</span> <span class=\"token keyword\">rows</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>exists１</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># SELECT *</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># FROM characters</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># WHERE EXISTS (</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># SELECT 1 FROM profile</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># WHERE profile.hobby = '短歌'</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># );</span>\n id <span class=\"token operator\">|</span>     name\n<span class=\"token comment\">----+--------------</span>\n  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> 澁谷かのん\n  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> 唐可可\n  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> 平安名すみれ\n  <span class=\"token number\">4</span> <span class=\"token operator\">|</span> 嵐千砂都\n  <span class=\"token number\">5</span> <span class=\"token operator\">|</span> 葉月恋\n  <span class=\"token number\">6</span> <span class=\"token operator\">|</span> 涼風青葉\n<span class=\"token punctuation\">(</span><span class=\"token number\">6</span> <span class=\"token keyword\">rows</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>exists２</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># SELECT *</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># FROM characters</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># WHERE EXISTS (</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># SELECT 1 FROM profile</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># WHERE characters.id = profile.id</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># AND profile.hobby = '短歌'</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># );</span>\n id <span class=\"token operator\">|</span>  name\n<span class=\"token comment\">----+--------</span>\n  <span class=\"token number\">5</span> <span class=\"token operator\">|</span> 葉月恋\n<span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token keyword\">row</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>in</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># SELECT *</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># FROM characters</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># WHERE id IN (</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># SELECT id</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># FROM profile</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># WHERE hobby = 'ダンス'</span>\nmisaka<span class=\"token punctuation\">(</span><span class=\"token comment\"># );</span>\n id <span class=\"token operator\">|</span>   name\n<span class=\"token comment\">----+----------</span>\n  <span class=\"token number\">4</span> <span class=\"token operator\">|</span> 嵐千砂都\n<span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token keyword\">row</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>not in</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">misaka=# SELECT *\nmisaka-# FROM characters\nmisaka-# WHERE id NOT IN (\nmisaka(# SELECT id\nmisaka(# FROM profile\nmisaka(# WHERE hobby = 'ダンス'\nmisaka(# );\n id |     name\n----+--------------\n  1 | 澁谷かのん\n  2 | 唐可可\n  3 | 平安名すみれ\n  5 | 葉月恋\n  6 | 涼風青葉\n(5 rows)\n</code></pre></div>\n<p>自己結合</p>\n<p>カラム追加しました</p>\n<div class=\"remark-highlight\"><pre class=\"language-sql\"><code class=\"language-sql\">misaka<span class=\"token operator\">=</span><span class=\"token comment\"># select * from characters order by id;</span>\n id <span class=\"token operator\">|</span>     name     <span class=\"token operator\">|</span> sistersid <span class=\"token operator\">|</span> sistersname\n<span class=\"token comment\">----+--------------+-----------+-------------</span>\n  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> 澁谷かのん   <span class=\"token operator\">|</span>         <span class=\"token number\">7</span> <span class=\"token operator\">|</span> 澁谷ありあ\n  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> 唐可可       <span class=\"token operator\">|</span>           <span class=\"token operator\">|</span>\n  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> 平安名すみれ <span class=\"token operator\">|</span>           <span class=\"token operator\">|</span>\n  <span class=\"token number\">4</span> <span class=\"token operator\">|</span> 嵐千砂都     <span class=\"token operator\">|</span>           <span class=\"token operator\">|</span>\n  <span class=\"token number\">5</span> <span class=\"token operator\">|</span> 葉月恋       <span class=\"token operator\">|</span>           <span class=\"token operator\">|</span>\n  <span class=\"token number\">6</span> <span class=\"token operator\">|</span> 涼風青葉     <span class=\"token operator\">|</span>           <span class=\"token operator\">|</span>\n  <span class=\"token number\">7</span> <span class=\"token operator\">|</span> 澁谷ありあ   <span class=\"token operator\">|</span>         <span class=\"token number\">1</span> <span class=\"token operator\">|</span> 澁谷かのん\n<span class=\"token punctuation\">(</span><span class=\"token number\">7</span> <span class=\"token keyword\">rows</span><span class=\"token punctuation\">)</span>\n\nmisaka<span class=\"token operator\">=</span><span class=\"token comment\"># SELECT a.*</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># FROM characters a</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># INNER JOIN characters b</span>\nmisaka<span class=\"token operator\">-</span><span class=\"token comment\"># ON a.id = b.sistersid;</span>\n id <span class=\"token operator\">|</span>    name    <span class=\"token operator\">|</span> sistersid <span class=\"token operator\">|</span> sistersname\n<span class=\"token comment\">----+------------+-----------+-------------</span>\n  <span class=\"token number\">7</span> <span class=\"token operator\">|</span> 澁谷ありあ <span class=\"token operator\">|</span>         <span class=\"token number\">1</span> <span class=\"token operator\">|</span> 澁谷かのん\n  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> 澁谷かのん <span class=\"token operator\">|</span>         <span class=\"token number\">7</span> <span class=\"token operator\">|</span> 澁谷ありあ\n<span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token keyword\">rows</span><span class=\"token punctuation\">)</span>\n</code></pre></div>","slug":"p547"},"__N_SSG":true}