{"pageProps":{"frontMatter":{"title":"AndroidStudioでアプリを作るメモ","date":"2021.11.30","description":"AndroidStudioでアプリを作るメモ","categories":["Android"]},"content":"<p>以前、AndroidStudioでホームアプリと呼ぶのでしょうか？ネタで作ったのですが、今回はもう少しアプリっぽいアプリを作りました。のでメモです。</p>\n<p>今回はAndroidStudioを使ってKotlinで作るのを目標としました。</p>\n<h4>Viewの非表示</h4>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">videoView.visibility = View.INVISIBLE;\n</code></pre></div>\n<h4>動画を表示する</h4>\n<p>VideViewを使うとmp4形式などの動画ファイルをアプリ内で再生できます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>VideoView</span>\n   <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/my_videoView<span class=\"token punctuation\">\"</span></span>\n   <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span>\n   <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n</code></pre></div>\n<p>上記のViewViewをKotlin側で取得してビデオのパスを設定します。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">val videoView = findViewById<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>VideoView</span><span class=\"token punctuation\">></span></span>(R.id.my_videoView);\n        val videFilePath = \"android.resource://\" + packageName + \"/\" + R.raw.dun;\n\n        val uri = Uri.parse(videFilePath);\n        videoView.setVideoURI(uri);\n\n        val mediaController = MediaController(this);\n        videoView.setMediaController(mediaController);\n        mediaController.setAnchorView(videoView);\n</code></pre></div>\n<p>リソースファイル(mp4)はR.rawに保存しましたが、ディレクトリの作成方法が少し変わっています。</p>\n<p>File > New > Andorid Resource Directory を選択して、Resource typeにrawを選択してOKボタンを押します。</p>\n<p><img src=\"/174/1.png\" alt=\"画像\"></p>\n<p>するとres/rawフォルダが作成されるので、そこに動画ファイルを格納します。アイコンは?マークで赤線が出ますが問題はありません。</p>\n<p>ちなみに作成したアプリにはコントローラーを入れていないのですが、startメソッドで動画を開始できます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">val videoView = findViewById<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>VideoView</span><span class=\"token punctuation\">></span></span>(R.id.my_videoView);\n        val videFilePath = \"android.resource://\" + packageName + \"/\" + R.raw.dun;\n\n        val uri = Uri.parse(videFilePath);\n        videoView.setVideoURI(uri);\n\n        videoView.start();\n\n        /*\n        val mediaController = MediaController(this);\n        videoView.setMediaController(mediaController);\n        mediaController.setAnchorView(videoView);\n         */\n</code></pre></div>\n<h4>初期起動するアクティビティの指定</h4>\n<p>AndroidManifest.xmlのintent-filterを修正する。もともとMainActivityについていたものは消す。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token prolog\">&#x3C;?xml version=\"1.0\" encoding=\"utf-8\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>manifest</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>android</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://schemas.android.com/apk/res/android<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">package</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.example.uorya<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>application</span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>allowBackup</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@mipmap/ic_launcher<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@string/app_name<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>roundIcon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@mipmap/ic_launcher_round<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>supportsRtl</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>theme</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@style/Theme.UnkochanDokkan<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>activity</span>\n            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>.TitleScene<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>exported</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>intent-filter</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>action</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.action.MAIN<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>action</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>category</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.category.LAUNCHER<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>category</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>intent-filter</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>activity</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>activity</span>\n            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>.MainActivity<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>exported</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token comment\">&#x3C;!--</span>\n<span class=\"token comment\">            &#x3C;intent-filter></span>\n<span class=\"token comment\">                &#x3C;action android:name=\"android.intent.action.MAIN\" /></span>\n<span class=\"token comment\"></span>\n<span class=\"token comment\">                &#x3C;category android:name=\"android.intent.category.LAUNCHER\" /></span>\n<span class=\"token comment\">            &#x3C;/intent-filter></span>\n<span class=\"token comment\">            --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>activity</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>application</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>manifest</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<h4>Dialogを閉じる</h4>\n<p>dismissメソッドを使う</p>\n<h4>LinearLayoutがわかりやすい</h4>\n<p>要素を順番に並べるのがLinearLayoutです。</p>\n<p>android:orientation=”vertical”で縦方向に要素を並べます。難しいことを考えずに並べたい時にはLinearLayoutがおすすめ。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>LinearLayout</span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>vertical<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">></span></span>\n        \n</code></pre></div>\n<p>左右中央にセットしたい時はandroid:gravity=”center_horizontal”を指定します。</p>\n<p>注意するのはandroid:layout_width=”match_parent”にしておくことです。幅を広げておく必要がある感じです。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>LinearLayout</span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>vertical<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center_horizontal<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<h4>フラグメントから呼び出し元のアクティビティを取得</h4>\n<p>ダイアログフラグメントなどを表示したときに、フラグメントからアクティビティを取得する</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">// フラグメントを呼び出しているアクティビティの取得\nval activity = activity;\nval video = activity?.findViewById<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>VideoView</span><span class=\"token punctuation\">></span></span>(R.id.my_videoView);\nvideo?.visibility = View.VISIBLE;\nvideo?.start();\n</code></pre></div>\n<h4>VideoViewはsetOnPreparedListenerを利用してロードしてから再生する</h4>\n<p>参考http://blog.livedoor.jp/sen_ritsu/archives/51350872.html</p>\n<p>参考サイトにあるように動画パスを指定してすぐにstartメソッドを呼び出すのではなくコールバック関数の中で呼び出すが安全。</p>\n<p>しかも、一度このコールバック関数を登録しておくと、別の動画を再生したいときはURIを設定すると勝手に再生してくれるので便利です。</p>\n<p>コールバックの登録</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">videoView.setOnPreparedListener(OnPreparedListener { videoView.start() });\n</code></pre></div>\n<p>動画ファイルを再設定してロード後に自動再生</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">val video = activity?.findViewById<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>VideoView</span><span class=\"token punctuation\">></span></span>(R.id.my_videoView);\nval videFilePath = \"android.resource://\" + activity?.packageName + \"/\" + R.raw.dun;\n\nval uri = Uri.parse(videFilePath);\nvideo?.setVideoURI(uri);\n//video?.start(); いらない\n</code></pre></div>\n<h4>DialogFragmentをタッチで閉じないようにする</h4>\n<p>重要なメッセージをダイアログフラグメントで表示した際にタッチした際に閉じないようにする方法です</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">val dialog = ResultDialog();\ndialog.isCancelable = false;\ndialog.show(supportFragmentManager,\"result\");\n</code></pre></div>\n<p>これで明示的にdismissを呼び出してしか閉じることができません。</p>\n<h4>Listからランダムで要素を取得する</h4>\n<p>以下のようなリストがある。これは動画のIDを収めたリスト</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">val cutinMovieIdList : List<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Int</span><span class=\"token punctuation\">></span></span> = listOf<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Int</span><span class=\"token punctuation\">></span></span>(\n     R.raw.dhun,\n     R.raw.dun\n);\n</code></pre></div>\n<p>ランダム値に取得するのも別途実装の必要はない</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">// 動画のIDリストからランダムに取得\nfun getMovieIdItem(): Int{\n     val item = cutinMovieIdList.shuffled().take(1)[0];\n     return item;\n}\n</code></pre></div>\n<p>ちなみにこれを動画再生時に利用しています。アンチパターンか知らないですがとりあえずアプリ完成を目指してapplicationを利用しています。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">val appData = application as  AppData;\nval id = appData.getMovieIdItem();\nval videFilePath = \"android.resource://\" + packageName + \"/\" + id.toString();\nval uri = Uri.parse(videFilePath);\n</code></pre></div>\n<h4>発展型</h4>\n<p>本当はあまりよくないのですが（可読性が落ちるため）Mapの中にListを入れることもできます。※わけあってkeyに日本語が入ってます</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">// 音声ファイルのハッシュマップ\nval musicIdList : Map&#x3C;String,List<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Int</span><span class=\"token punctuation\">></span></span>> = hashMapOf(\n    \"仕事\" to listOf(R.raw.rec,R.raw.doo),\n);\n</code></pre></div>\n<h4>タイトルバーを消す</h4>\n<p>res/values/themes/themes.xmlに追加</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>windowNoTitle<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>item</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>windowActionBar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>false<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>item</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:windowFullscreen<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>item</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:windowContentOverlay<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>@null<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>item</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<h4>アクティビィティで戻るボタンを無効化する</h4>\n<p>onBackPressedをオーバーライドして空振りさせる</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">override fun onBackPressed() {\n    }\n</code></pre></div>","slug":"p174"},"__N_SSG":true}