{"pageProps":{"frontMatter":{"title":"Collection型とarray_map","date":"2021.12.16","description":"Collection型とarray_map","categories":["Laravel"]},"content":"<p>LaravelのCollection型は配列ではないのでarray_mapで利用できません。そのため取得時にall()を使うことでarray_mapに適合できます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$stocks</span> <span class=\"token operator\">=</span> <span class=\"token scope\">Stock<span class=\"token punctuation\">::</span></span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'user_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'0000'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$viewModels</span> <span class=\"token operator\">=</span> <span class=\"token function\">array_map</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token class-name type-declaration\">Stock</span> <span class=\"token variable\">$stock</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token variable\">$viewModel</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StockViewModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token variable\">$viewModel</span><span class=\"token operator\">-></span><span class=\"token function\">setBody</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$stock</span><span class=\"token operator\">-></span><span class=\"token property\">body</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token variable\">$viewModel</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n            <span class=\"token variable\">$stocks</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">view</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'buy.all'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'viewModels'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>toArray()を使った場合は上記の処理に失敗します。</p>\n<p>function(Stock $stock) {で渡されるのがStockでなくarrayになってしまう。</p>\n<p>toArrayを使うと中身までarrayになってしまうとのことです。</p>\n<p>参考</p>\n<p>参考</p>","slug":"p651"},"__N_SSG":true}