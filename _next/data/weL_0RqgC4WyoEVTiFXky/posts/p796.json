{"pageProps":{"frontMatter":{"title":"WordPressでプラグイン開発をする２","date":"2021.12.28","description":"WordPressでプラグイン開発をする２","categories":["WordPress"]},"content":"<p>前回はプラグインを有効化することで管理者メニューにメニューを追加させて、optionsテーブルを利用した値の保存を行いました。</p>\n<p>今回はプラグインを無効化した時の処理を行います。</p>\n<p>例えばプラグインを無効化したときはoptionsテーブルから該当のレコードを取り除きたいというケースを考えます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">AnimeList</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">register_activation_hook</span><span class=\"token punctuation\">(</span> <span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'init'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'admin_menu'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'anime_list_admin_page'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'admin_init'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'register_animelist_setting'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//　追加する</span>\n        <span class=\"token function\">register_deactivation_hook</span><span class=\"token punctuation\">(</span> <span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'deactivation'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">deactivation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">delete_option</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'animelist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n省略\n</code></pre></div>\n<p>register_activation_hookでは有効化時なので、register_deactivation_hookは無効化時というのは直感で理解できるかと思います。</p>\n<p>これでプラグインを無効化するとoptionsテーブルからレコードが消えています。</p>\n<p><img src=\"/796/1.png\" alt=\"画像\"></p>","slug":"p796"},"__N_SSG":true}