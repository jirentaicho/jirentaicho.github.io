{"pageProps":{"frontMatter":{"title":"C# | yamlファイルを作成するアプリを作る","date":"2021.10.04","description":"C# | yamlファイルを作成するアプリを作る","categories":["WPF"]},"content":"<p>この辺からわけのわからないことを言い始めるかと思います。私自身はMVVMの境地に立っていないので、とりあえずで実装を進めています。C#も久々過ぎてプロパティすら曖昧です＞＜</p>\n<p>あくまで一例だと思っていただければと思います。</p>\n<p>今回作るのは、画面の入力を元にyamlファイルを作成するアプリケーションです。</p>\n<h2>画面</h2>\n<p>簡単に画面を紹介します。</p>\n<p><img src=\"/85/1.png\" alt=\"画像\"></p>\n<p>右はpageを使って、左はメニューです。</p>\n<p>最初にyamlファイルを開くとゲーム設定ページに遷移できるようにしました。</p>\n<p>ゲーム設定ページでは簡単に２つのデータを登録します。Saveボタンを押してyamlオブジェクトにフォームの内容を反映させて、メニュー上部の保存からファイルに出力します。</p>\n<p><img src=\"/85/2.png\" alt=\"画像\"></p>\n<h2>今回使用するYamlクラス</h2>\n<p>yamlクラスは以下のようなものです。</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">YamlData</span>\n    <span class=\"token punctuation\">{</span>\n        \n        <span class=\"token keyword\">public</span> string sample <span class=\"token punctuation\">{</span> get<span class=\"token punctuation\">;</span> set<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">//　ここに値を入れてみます</span>\n        <span class=\"token keyword\">public</span> string dbname <span class=\"token punctuation\">{</span> get<span class=\"token punctuation\">;</span> set<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2>Yamlオブジェクトを管理するクラス</h2>\n<p>シリアライズ、デシアライズ対象となるyamlオブジェクトを管理するクラスを、YamlManagerクラスとして作成しました。</p>\n<p>これはシングルトンクラスとして、管理することで常に同一のyamlデータを扱えるようにします。</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">YamlManager</span>\n    <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">YamlManager</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">YamlManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">YamlData</span> yamlData <span class=\"token punctuation\">{</span> set<span class=\"token punctuation\">;</span> get<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">private</span> <span class=\"token class-name\">YamlManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">YamlManager</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">/// &#x3C;summary></span>\n        <span class=\"token comment\">/// yamlDataが設定されているかどうか確認します。</span>\n        <span class=\"token comment\">/// &#x3C;/summary></span>\n        <span class=\"token comment\">/// &#x3C;returns>&#x3C;/returns></span>\n        <span class=\"token keyword\">public</span> bool <span class=\"token function\">hasSetYaml</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>yamlData <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>MainWindowのコンストラクタでyamlManagerを取得しています。シングルトンクラスなので、どこから取得しても同じ結果ですが。。。</p>\n<p>また、yamlと関係ないですが、xamlのほうで定義しているframeに対してPage1を設定します。</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">MainWindow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">InitializeComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">Uri</span> uri <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Page1.xaml\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UriKind<span class=\"token punctuation\">.</span>Relative</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\"><span class=\"token namespace\">myFrame<span class=\"token punctuation\">.</span></span>Source</span> <span class=\"token operator\">=</span> uri<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// また最初にYamlManagerをインスタンス化しておく＝シングルトンクラスです。</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>yamlManager <span class=\"token operator\">=</span> <span class=\"token class-name\">YamlManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>yamlファイルを開いたら、左側のメニューを活性化します。ゲーム設定をダブルクリックすると、SetUpConfigPageが呼ばれます。ここでPage2.xamlをframeに設定します。</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">OpenYamlFile</span><span class=\"token punctuation\">(</span>object sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RoutedEventArgs</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> dialog <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OpenFileDialog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\"><span class=\"token namespace\">dialog<span class=\"token punctuation\">.</span></span>Filter</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"YAMLファイル (*.yml)|*.yml|全てのファイル (*.*)|*.*\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token namespace\">dialog<span class=\"token punctuation\">.</span></span>ShowDialog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">var</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StreamReader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token namespace\">dialog<span class=\"token punctuation\">.</span></span>FileName</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Encoding</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">var</span> sy <span class=\"token operator\">=</span> <span class=\"token class-name\"><span class=\"token namespace\">reader<span class=\"token punctuation\">.</span></span>ReadToEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\"><span class=\"token namespace\">reader<span class=\"token punctuation\">.</span></span>Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">var</span> deserializer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeserializerBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">WithNamingConvention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UnderscoredNamingConvention<span class=\"token punctuation\">.</span>Instance</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// see height_in_inches in sample yml </span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">Build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// yamlのデータを取得する</span>\n                <span class=\"token keyword\">var</span> yamldata <span class=\"token operator\">=</span> <span class=\"token class-name\"><span class=\"token namespace\">deserializer<span class=\"token punctuation\">.</span></span>Deserialize</span><span class=\"token generics\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">YamlData</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>sy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>yamlManager<span class=\"token punctuation\">.</span>yamlData <span class=\"token operator\">=</span> yamldata<span class=\"token punctuation\">;</span>\n\n                <span class=\"token class-name\">MessageBox<span class=\"token punctuation\">.</span>Show</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>yamlManager<span class=\"token punctuation\">.</span>yamlData<span class=\"token punctuation\">.</span>sample<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// 色々と設定する。</span>\n                <span class=\"token class-name\"><span class=\"token namespace\">this<span class=\"token punctuation\">.</span></span>InitializeLeftSideBar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n\n        <span class=\"token comment\">/// &#x3C;summary></span>\n        <span class=\"token comment\">/// yamlを読み込んだら左サイドバーを活性化します。</span>\n        <span class=\"token comment\">/// &#x3C;/summary></span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">InitializeLeftSideBar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\"><span class=\"token namespace\">mylistview<span class=\"token punctuation\">.</span></span>IsEnabled</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">SetUpConfigPage</span><span class=\"token punctuation\">(</span>object sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RoutedEventArgs</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Uri</span> uri <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Page2.xaml\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UriKind<span class=\"token punctuation\">.</span>Relative</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\"><span class=\"token namespace\">myFrame<span class=\"token punctuation\">.</span></span>Source</span> <span class=\"token operator\">=</span> uri<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>一応xamlファイルはこんな感じです。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>DockPanel</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Menu</span> <span class=\"token attr-name\">DockPanel.Dock</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Top<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>MenuItem</span> <span class=\"token attr-name\">Header</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>開く<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OpenYamlFile<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>MenuItem</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>MenuItem</span> <span class=\"token attr-name\">Header</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>保存<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SaveYamlFile<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>MenuItem</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>Menu</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Grid</span> <span class=\"token attr-name\">DockPanel.Dock</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Top<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Grid.ColumnDefinitions</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>ColumnDefinition</span> <span class=\"token attr-name\">Width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0.2* <span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>ColumnDefinition</span> <span class=\"token attr-name\">Width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0.8* <span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>Grid.ColumnDefinitions</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Grid.RowDefinitions</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>RowDefinition</span> <span class=\"token attr-name\">Height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0.5*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>RowDefinition</span> <span class=\"token attr-name\">Height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0.5*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>Grid.RowDefinitions</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>ListBox</span> <span class=\"token attr-name\"><span class=\"token namespace\">x:</span>Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mylistview<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Grid.RowSpan</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Grid.Row</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Grid.Column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">IsEnabled</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>False<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>ListBoxItem</span> <span class=\"token attr-name\">MouseDoubleClick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SetUpConfigPage<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ゲーム設定<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>ListBoxItem</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>ListBox</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>ScrollViewer</span> <span class=\"token attr-name\">Grid.Row</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Grid.Column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Grid.ColumnSpan</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Grid.RowSpan</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Frame</span> <span class=\"token attr-name\">NavigationUIVisibility</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>myFrame<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>ScrollViewer</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>Grid</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>DockPanel</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<h2>フォーム内容をyamlオブジェクトに反映して保存する</h2>\n<p>yamlオブジェクトに反映というのは、変数に値を割り当てる行為です。</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">SaveYamlObject</span><span class=\"token punctuation\">(</span>object sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RoutedEventArgs</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> yamlManager <span class=\"token operator\">=</span> <span class=\"token class-name\">YamlManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// dbnameにテクストボックスの値を指定します（今回は特にバリデーションなどしていません）</span>\n            yamlManager<span class=\"token punctuation\">.</span>yamlData<span class=\"token punctuation\">.</span>sample <span class=\"token operator\">=</span> <span class=\"token class-name\"><span class=\"token namespace\">page2TextBox<span class=\"token punctuation\">.</span></span>Text</span><span class=\"token punctuation\">;</span>\n            yamlManager<span class=\"token punctuation\">.</span>yamlData<span class=\"token punctuation\">.</span>dbname <span class=\"token operator\">=</span> <span class=\"token class-name\"><span class=\"token namespace\">page2dbtextbox<span class=\"token punctuation\">.</span></span>Text</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// メッセージ内容は適当です。</span>\n            <span class=\"token class-name\">MessageBox<span class=\"token punctuation\">.</span>Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"画面内容を保存しました。\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>これはSAVEボタンを押したときの処理です。シングルトンクラスにしているため、このようにどのPageクラスから参照しても同じオブジェクトなので、直接値を代入してしまっています。</p>\n<p>xamlも一応記載します。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Grid</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Label</span> <span class=\"token attr-name\"><span class=\"token namespace\">x:</span>Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>page2lave<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HorizontalAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Left<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Margin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0,10,0,0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">VerticalAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Top<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>TextBox</span> <span class=\"token attr-name\"><span class=\"token namespace\">x:</span>Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>page2TextBox<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HorizontalAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Left<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Margin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0,40,0,0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">TextWrapping</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Wrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">VerticalAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Top<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>120<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        \n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Label</span> <span class=\"token attr-name\"><span class=\"token namespace\">x:</span>Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>page2dblavel<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HorizontalAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Left<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Margin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10,81,0,0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">VerticalAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Top<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>TextBox</span>  <span class=\"token attr-name\"><span class=\"token namespace\">x:</span>Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>page2dbtextbox<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HorizontalAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Left<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Margin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10,123,0,0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">TextWrapping</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Wrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">VerticalAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Top<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>120<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Button</span> <span class=\"token attr-name\">Click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SaveYamlObject<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SAVE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HorizontalAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Left<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Margin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20,193,0,0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">VerticalAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Top<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>Grid</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<h2>ファイルに書き出す（保存）</h2>\n<p>メニュー上部の保存ボタンを押したときに、yamlオブジェクトをシリアライズしてyamlファイルとして書き出します。</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">SaveYamlFile</span><span class=\"token punctuation\">(</span>object sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RoutedEventArgs</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n\n            <span class=\"token comment\">// そもそも開いてなければFalse</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>yamlManager<span class=\"token punctuation\">.</span><span class=\"token function\">hasSetYaml</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">MessageBox<span class=\"token punctuation\">.</span>Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"YAMLデータが作成されていません。\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">var</span> serializer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SerializerBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">WithNamingConvention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CamelCaseNamingConvention<span class=\"token punctuation\">.</span>Instance</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">Build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">var</span> yaml <span class=\"token operator\">=</span> <span class=\"token class-name\"><span class=\"token namespace\">serializer<span class=\"token punctuation\">.</span></span>Serialize</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>yamlManager<span class=\"token punctuation\">.</span>yamlData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// trueは追加書き込みでした。</span>\n            <span class=\"token keyword\">var</span> writer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StreamWriter</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"C:\\Users\\kirino\\Documents\\result2.yaml\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Encoding</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\"><span class=\"token namespace\">writer<span class=\"token punctuation\">.</span></span>Write</span><span class=\"token punctuation\">(</span>yaml<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\"><span class=\"token namespace\">writer<span class=\"token punctuation\">.</span></span>Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">MessageBox<span class=\"token punctuation\">.</span>Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"保存しました。\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>以下の内容でSAVEボタンを押して、保存して出力されるファイルを確認してみます。</p>\n<p><img src=\"/85/3.png\" alt=\"画像\"></p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">sample: ギャラクシー\ndbname: Postgre\n</code></pre></div>\n<p>想定通りの動きになっていました。</p>","slug":"p85"},"__N_SSG":true}