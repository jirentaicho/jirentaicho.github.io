{"pageProps":{"frontMatter":{"title":"springfoxでSwaggerを使い、静的ファイル出力する","date":"2022.10.03","description":"springfoxでSwaggerを使い、静的ファイル出力する","categories":["Swagger"]},"content":"<p>前回の記事</p>\n<p><a href=\"/posts/p3796\">リンク</a></p>\n<p>springfoxを利用することで、APIドキュメントを自動生成することができます。</p>\n<h2>springfoxを利用してみる</h2>\n<p>以下の依存を追加します</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">implementation <span class=\"token string\">'io.springfox:springfox-boot-starter:3.0.0'</span>\n</code></pre></div>\n<p>SpringBootのバージョンによって起動時にエラーになってしまうのですが、application.yamlに以下のような記載をすれば問題ありません。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token literal-property property\">spring</span><span class=\"token operator\">:</span>\n  <span class=\"token literal-property property\">mvc</span><span class=\"token operator\">:</span>\n    <span class=\"token literal-property property\">pathmatch</span><span class=\"token operator\">:</span>\n      matching<span class=\"token operator\">-</span>strategy<span class=\"token operator\">:</span> ant<span class=\"token operator\">-</span>path<span class=\"token operator\">-</span>matcher\n</code></pre></div>\n<p>以下のようなコントローラーを定義しておきました</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/items\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"洗剤\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"コップ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/{id}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Item</span> <span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span><span class=\"token string\">\"冷蔵庫\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/save/{itemId}/{itemName}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Item</span> <span class=\"token function\">saveItem</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token keyword\">int</span> itemId<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">String</span> itemName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span>itemId<span class=\"token punctuation\">,</span>itemName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>以下にアクセスするとswaggeruiが確認できます。</p>\n<p>ttp://localhost:8080/swagger-ui/</p>\n<p><img src=\"/3810/1.png\" alt=\"画像\"></p>\n<p>item-controllerにあるメソッドが定義されています。更にserversは起動しているローカルホストが指定されています。</p>\n<p>試しにtryをすると実際にアプリケーションが処理をしてくれます。</p>\n<p><img src=\"/3810/2.png\" alt=\"画像\"></p>\n<h2>個別エンドポイントのカスタマイズ</h2>\n<p>個別エンドポイントはメソッド名が表示されているなど、APIの定義書としては不十分なところがあるかもしれません。</p>\n<p><img src=\"/3810/3.png\" alt=\"画像\"></p>\n<p>アノテーションを付与することでカスタマイズできます</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/items\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"洗剤\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"コップ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token annotation punctuation\">@ApiOperation</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">=</span><span class=\"token string\">\"個別アイテム情報取得\"</span><span class=\"token punctuation\">,</span> notes<span class=\"token operator\">=</span><span class=\"token string\">\"アイテム情報をIDから取得します。\"</span><span class=\"token punctuation\">,</span>\n            httpMethod <span class=\"token operator\">=</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> consumes <span class=\"token operator\">=</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span> response <span class=\"token operator\">=</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ApiResponse</span><span class=\"token punctuation\">(</span>code <span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"取得したアイテム情報\"</span><span class=\"token punctuation\">,</span> response <span class=\"token operator\">=</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/{id}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Item</span> <span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span><span class=\"token string\">\"冷蔵庫\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token annotation punctuation\">@ApiOperation</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"アイテム情報作成\"</span><span class=\"token punctuation\">,</span> notes <span class=\"token operator\">=</span> <span class=\"token string\">\"アイテム情報を新規に作成します\"</span><span class=\"token punctuation\">,</span>httpMethod <span class=\"token operator\">=</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n            consumes <span class=\"token operator\">=</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/save/{itemId}/{itemName}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Item</span> <span class=\"token function\">saveItem</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token keyword\">int</span> itemId<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">String</span> itemName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span>itemId<span class=\"token punctuation\">,</span>itemName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>個別エンドポイントをカスタマイズできていることがわかります。</p>\n<p><img src=\"/3810/4.png\" alt=\"画像\"></p>\n<h2>API定義書の設定</h2>\n<p>API定義のタイトルとかが不自然なので修正します</p>\n<p>以下のようなコンフィグクラスを作成します</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SwaggerConfig</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Docket</span> <span class=\"token function\">api</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Docket</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DocumentationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SWAGGER_2</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">apiInfo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">apiInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ApiInfo</span> <span class=\"token function\">apiInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApiInfoBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">title</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"アイテムAPI\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"アイテムの取得、作成を行うAPIです\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">version</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">contact</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Contact</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"misakamikoto\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"https://volkruss.com/\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"misaka@mikoto.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>以下のようにAPI定義書のタイトルなどが修正されています</p>\n<p><img src=\"/3810/5.png\" alt=\"画像\"></p>\n<h2>静的ドキュメントの生成</h2>\n<p>SwaggerからAsciiDocへの変換を行うのに、Swagger2Markupというのがあり、Swagger2MarkupをSpring用にカスタマイズしたものがspringfox-statcidocsです。</p>\n<p>以下の依存を追加しておきます</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">testImplementation <span class=\"token string\">'io.springfox:springfox-staticdocs:2.6.1'</span>\n</code></pre></div>\n<p>以下のようなテストコードを作成してスぺニットを作成します。なぜテストかというと、テストにしておけばビルド時に自動で実行されるためです。</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span>jupiter<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AutoConfigureMockMvc</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringBootTest</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MediaType</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MockMvc</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MockMvcRequestBuilders</span><span class=\"token punctuation\">.</span><span class=\"token static\">get</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MockMvcResultMatchers</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebApplicationContext</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">springfox<span class=\"token punctuation\">.</span>documentation<span class=\"token punctuation\">.</span>staticdocs<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Swagger2MarkupResultHandler</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span>jupiter<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token annotation punctuation\">@AutoConfigureMockMvc</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MakeApiDocTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">WebApplicationContext</span> context<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MockMvc</span> mockMvc<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test_make_apidoc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mockMvc<span class=\"token punctuation\">.</span><span class=\"token function\">perform</span><span class=\"token punctuation\">(</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/v2/api-docs\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">APPLICATION_JSON</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">andDo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Swagger2MarkupResultHandler</span><span class=\"token punctuation\">.</span><span class=\"token function\">outputDirectory</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"build/asciidoc/snippets\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">andExpect</span><span class=\"token punctuation\">(</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isOk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>APIのパラメータを使ったときにgetDefaultValueでエラーになってしまいました。→テスト実施時</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">'java.lang.String io.swagger.models.parameters.AbstractSerializableParameter.getDefaultValue()'\njava.lang.NoSuchMethodError: 'java.lang.String io.swagger.models.parameters.AbstractSerializableParameter.getDefaultValue()'\n\tat io.github.robwin.swagger2markup.utils.ParameterUtils.getDefaultValue(ParameterUtils.java:108)\n</code></pre></div>\n<p>メソッドがないよと怒られていますが、エラー個所を見ると…</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getDefaultValue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Parameter</span> parameter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Validate</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span>parameter<span class=\"token punctuation\">,</span> <span class=\"token string\">\"property must not be null!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> defaultValue <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parameter <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">AbstractSerializableParameter</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">AbstractSerializableParameter</span> serializableParameter <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AbstractSerializableParameter</span><span class=\"token punctuation\">)</span>parameter<span class=\"token punctuation\">;</span>\n        defaultValue <span class=\"token operator\">=</span> serializableParameter<span class=\"token punctuation\">.</span><span class=\"token function\">getDefaultValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">defaultString</span><span class=\"token punctuation\">(</span>defaultValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>これはgetDefaultValueの戻り値がObjectになっています。おそらくバージョンによっては発生しないエラーなんだと思います。しかし、こればっかりは修正しようがないような気がするので、一旦はドキュメントの生成だけに着眼します。</p>\n<p>https://github.com/Swagger2Markup/swagger2markup/issues/289</p>\n<p>コントローラーを一旦以下のようにしておきます</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/items\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"洗剤\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"コップ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>これでエラー無くテストは実施でき、成功後は指定したフォルダに3つのファイルが出力されています。</p>\n<p><img src=\"/3810/6.png\" alt=\"画像\"></p>\n<p>生成されたadocファイルはGradleプラグインのasciidoctorでhtmlに変換します。</p>\n<p>gradleプラグイン設定するために、build.gradleを以下のようにします</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">plugins <span class=\"token punctuation\">{</span>\n\tid <span class=\"token string\">'org.springframework.boot'</span> version <span class=\"token string\">'2.7.4'</span>\n\tid <span class=\"token string\">'io.spring.dependency-management'</span> version <span class=\"token string\">'1.0.14.RELEASE'</span>\n\tid <span class=\"token string\">'java'</span>\n\tid <span class=\"token string\">\"org.asciidoctor.jvm.convert\"</span> version <span class=\"token string\">\"3.3.2\"</span> <span class=\"token comment\">// 最新バージョンにする（じゃないとエラーになります）</span>\n<span class=\"token punctuation\">}</span>\n\ngroup <span class=\"token operator\">=</span> <span class=\"token string\">'com.volkruss'</span>\nversion <span class=\"token operator\">=</span> <span class=\"token string\">'0.0.1-SNAPSHOT'</span>\nsourceCompatibility <span class=\"token operator\">=</span> <span class=\"token string\">'11'</span>\n\nrepositories <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">mavenCentral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\ndependencies <span class=\"token punctuation\">{</span>\n\timplementation <span class=\"token string\">'org.springframework.boot:spring-boot-starter-web'</span>\n\ttestImplementation <span class=\"token string\">'org.springframework.boot:spring-boot-starter-test'</span>\n\timplementation <span class=\"token function\">files</span><span class=\"token punctuation\">(</span><span class=\"token string\">'libs/MisakaDatabase-1.0-SNAPSHOT.jar'</span><span class=\"token punctuation\">)</span>\n\timplementation <span class=\"token string\">'io.springfox:springfox-boot-starter:3.0.0'</span>\n\t<span class=\"token comment\">// https://mvnrepository.com/artifact/io.springfox/springfox-staticdocs</span>\n\ttestImplementation <span class=\"token string\">'io.springfox:springfox-staticdocs:2.6.1'</span>\n\n<span class=\"token punctuation\">}</span>\n\ntasks<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">named</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">useJUnitPlatform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 追加</span>\nasciidoctor <span class=\"token punctuation\">{</span>\n\tdependsOn test\n\tsourceDir <span class=\"token function\">file</span><span class=\"token punctuation\">(</span><span class=\"token string\">'build/asciidoc/snippets'</span><span class=\"token punctuation\">)</span>\n\toutputDir <span class=\"token function\">file</span><span class=\"token punctuation\">(</span><span class=\"token string\">'build/docs'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre></div>\n<ul>\n<li>pluginsにorg.asciidoctor.jvm.convertを追加する</li>\n<li>asciidoctorタスクの設定を追加する\n<ul>\n<li>テスト後に実施する</li>\n<li>adocファイルがあるパスの指定をする</li>\n<li>htmlを出力するパスの指定をする</li>\n</ul>\n</li>\n</ul>\n<p>タスクを実行すると以下のようにHTMLファイルが出力されます</p>\n<p><img src=\"/3810/7.png\" alt=\"画像\"></p>\n<p>HTMLはこんな感じで出力されていました</p>\n<p><img src=\"/3810/8.png\" alt=\"画像\"></p>\n<h4>終わりに</h4>\n<p>Springではバージョンによってバグ？があったりで使う気にはなれませんでした。またアノテーションでごちゃごちゃになるのも好きではないです。</p>","slug":"p3810"},"__N_SSG":true}